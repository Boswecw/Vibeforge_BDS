{"version":3,"file":"ErrorBoundary.js","sources":["../../../../src/lib/stores/errors.svelte.ts","../../../../src/lib/components/ErrorBoundary.svelte"],"sourcesContent":["/**\n * Global Error Store\n *\n * Manages application-wide error state using Svelte 5 runes.\n */\n\nimport type { AppError } from '$lib/utils/errors';\nimport { logError } from '$lib/utils/errors';\n\n// ═══════════════════════════════════════════════════════════════════════\n// Error Store State\n// ═══════════════════════════════════════════════════════════════════════\n\ninterface ErrorState {\n\terrors: AppError[];\n\tlastError: AppError | null;\n\tdismissedErrors: Set<string>;\n}\n\nconst state = $state<ErrorState>({\n\terrors: [],\n\tlastError: null,\n\tdismissedErrors: new Set()\n});\n\n// ═══════════════════════════════════════════════════════════════════════\n// Error Store\n// ═══════════════════════════════════════════════════════════════════════\n\nexport const errorStore = {\n\t// Getters\n\tget errors() {\n\t\treturn state.errors.filter((e) => !state.dismissedErrors.has(e.id));\n\t},\n\n\tget lastError() {\n\t\treturn state.lastError;\n\t},\n\n\tget hasErrors() {\n\t\treturn state.errors.length > 0;\n\t},\n\n\tget criticalErrors() {\n\t\treturn state.errors.filter((e) => e.severity === 'CRITICAL' && !state.dismissedErrors.has(e.id));\n\t},\n\n\tget highErrors() {\n\t\treturn state.errors.filter((e) => e.severity === 'HIGH' && !state.dismissedErrors.has(e.id));\n\t},\n\n\t// Actions\n\taddError(error: AppError) {\n\t\tstate.errors = [...state.errors, error];\n\t\tstate.lastError = error;\n\n\t\t// Log error\n\t\tlogError(error);\n\n\t\t// Auto-dismiss low severity errors after 5 seconds\n\t\tif (error.severity === 'LOW') {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.dismissError(error.id);\n\t\t\t}, 5000);\n\t\t}\n\n\t\t// Keep only last 100 errors\n\t\tif (state.errors.length > 100) {\n\t\t\tstate.errors = state.errors.slice(-100);\n\t\t}\n\t},\n\n\tdismissError(id: string) {\n\t\tstate.dismissedErrors.add(id);\n\t},\n\n\tclearError(id: string) {\n\t\tstate.errors = state.errors.filter((e) => e.id !== id);\n\t\tstate.dismissedErrors.delete(id);\n\n\t\tif (state.lastError?.id === id) {\n\t\t\tstate.lastError = state.errors[state.errors.length - 1] || null;\n\t\t}\n\t},\n\n\tclearAll() {\n\t\tstate.errors = [];\n\t\tstate.lastError = null;\n\t\tstate.dismissedErrors.clear();\n\t},\n\n\tclearDismissed() {\n\t\tstate.errors = state.errors.filter((e) => !state.dismissedErrors.has(e.id));\n\t\tstate.dismissedErrors.clear();\n\t}\n};\n","<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport type { Snippet } from 'svelte';\n\timport { classifyError, type AppError } from '$lib/utils/errors';\n\timport { errorStore } from '$lib/stores/errors.svelte';\n\timport { Alert, Button, Panel } from '$lib/components';\n\n\tinterface Props {\n\t\tfallback?: Snippet<[AppError]>;\n\t\tonError?: (error: AppError) => void;\n\t\tshowDetails?: boolean;\n\t\tchildren?: Snippet;\n\t}\n\n\tlet { fallback, onError, showDetails = false, children }: Props = $props();\n\n\tlet error: AppError | null = $state(null);\n\tlet errorInfo: string = $state('');\n\tlet hasError = $derived(error !== null);\n\n\t// Error handler for unhandled errors\n\tlet errorHandler: ((event: ErrorEvent) => void) | null = null;\n\tlet unhandledRejectionHandler: ((event: PromiseRejectionEvent) => void) | null = null;\n\n\tonMount(() => {\n\t\t// Handle window errors\n\t\terrorHandler = (event: ErrorEvent) => {\n\t\t\tconst appError = classifyError(event.error);\n\t\t\thandleError(appError, event.error?.stack || '');\n\t\t\tevent.preventDefault();\n\t\t};\n\n\t\t// Handle unhandled promise rejections\n\t\tunhandledRejectionHandler = (event: PromiseRejectionEvent) => {\n\t\t\tconst appError = classifyError(event.reason);\n\t\t\thandleError(appError, event.reason?.stack || '');\n\t\t\tevent.preventDefault();\n\t\t};\n\n\t\twindow.addEventListener('error', errorHandler);\n\t\twindow.addEventListener('unhandledrejection', unhandledRejectionHandler);\n\t});\n\n\tonDestroy(() => {\n\t\tif (errorHandler) {\n\t\t\twindow.removeEventListener('error', errorHandler);\n\t\t}\n\t\tif (unhandledRejectionHandler) {\n\t\t\twindow.removeEventListener('unhandledrejection', unhandledRejectionHandler);\n\t\t}\n\t});\n\n\tfunction handleError(appError: AppError, stack: string = '') {\n\t\terror = appError;\n\t\terrorInfo = stack;\n\n\t\t// Add to global error store\n\t\terrorStore.addError(appError);\n\n\t\t// Call onError callback if provided\n\t\tif (onError) {\n\t\t\tonError(appError);\n\t\t}\n\t}\n\n\tfunction resetError() {\n\t\terror = null;\n\t\terrorInfo = '';\n\t}\n\n\t// Export method to manually trigger error handling\n\texport function catchError(err: unknown) {\n\t\tconst appError = classifyError(err);\n\t\thandleError(appError, err instanceof Error ? err.stack || '' : '');\n\t}\n</script>\n\n{#if hasError && error}\n\t{#if fallback}\n\t\t{@render fallback(error)}\n\t{:else}\n\t\t<div class=\"error-boundary\">\n\t\t\t<Panel variant=\"elevated\" padding=\"lg\">\n\t\t\t\t<div class=\"error-container\">\n\t\t\t\t\t<div class=\"error-icon\">⚠️</div>\n\t\t\t\t\t<h2>Something went wrong</h2>\n\n\t\t\t\t\t<Alert variant=\"error\" title={error.category}>\n\t\t\t\t\t\t{error.userMessage}\n\t\t\t\t\t</Alert>\n\n\t\t\t\t\t{#if showDetails && errorInfo}\n\t\t\t\t\t\t<details class=\"error-details\">\n\t\t\t\t\t\t\t<summary>Technical Details</summary>\n\t\t\t\t\t\t\t<pre class=\"error-stack\">{errorInfo}</pre>\n\t\t\t\t\t\t</details>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<div class=\"error-actions\">\n\t\t\t\t\t\t<Button variant=\"primary\" on:click={resetError}>Try Again</Button>\n\t\t\t\t\t\t<Button variant=\"secondary\" on:click={() => window.location.reload()}>\n\t\t\t\t\t\t\tReload Page\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<p class=\"error-id\">Error ID: {error.id}</p>\n\t\t\t\t</div>\n\t\t\t</Panel>\n\t\t</div>\n\t{/if}\n{:else if children}\n\t{@render children()}\n{/if}\n\n<style>\n\t.error-boundary {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmin-height: 400px;\n\t\tpadding: var(--spacing-xl);\n\t}\n\n\t.error-container {\n\t\tmax-width: 600px;\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tgap: var(--spacing-lg);\n\t\ttext-align: center;\n\t}\n\n\t.error-icon {\n\t\tfont-size: 4rem;\n\t}\n\n\th2 {\n\t\tfont-family: var(--font-family-heading);\n\t\tfont-size: 2rem;\n\t\tfont-weight: 300;\n\t\tcolor: var(--color-text-primary);\n\t\tmargin: 0;\n\t\tletter-spacing: 0.02em;\n\t}\n\n\t.error-details {\n\t\twidth: 100%;\n\t\tmargin-top: var(--spacing-md);\n\t\ttext-align: left;\n\t}\n\n\t.error-details summary {\n\t\tcursor: pointer;\n\t\tfont-weight: 500;\n\t\tcolor: var(--color-text-secondary);\n\t\tpadding: var(--spacing-sm);\n\t\tuser-select: none;\n\t}\n\n\t.error-details summary:hover {\n\t\tcolor: var(--color-brass);\n\t}\n\n\t.error-stack {\n\t\tmargin-top: var(--spacing-md);\n\t\tpadding: var(--spacing-md);\n\t\tbackground-color: var(--color-surface-2);\n\t\tborder-radius: var(--radius-md);\n\t\tfont-family: var(--font-family-mono);\n\t\tfont-size: 0.75rem;\n\t\tcolor: var(--color-text-secondary);\n\t\toverflow-x: auto;\n\t\twhite-space: pre-wrap;\n\t\tword-break: break-word;\n\t}\n\n\t.error-actions {\n\t\tdisplay: flex;\n\t\tgap: var(--spacing-md);\n\t\tmargin-top: var(--spacing-md);\n\t}\n\n\t.error-id {\n\t\tfont-size: 0.75rem;\n\t\tcolor: var(--color-text-tertiary);\n\t\tfont-family: var(--font-family-mono);\n\t\tmargin: 0;\n\t}\n</style>\n"],"names":["state","errors","lastError","dismissedErrors","Set","errorStore","filter","e","has","id","hasErrors","length","criticalErrors","severity","highErrors","addError","error","logError","setTimeout","this","dismissError","slice","add","clearError","delete","clearAll","clear","clearDismissed","fallback","onError","showDetails","children","$$props","errorInfo","hasError","onDestroy","title","category","$$renderer","push","$.escape","userMessage","err","appError","stack","handleError","classifyError","Error"],"mappings":"yLAmBMA,GACLC,UACAC,UAAW,KACXC,gBAAA,IAAqBC,KAOTC,EAAA,CAER,UAAAJ,GACI,OAAAD,EAAMC,OAAOK,OAAQC,IAAOP,EAAMG,gBAAgBK,IAAID,EAAEE,IAChE,EAEI,aAAAP,GACI,OAAAF,EAAME,SACd,EAEI,aAAAQ,GACI,OAAAV,EAAMC,OAAOU,OAAS,CAC9B,EAEI,kBAAAC,UACIZ,EAAMC,OAAOK,OAAQC,GAAqB,aAAfA,EAAEM,WAA4Bb,EAAMG,gBAAgBK,IAAID,EAAEE,IAC7F,EAEI,cAAAK,UACId,EAAMC,OAAOK,OAAQC,GAAqB,SAAfA,EAAEM,WAAwBb,EAAMG,gBAAgBK,IAAID,EAAEE,IACzF,EAGA,QAAAM,CAASC,GACRhB,EAAMC,OAAA,IAAaD,EAAMC,OAAQe,GACjChB,EAAME,UAAYc,EAGlBC,EAASD,GAGc,QAAnBA,EAAMH,UACTK,gBACCC,KAAKC,aAAaJ,EAAMP,KACtB,KAIAT,EAAMC,OAAOU,OAAS,MACzBX,EAAMC,OAASD,EAAMC,OAAOoB,OAAA,KAE9B,EAEA,YAAAD,CAAaX,GACZT,EAAMG,gBAAgBmB,IAAIb,EAC3B,EAEA,UAAAc,CAAWd,GACVT,EAAMC,OAASD,EAAMC,OAAOK,OAAQC,GAAMA,EAAEE,KAAOA,GACnDT,EAAMG,gBAAgBqB,OAAOf,GAEzBT,EAAME,WAAWO,KAAOA,IAC3BT,EAAME,UAAYF,EAAMC,OAAOD,EAAMC,OAAOU,OAAS,IAAM,KAE7D,EAEA,QAAAc,GACCzB,EAAMC,UACND,EAAME,UAAY,KAClBF,EAAMG,gBAAgBuB,OACvB,EAEA,cAAAC,GACC3B,EAAMC,OAASD,EAAMC,OAAOK,OAAQC,IAAOP,EAAMG,gBAAgBK,IAAID,EAAEE,KACvET,EAAMG,gBAAgBuB,OACvB,mCChFM,IAAAE,SAAAA,EAAAC,QAAUA,EAAAC,YAASA,GAAc,EAAAC,SAAOA,GAAQC,EAElDhB,EAAgC,KAChCiB,EAA2B,GAC3BC,EAA8B,OAAVlB,EAyBxBmB,EAAS,QAkCLD,GAAYlB,4BACXY,4BACKA,IAASZ,gVAQeoB,MAAApB,EAAMqB,sBAClCC,EAAAC,KAAA,gBAAAC,EAAAxB,EAAMyB,iEAGHX,GAAeG,0LAGQA,4UAWGK,EAAAC,KAAA,oEAAAC,EAAAxB,EAAMP,6HAKhCsB,4BACAA,EAAQO,kIAxCUI,IAnBlB,SAAYC,EAAoBC,EAAgB,IACxD5B,EAAQ2B,EACRV,EAAYW,EAGZvC,EAAWU,SAAS4B,GAGhBd,GACHA,EAAQc,EAEV,CAUCE,CADiBC,EAAcJ,GACTA,aAAeK,OAAQL,EAAIE,OAAc,GAChE"}