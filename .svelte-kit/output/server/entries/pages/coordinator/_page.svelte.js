import{f as s,e,d as t,c as n,m as o,k as i}from"../../../chunks/vendor-svelte.js";import{S as a,W as l,s as r}from"../../../chunks/streaming.js";import{E as c}from"../../../chunks/ErrorBoundary.js";import{P as d}from"../../../chunks/Panel.js";import{B as u}from"../../../chunks/Button.js";import{A as p}from"../../../chunks/Alert.js";import{c as f,a as x}from"../../../chunks/errors.js";import{B as v}from"../../../chunks/Badge.js";const h={sessions:[],currentSession:null,isCoordinating:!1},g={get sessions(){return h.sessions},get currentSession(){return h.currentSession},get isCoordinating(){return h.isCoordinating},get activeSessions(){return h.sessions.filter(s=>s.status===a.RUNNING||s.status===a.PENDING)},get completedSessions(){return h.sessions.filter(s=>s.status===a.COMPLETED)},get failedSessions(){return h.sessions.filter(s=>s.status===a.FAILED)},createSession(s){const e={nodes:s.agents.map(s=>({nodeId:s.id,status:"pending",progress:0})),status:l.PENDING},t={id:`coordination_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"coordination",status:a.PENDING,createdAt:new Date,request:s,workflow:e};return h.sessions=[...h.sessions,t],h.currentSession=t,t},startSession(s){const e=h.sessions.find(e=>e.id===s);e&&(e.status=a.RUNNING,e.startedAt=new Date,e.workflow.status=l.RUNNING,e.workflow.startedAt=new Date,h.isCoordinating=!0,h.sessions=[...h.sessions])},updateNodeExecution(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const o=n.workflow.nodes.find(s=>s.nodeId===e);o&&(Object.assign(o,t),h.sessions=[...h.sessions])},startNode(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const o=n.workflow.nodes.find(s=>s.nodeId===e);o&&(o.status="running",o.sessionId=t,o.startedAt=new Date,o.progress=0,h.sessions=[...h.sessions])},updateNodeProgress(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const o=n.workflow.nodes.find(s=>s.nodeId===e);o&&(o.progress=Math.min(100,Math.max(0,t)),h.sessions=[...h.sessions])},completeNode(s,e){const t=h.sessions.find(e=>e.id===s);if(!t)return;const n=t.workflow.nodes.find(s=>s.nodeId===e);if(!n)return;n.status="completed",n.completedAt=new Date,n.progress=100;t.workflow.nodes.every(s=>"completed"===s.status)&&this.completeSession(s),h.sessions=[...h.sessions]},failNode(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const o=n.workflow.nodes.find(s=>s.nodeId===e);o&&(o.status="failed",o.completedAt=new Date,o.error=t,n.workflow.status=l.PARTIAL,h.sessions=[...h.sessions])},completeSession(s){const e=h.sessions.find(e=>e.id===s);e&&(e.status=a.COMPLETED,e.completedAt=new Date,e.workflow.status=l.COMPLETED,e.workflow.completedAt=new Date,h.isCoordinating=!1,h.sessions=[...h.sessions])},failSession(s,e){const t=h.sessions.find(e=>e.id===s);t&&(t.status=a.FAILED,t.completedAt=new Date,t.error=e,t.workflow.status=l.FAILED,t.workflow.error=e,t.workflow.completedAt=new Date,h.isCoordinating=!1,h.sessions=[...h.sessions])},cancelSession(s){const e=h.sessions.find(e=>e.id===s);e&&(e.status=a.CANCELLED,e.completedAt=new Date,e.workflow.status=l.FAILED,e.workflow.error="Workflow cancelled by user",e.workflow.completedAt=new Date,h.currentSession?.id===s&&(h.isCoordinating=!1),h.sessions=[...h.sessions])},setCurrentSession(s){if(null===s)return void(h.currentSession=null);const e=h.sessions.find(e=>e.id===s);e&&(h.currentSession=e)},deleteSession(s){h.sessions=h.sessions.filter(e=>e.id!==s),h.currentSession?.id===s&&(h.currentSession=null,h.isCoordinating=!1)},clearAll(){h.sessions=[],h.currentSession=null,h.isCoordinating=!1},get isRunning(){return h.isCoordinating},updateAgentStatus(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const o=n.workflow.nodes.find(s=>s.nodeId===e);o&&(o.status=t,h.sessions=[...h.sessions])},updateAgentOutput(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n||!n.workflow.agent_states)return;const o=n.workflow.agent_states.find(s=>s.id===e||s.agent_id===e);o&&(o.output=t),h.sessions=[...h.sessions]},appendStreamingOutput(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n||!n.workflow.agent_states)return;const o=n.workflow.agent_states.find(s=>s.id===e||s.agent_id===e);o&&(o.output=(o.output||"")+t),h.sessions=[...h.sessions]}};const w="http://localhost:8787";function k(s){if(!s.task||0===s.task.trim().length)return f("Task description is required");if(!s.agents||0===s.agents.length)return f("At least one agent node is required");const e=["planning","execution","evaluation"];for(const t of s.agents)if(!e.includes(t.type))return f(`Invalid agent type: ${t.type}`);return function(s,e){const t=new Map;s.forEach(s=>t.set(s.id,new Set)),e.forEach(s=>{const e=t.get(s.from);e&&e.add(s.to)});const n=new Set,o=new Set;function i(s){if(o.has(s))return!0;if(n.has(s))return!1;n.add(s),o.add(s);const e=t.get(s);if(e)for(const t of e)if(i(t))return!0;return o.delete(s),!1}for(const a of t.keys())if(i(a))return!0;return!1}(s.agents,s.dependencies||[])?f("Workflow contains circular dependencies"):null}function m(s){switch(s){case"planning":return"üìù";case"execution":return"‚ö°";case"evaluation":return"‚úì";default:return"ü§ñ"}}function y(s){switch(s){case"completed":return"success";case"running":return"warning";case"failed":return"danger";default:return"neutral"}}function $(s){const e=s.agent_states.length;if(0===e)return 0;return s.agent_states.filter(s=>"completed"===s.status).length/e*100}function q(o,i){o.component(o=>{let i=new Set(["planning","execution","evaluation"]),a=!0,l=null,c=!1;o.push('<div class="workflow-request svelte-1x9907x"><div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x" for="task">Task Description</label> <textarea id="task" placeholder="Describe the multi-step task to be executed by the agent workflow..." rows="4" class="svelte-1x9907x">');const d=s("");d&&o.push(`${d}`),o.push('</textarea></div> <div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x">Agent Pipeline</label> <p class="text-muted svelte-1x9907x">Select agents to include in the workflow</p> <div class="agents-grid svelte-1x9907x">\x3c!--[--\x3e');const v=e([{type:"planning",label:"Planning Agent",icon:"üìù",description:"Define task strategy"},{type:"execution",label:"Execution Agent",icon:"‚ö°",description:"Generate code"},{type:"evaluation",label:"Evaluator Agent",icon:"‚úì",description:"Assess quality"}]);for(let e=0,r=v.length;e<r;e++){let a=v[e];o.push(`<label${t("agent-card svelte-1x9907x",void 0,{selected:i.has(a.type)})}><input type="checkbox"${n("checked",i.has(a.type),!0)} class="svelte-1x9907x"/> <div class="agent-content svelte-1x9907x"><div class="agent-header svelte-1x9907x"><span class="agent-icon svelte-1x9907x">${s(a.icon)}</span> <span class="agent-label svelte-1x9907x">${s(a.label)}</span></div> <div class="agent-description svelte-1x9907x">${s(a.description)}</div></div></label>`)}o.push(`\x3c!--]--\x3e</div></div> <div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x">Workflow Options</label> <div class="options-list svelte-1x9907x"><label class="option svelte-1x9907x"><input type="checkbox"${n("checked",a,!0)} class="svelte-1x9907x"/> <div class="option-content svelte-1x9907x"><span class="option-title svelte-1x9907x">Retry on Failure</span> <span class="option-description svelte-1x9907x">Automatically retry failed agents</span></div></label> `),o.push("\x3c!--[--\x3e"),o.push(`<div class="option-detail svelte-1x9907x"><label for="maxRetries">Max Retries:</label> <input type="number" id="maxRetries"${n("value",3)} min="1" max="10" class="svelte-1x9907x"/></div>`),o.push("\x3c!--]--\x3e</div></div> "),l?(o.push("\x3c!--[--\x3e"),p(o,{variant:"error",children:e=>{e.push(`\x3c!----\x3e${s(l)}`)},$$slots:{default:!0}})):o.push("\x3c!--[!--\x3e"),o.push("\x3c!--]--\x3e "),u(o,{onclick:async function(){if("".trim())if(0!==i.size){l=null,c=!0;try{const s=Array.from(i).map((s,e)=>({id:`${s}_${e}`,type:s,status:"pending"})),e=[],t=["planning","execution","evaluation"],n=s.sort((s,e)=>t.indexOf(s.type)-t.indexOf(e.type));for(let i=1;i<n.length;i++)e.push({from:n[i-1].id,to:n[i].id});const o=await async function(s){const e=k(s);if(e)return{success:!1,error:e};try{const e=await fetch(`${w}/api/v1/bds/workflow/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task:s.task,agents:s.agents,dependencies:s.dependencies||[],options:s.options||{}})});if(!e.ok){const s=await e.json();return{success:!1,error:f(s.detail||"Failed to start workflow session")}}const{sessionId:t}=await e.json(),n=g.createSession(s);n.id=t,g.startSession(n.id);const o=`${w}/api/v1/bds/workflow/${t}/stream`;let i=null;return r.subscribe(o,{onChunk:s=>{i&&g.appendStreamingOutput(n.id,i,s)},onStageStart:s=>{i=s,g.updateAgentStatus(n.id,s,"running")},onStageEnd:(s,e)=>{g.updateAgentStatus(n.id,s,"completed"),g.updateAgentOutput(n.id,s,"string"==typeof e?e:JSON.stringify(e)),i=null},onComplete:s=>{g.completeSession(n.id)},onError:s=>{g.failSession(n.id,s.message)}}),{success:!0,sessionId:n.id}}catch(l){return{success:!1,error:x(l)}}}({task:"",agents:s,dependencies:e,options:{parallel_execution:false,retry_on_failure:a,max_retries:3}});o.success||(l=o.error?.message||"Failed to start workflow")}catch(s){l=s instanceof Error?s.message:"An unknown error occurred"}finally{c=!1}}else l="Select at least one agent";else l="Task description is required"},disabled:c||0===i.size,fullWidth:!0,children:e=>{e.push(`\x3c!----\x3e${s(c?"Starting Workflow...":"Start Workflow")}`)},$$slots:{default:!0}}),o.push("\x3c!----\x3e</div>")})}function S(n,o){n.component(n=>{let{workflow:i}=o;function a(s){switch(s){case"completed":return"‚úÖ";case"running":return"‚è≥";case"failed":return"‚ùå";case"pending":return"‚è∏Ô∏è";default:return"‚ö™"}}if(n.push('<div class="workflow-visualization svelte-erxgpi">'),i&&i.agent_states){n.push("\x3c!--[--\x3e"),n.push('<div class="workflow-pipeline svelte-erxgpi">\x3c!--[--\x3e');const o=e(i.agent_states);for(let e=0,l=o.length;e<l;e++){let l=o[e];n.push(`<div class="pipeline-step svelte-erxgpi"><div${t("agent-node svelte-erxgpi",void 0,{active:"running"===l.status,completed:"completed"===l.status,failed:"failed"===l.status})}><div class="node-icon svelte-erxgpi">${s(m(l.agent_id.split("_")[0]))}</div> <div class="node-content svelte-erxgpi"><div class="node-title svelte-erxgpi">${s(l.agent_id)}</div> `),v(n,{variant:y(l.status),children:e=>{e.push(`\x3c!----\x3e${s(a(l.status))} ${s(l.status)}`)},$$slots:{default:!0}}),n.push("\x3c!----\x3e</div></div> "),e<i.agent_states.length-1?(n.push("\x3c!--[--\x3e"),n.push('<div class="pipeline-arrow svelte-erxgpi"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"></path></svg></div>')):n.push("\x3c!--[!--\x3e"),n.push("\x3c!--]--\x3e</div>")}n.push("\x3c!--]--\x3e</div> "),i.current_agent?(n.push("\x3c!--[--\x3e"),n.push(`<div class="current-agent-info svelte-erxgpi"><div class="info-label svelte-erxgpi">Currently Executing:</div> <div class="info-value svelte-erxgpi">${s(i.current_agent)}</div></div>`)):n.push("\x3c!--[!--\x3e"),n.push("\x3c!--]--\x3e")}else n.push("\x3c!--[!--\x3e"),n.push('<div class="empty-state svelte-erxgpi"><p class="text-muted svelte-erxgpi">No workflow visualization available</p></div>');n.push("\x3c!--]--\x3e</div>")})}function A(n,l){n.component(n=>{const l=g.currentSession;c(n,{children:n=>{n.push('<div class="coordinator-page svelte-qayffx"><header class="page-header svelte-qayffx"><h1 class="svelte-qayffx">Coordinator Agent</h1> <p class="text-muted svelte-qayffx">Orchestrate multi-agent workflows</p></header> <div class="content-grid svelte-qayffx"><div class="left-column svelte-qayffx">'),d(n,{title:"New Workflow",children:s=>{q(s)},$$slots:{default:!0}}),n.push("\x3c!----\x3e "),l?(n.push("\x3c!--[--\x3e"),d(n,{title:"Workflow History",class:"mt-6",children:n=>{!function(n){n.component(n=>{const o=g.sessions;function i(s){return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)}function l(s){switch(s){case a.COMPLETED:return"success";case a.RUNNING:return"warning";case a.FAILED:case a.CANCELLED:return"danger";default:return"neutral"}}function r(s){switch(s){case a.COMPLETED:return"‚úÖ";case a.RUNNING:return"‚è≥";case a.FAILED:return"‚ùå";case a.CANCELLED:return"üö´";default:return"‚è∏Ô∏è"}}if(n.push('<div class="workflow-history svelte-ulgnqa">'),o.length>0){n.push("\x3c!--[--\x3e"),n.push(`<div class="history-header svelte-ulgnqa"><h3 class="svelte-ulgnqa">Past Workflows (${s(o.length)})</h3> `),u(n,{variant:"ghost",size:"sm",onclick:()=>g.clearAll(),children:s=>{s.push("\x3c!----\x3eClear All")},$$slots:{default:!0}}),n.push('\x3c!----\x3e</div> <div class="sessions-list svelte-ulgnqa">\x3c!--[--\x3e');const a=e(o);for(let e=0,o=a.length;e<o;e++){let o=a[e];const c=g.currentSession?.id===o.id;n.push(`<div${t("session-card svelte-ulgnqa",void 0,{active:c})} role="button" tabindex="0"><div class="session-header svelte-ulgnqa"><div class="session-info svelte-ulgnqa"><span class="session-icon svelte-ulgnqa">${s(r(o.status))}</span> <div class="session-title-group svelte-ulgnqa"><div class="session-title svelte-ulgnqa">${s(o.request.task||`Workflow #${o.id.split("_")[1]}`)}</div> <div class="session-meta svelte-ulgnqa"><span class="session-date">${s(i(o.createdAt))}</span></div></div></div> `),v(n,{variant:l(o.status),children:e=>{e.push(`\x3c!----\x3e${s(o.status)}`)},$$slots:{default:!0}}),n.push("\x3c!----\x3e</div> "),o.workflow?(n.push("\x3c!--[--\x3e"),n.push(`<div class="session-stats svelte-ulgnqa"><div class="stat svelte-ulgnqa"><span class="stat-icon svelte-ulgnqa">ü§ñ</span> <span class="stat-value svelte-ulgnqa">${s(o.workflow.agent_states.length)}</span> <span class="stat-label svelte-ulgnqa">agents</span></div> <div class="stat svelte-ulgnqa"><span class="stat-icon svelte-ulgnqa">üìä</span> <span class="stat-value svelte-ulgnqa">${s($(o.workflow).toFixed(0))}%</span> <span class="stat-label svelte-ulgnqa">progress</span></div></div>`)):n.push("\x3c!--[!--\x3e"),n.push("\x3c!--]--\x3e "),o.error?(n.push("\x3c!--[--\x3e"),n.push(`<div class="session-error svelte-ulgnqa"><svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM7 4h2v5H7V4zm0 6h2v2H7v-2z"></path></svg> <span>${s(o.error)}</span></div>`)):n.push("\x3c!--[!--\x3e"),n.push('\x3c!--]--\x3e <div class="session-actions svelte-ulgnqa">'),u(n,{variant:"ghost",size:"sm",onclick:s=>{var e;s.stopPropagation(),e=o.id,g.setCurrentSession(e)},children:s=>{s.push("\x3c!----\x3eView Details")},$$slots:{default:!0}}),n.push("\x3c!----\x3e "),u(n,{variant:"ghost",size:"sm",onclick:s=>{var e;s.stopPropagation(),e=o.id,confirm("Are you sure you want to delete this workflow session?")&&g.deleteSession(e)},children:s=>{s.push("\x3c!----\x3eDelete")},$$slots:{default:!0}}),n.push("\x3c!----\x3e</div></div>")}n.push("\x3c!--]--\x3e</div>")}else n.push("\x3c!--[!--\x3e"),n.push('<div class="empty-state svelte-ulgnqa"><div class="empty-icon svelte-ulgnqa">üìã</div> <p class="empty-title svelte-ulgnqa">No workflow history</p> <p class="empty-description svelte-ulgnqa">Start a workflow to see your history here.</p></div>');n.push("\x3c!--]--\x3e</div>")})}(n)},$$slots:{default:!0}})):n.push("\x3c!--[!--\x3e"),n.push('\x3c!--]--\x3e</div> <div class="right-column svelte-qayffx">'),l?(n.push("\x3c!--[--\x3e"),l.status===a.RUNNING?(n.push("\x3c!--[--\x3e"),d(n,{title:"Workflow Executing",children:e=>{l.workflow?(e.push("\x3c!--[--\x3e"),S(e,{workflow:l.workflow}),e.push(`\x3c!----\x3e <div class="workflow-progress svelte-qayffx"><div class="progress-label svelte-qayffx">Overall Progress</div> <div class="progress-bar svelte-qayffx"><div class="progress-bar-fill svelte-qayffx"${o(`width: ${i($(l.workflow))}%`)}></div></div> <div class="progress-percent svelte-qayffx">${s($(l.workflow).toFixed(0))}%</div></div>`)):(e.push("\x3c!--[!--\x3e"),e.push('<div class="progress-message svelte-qayffx"><div class="spinner svelte-qayffx"></div> <p class="svelte-qayffx">Initializing workflow...</p></div>')),e.push("\x3c!--]--\x3e")},$$slots:{default:!0}})):(n.push("\x3c!--[!--\x3e"),l.status===a.COMPLETED&&l.workflow?(n.push("\x3c!--[--\x3e"),d(n,{title:"Workflow Completed",children:s=>{s.push('<div class="success-state svelte-qayffx"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="svelte-qayffx"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><polyline points="22 4 12 14.01 9 11.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline></svg> <h3 class="svelte-qayffx">Workflow Executed Successfully</h3> <p class="svelte-qayffx">All agents have completed their tasks.</p></div> <div class="workflow-results svelte-qayffx">'),S(s,{workflow:l.workflow}),s.push("\x3c!----\x3e</div>")},$$slots:{default:!0}})):(n.push("\x3c!--[!--\x3e"),l.status===a.FAILED?(n.push("\x3c!--[--\x3e"),d(n,{title:"Workflow Failed",children:e=>{e.push('<div class="error-state svelte-qayffx"><svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor" class="svelte-qayffx"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM7 4h2v5H7V4zm0 6h2v2H7v-2z"></path></svg> <h3 class="svelte-qayffx">Workflow Failed</h3> '),l.error?(e.push("\x3c!--[--\x3e"),e.push(`<p class="error-message svelte-qayffx">${s(l.error)}</p>`)):e.push("\x3c!--[!--\x3e"),e.push("\x3c!--]--\x3e</div> "),l.workflow?(e.push("\x3c!--[--\x3e"),e.push('<div class="workflow-results svelte-qayffx">'),S(e,{workflow:l.workflow}),e.push("\x3c!----\x3e</div>")):e.push("\x3c!--[!--\x3e"),e.push("\x3c!--]--\x3e")},$$slots:{default:!0}})):n.push("\x3c!--[!--\x3e"),n.push("\x3c!--]--\x3e")),n.push("\x3c!--]--\x3e")),n.push("\x3c!--]--\x3e")):(n.push("\x3c!--[!--\x3e"),d(n,{title:"Welcome",children:s=>{s.push('<div class="empty-state svelte-qayffx"><div class="empty-icon svelte-qayffx">üéØ</div> <h2 class="svelte-qayffx">Create a Workflow</h2> <p class="svelte-qayffx">Design and execute multi-agent coordination workflows to handle complex tasks.</p></div>')},$$slots:{default:!0}})),n.push("\x3c!--]--\x3e</div></div></div>")},$$slots:{default:!0}})})}export{A as default};
