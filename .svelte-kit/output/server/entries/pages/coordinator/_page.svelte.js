import{f as s,e,d as t,c as n,m as i,k as o}from"../../../chunks/vendor-svelte.js";import{S as l,W as a,s as r}from"../../../chunks/streaming.js";import{E as c}from"../../../chunks/ErrorBoundary.js";import{P as d}from"../../../chunks/Panel.js";import{B as u}from"../../../chunks/Button.js";import{A as p}from"../../../chunks/Alert.js";import{c as x,a as f}from"../../../chunks/errors.js";import{B as v}from"../../../chunks/Badge.js";const h={sessions:[],currentSession:null,isCoordinating:!1},g={get sessions(){return h.sessions},get currentSession(){return h.currentSession},get isCoordinating(){return h.isCoordinating},get activeSessions(){return h.sessions.filter(s=>s.status===l.RUNNING||s.status===l.PENDING)},get completedSessions(){return h.sessions.filter(s=>s.status===l.COMPLETED)},get failedSessions(){return h.sessions.filter(s=>s.status===l.FAILED)},createSession(s){const e={nodes:s.agents.map(s=>({nodeId:s.id,status:"pending",progress:0})),status:a.PENDING},t={id:`coordination_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"coordination",status:l.PENDING,createdAt:new Date,request:s,workflow:e};return h.sessions=[...h.sessions,t],h.currentSession=t,t},startSession(s){const e=h.sessions.find(e=>e.id===s);e&&(e.status=l.RUNNING,e.startedAt=new Date,e.workflow.status=a.RUNNING,e.workflow.startedAt=new Date,h.isCoordinating=!0,h.sessions=[...h.sessions])},updateNodeExecution(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const i=n.workflow.nodes.find(s=>s.nodeId===e);i&&(Object.assign(i,t),h.sessions=[...h.sessions])},startNode(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const i=n.workflow.nodes.find(s=>s.nodeId===e);i&&(i.status="running",i.sessionId=t,i.startedAt=new Date,i.progress=0,h.sessions=[...h.sessions])},updateNodeProgress(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const i=n.workflow.nodes.find(s=>s.nodeId===e);i&&(i.progress=Math.min(100,Math.max(0,t)),h.sessions=[...h.sessions])},completeNode(s,e){const t=h.sessions.find(e=>e.id===s);if(!t)return;const n=t.workflow.nodes.find(s=>s.nodeId===e);if(!n)return;n.status="completed",n.completedAt=new Date,n.progress=100;t.workflow.nodes.every(s=>"completed"===s.status)&&this.completeSession(s),h.sessions=[...h.sessions]},failNode(s,e,t){const n=h.sessions.find(e=>e.id===s);if(!n)return;const i=n.workflow.nodes.find(s=>s.nodeId===e);i&&(i.status="failed",i.completedAt=new Date,i.error=t,n.workflow.status=a.PARTIAL,h.sessions=[...h.sessions])},completeSession(s){const e=h.sessions.find(e=>e.id===s);e&&(e.status=l.COMPLETED,e.completedAt=new Date,e.workflow.status=a.COMPLETED,e.workflow.completedAt=new Date,h.isCoordinating=!1,h.sessions=[...h.sessions])},failSession(s,e){const t=h.sessions.find(e=>e.id===s);t&&(t.status=l.FAILED,t.completedAt=new Date,t.error=e,t.workflow.status=a.FAILED,t.workflow.error=e,t.workflow.completedAt=new Date,h.isCoordinating=!1,h.sessions=[...h.sessions])},cancelSession(s){const e=h.sessions.find(e=>e.id===s);e&&(e.status=l.CANCELLED,e.completedAt=new Date,e.workflow.status=a.FAILED,e.workflow.error="Workflow cancelled by user",e.workflow.completedAt=new Date,h.currentSession?.id===s&&(h.isCoordinating=!1),h.sessions=[...h.sessions])},setCurrentSession(s){if(null===s)return void(h.currentSession=null);const e=h.sessions.find(e=>e.id===s);e&&(h.currentSession=e)},deleteSession(s){h.sessions=h.sessions.filter(e=>e.id!==s),h.currentSession?.id===s&&(h.currentSession=null,h.isCoordinating=!1)},clearAll(){h.sessions=[],h.currentSession=null,h.isCoordinating=!1}};function w(s){if(!s.task||0===s.task.trim().length)return f("Task description is required");if(!s.agents||0===s.agents.length)return f("At least one agent node is required");const e=["planning","execution","evaluation"];for(const t of s.agents)if(!e.includes(t.type))return f(`Invalid agent type: ${t.type}`);return function(s,e){const t=new Map;s.forEach(s=>t.set(s.id,new Set)),e.forEach(s=>{const e=t.get(s.from);e&&e.add(s.to)});const n=new Set,i=new Set;function o(s){if(i.has(s))return!0;if(n.has(s))return!1;n.add(s),i.add(s);const e=t.get(s);if(e)for(const t of e)if(o(t))return!0;return i.delete(s),!1}for(const l of t.keys())if(o(l))return!0;return!1}(s.agents,s.dependencies||[])?f("Workflow contains circular dependencies"):null}function m(s){switch(s){case"planning":return"üìù";case"execution":return"‚ö°";case"evaluation":return"‚úì";default:return"ü§ñ"}}function k(s){switch(s){case"completed":return"success";case"running":return"warning";case"failed":return"danger";default:return"neutral"}}function y(s){const e=s.agent_states.length;if(0===e)return 0;return s.agent_states.filter(s=>"completed"===s.status).length/e*100}function $(i,o){i.component(i=>{let o=new Set(["planning","execution","evaluation"]),l=!0,a=null,c=!1;i.push('<div class="workflow-request svelte-1x9907x"><div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x" for="task">Task Description</label> <textarea id="task" placeholder="Describe the multi-step task to be executed by the agent workflow..." rows="4" class="svelte-1x9907x">');const d=s("");d&&i.push(`${d}`),i.push('</textarea></div> <div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x">Agent Pipeline</label> <p class="text-muted svelte-1x9907x">Select agents to include in the workflow</p> <div class="agents-grid svelte-1x9907x">\x3c!--[--\x3e');const f=e([{type:"planning",label:"Planning Agent",icon:"üìù",description:"Define task strategy"},{type:"execution",label:"Execution Agent",icon:"‚ö°",description:"Generate code"},{type:"evaluation",label:"Evaluator Agent",icon:"‚úì",description:"Assess quality"}]);for(let e=0,r=f.length;e<r;e++){let l=f[e];i.push(`<label${t("agent-card svelte-1x9907x",void 0,{selected:o.has(l.type)})}><input type="checkbox"${n("checked",o.has(l.type),!0)} class="svelte-1x9907x"/> <div class="agent-content svelte-1x9907x"><div class="agent-header svelte-1x9907x"><span class="agent-icon svelte-1x9907x">${s(l.icon)}</span> <span class="agent-label svelte-1x9907x">${s(l.label)}</span></div> <div class="agent-description svelte-1x9907x">${s(l.description)}</div></div></label>`)}i.push(`\x3c!--]--\x3e</div></div> <div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x">Workflow Options</label> <div class="options-list svelte-1x9907x"><label class="option svelte-1x9907x"><input type="checkbox"${n("checked",l,!0)} class="svelte-1x9907x"/> <div class="option-content svelte-1x9907x"><span class="option-title svelte-1x9907x">Retry on Failure</span> <span class="option-description svelte-1x9907x">Automatically retry failed agents</span></div></label> `),i.push("\x3c!--[--\x3e"),i.push(`<div class="option-detail svelte-1x9907x"><label for="maxRetries">Max Retries:</label> <input type="number" id="maxRetries"${n("value",3)} min="1" max="10" class="svelte-1x9907x"/></div>`),i.push("\x3c!--]--\x3e</div></div> "),a?(i.push("\x3c!--[--\x3e"),p(i,{variant:"error",children:e=>{e.push(`\x3c!----\x3e${s(a)}`)},$$slots:{default:!0}})):i.push("\x3c!--[!--\x3e"),i.push("\x3c!--]--\x3e "),u(i,{onclick:async function(){if("".trim())if(0!==o.size){a=null,c=!0;try{const s=Array.from(o).map((s,e)=>({id:`${s}_${e}`,type:s,status:"pending"})),e=[],t=["planning","execution","evaluation"],n=s.sort((s,e)=>t.indexOf(s.type)-t.indexOf(e.type));for(let o=1;o<n.length;o++)e.push({from:n[o-1].id,to:n[o].id});const i=await async function(s){const e=w(s);if(e)return{success:!1,error:e};try{const e=g.createSession(s);g.startSession(e.id);const t=`http://localhost:8787/api/v1/bds/workflow/${e.id}/stream`;return r.subscribe(t,{onChunk:s=>{g.appendStreamingOutput(s)},onStageStart:s=>{g.updateAgentStatus(e.id,s,"running")},onStageEnd:(s,t)=>{g.updateAgentStatus(e.id,s,"completed"),g.updateAgentOutput(e.id,s,t)},onComplete:s=>{const t=s;g.completeSession(e.id,t)},onError:s=>{g.failSession(e.id,s.message)}}),{success:!0,sessionId:e.id}}catch(a){return{success:!1,error:x(a)}}}({task:"",agents:s,dependencies:e,options:{parallel_execution:false,retry_on_failure:l,max_retries:3}});i.success||(a=i.error?.message||"Failed to start workflow")}catch(s){a=s instanceof Error?s.message:"An unknown error occurred"}finally{c=!1}}else a="Select at least one agent";else a="Task description is required"},disabled:c||0===o.size,fullWidth:!0,children:e=>{e.push(`\x3c!----\x3e${s(c?"Starting Workflow...":"Start Workflow")}`)},$$slots:{default:!0}}),i.push("\x3c!----\x3e</div>")})}function q(n,i){n.component(n=>{let{workflow:o}=i;function l(s){switch(s){case"completed":return"‚úÖ";case"running":return"‚è≥";case"failed":return"‚ùå";case"pending":return"‚è∏Ô∏è";default:return"‚ö™"}}if(n.push('<div class="workflow-visualization svelte-erxgpi">'),o&&o.agent_states){n.push("\x3c!--[--\x3e"),n.push('<div class="workflow-pipeline svelte-erxgpi">\x3c!--[--\x3e');const i=e(o.agent_states);for(let e=0,a=i.length;e<a;e++){let a=i[e];n.push(`<div class="pipeline-step svelte-erxgpi"><div${t("agent-node svelte-erxgpi",void 0,{active:"running"===a.status,completed:"completed"===a.status,failed:"failed"===a.status})}><div class="node-icon svelte-erxgpi">${s(m(a.agent_id.split("_")[0]))}</div> <div class="node-content svelte-erxgpi"><div class="node-title svelte-erxgpi">${s(a.agent_id)}</div> `),v(n,{variant:k(a.status),children:e=>{e.push(`\x3c!----\x3e${s(l(a.status))} ${s(a.status)}`)},$$slots:{default:!0}}),n.push("\x3c!----\x3e</div></div> "),e<o.agent_states.length-1?(n.push("\x3c!--[--\x3e"),n.push('<div class="pipeline-arrow svelte-erxgpi"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"></path></svg></div>')):n.push("\x3c!--[!--\x3e"),n.push("\x3c!--]--\x3e</div>")}n.push("\x3c!--]--\x3e</div> "),o.current_agent?(n.push("\x3c!--[--\x3e"),n.push(`<div class="current-agent-info svelte-erxgpi"><div class="info-label svelte-erxgpi">Currently Executing:</div> <div class="info-value svelte-erxgpi">${s(o.current_agent)}</div></div>`)):n.push("\x3c!--[!--\x3e"),n.push("\x3c!--]--\x3e")}else n.push("\x3c!--[!--\x3e"),n.push('<div class="empty-state svelte-erxgpi"><p class="text-muted svelte-erxgpi">No workflow visualization available</p></div>');n.push("\x3c!--]--\x3e</div>")})}function S(n,a){n.component(n=>{const a=g.currentSession;c(n,{children:n=>{n.push('<div class="coordinator-page svelte-qayffx"><header class="page-header svelte-qayffx"><h1 class="svelte-qayffx">Coordinator Agent</h1> <p class="text-muted svelte-qayffx">Orchestrate multi-agent workflows</p></header> <div class="content-grid svelte-qayffx"><div class="left-column svelte-qayffx">'),d(n,{title:"New Workflow",children:s=>{$(s)},$$slots:{default:!0}}),n.push("\x3c!----\x3e "),a?(n.push("\x3c!--[--\x3e"),d(n,{title:"Workflow History",class:"mt-6",children:n=>{!function(n){n.component(n=>{const i=g.sessions;function o(s){return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)}function a(s){switch(s){case l.COMPLETED:return"success";case l.RUNNING:return"warning";case l.FAILED:case l.CANCELLED:return"danger";default:return"neutral"}}function r(s){switch(s){case l.COMPLETED:return"‚úÖ";case l.RUNNING:return"‚è≥";case l.FAILED:return"‚ùå";case l.CANCELLED:return"üö´";default:return"‚è∏Ô∏è"}}if(n.push('<div class="workflow-history svelte-ulgnqa">'),i.length>0){n.push("\x3c!--[--\x3e"),n.push(`<div class="history-header svelte-ulgnqa"><h3 class="svelte-ulgnqa">Past Workflows (${s(i.length)})</h3> `),u(n,{variant:"ghost",size:"sm",onclick:()=>g.clearAll(),children:s=>{s.push("\x3c!----\x3eClear All")},$$slots:{default:!0}}),n.push('\x3c!----\x3e</div> <div class="sessions-list svelte-ulgnqa">\x3c!--[--\x3e');const l=e(i);for(let e=0,i=l.length;e<i;e++){let i=l[e];const c=g.currentSession?.id===i.id;n.push(`<div${t("session-card svelte-ulgnqa",void 0,{active:c})} role="button" tabindex="0"><div class="session-header svelte-ulgnqa"><div class="session-info svelte-ulgnqa"><span class="session-icon svelte-ulgnqa">${s(r(i.status))}</span> <div class="session-title-group svelte-ulgnqa"><div class="session-title svelte-ulgnqa">${s(i.request.task||`Workflow #${i.id.split("_")[1]}`)}</div> <div class="session-meta svelte-ulgnqa"><span class="session-date">${s(o(i.createdAt))}</span></div></div></div> `),v(n,{variant:a(i.status),children:e=>{e.push(`\x3c!----\x3e${s(i.status)}`)},$$slots:{default:!0}}),n.push("\x3c!----\x3e</div> "),i.workflow?(n.push("\x3c!--[--\x3e"),n.push(`<div class="session-stats svelte-ulgnqa"><div class="stat svelte-ulgnqa"><span class="stat-icon svelte-ulgnqa">ü§ñ</span> <span class="stat-value svelte-ulgnqa">${s(i.workflow.agent_states.length)}</span> <span class="stat-label svelte-ulgnqa">agents</span></div> <div class="stat svelte-ulgnqa"><span class="stat-icon svelte-ulgnqa">üìä</span> <span class="stat-value svelte-ulgnqa">${s(y(i.workflow).toFixed(0))}%</span> <span class="stat-label svelte-ulgnqa">progress</span></div></div>`)):n.push("\x3c!--[!--\x3e"),n.push("\x3c!--]--\x3e "),i.error?(n.push("\x3c!--[--\x3e"),n.push(`<div class="session-error svelte-ulgnqa"><svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM7 4h2v5H7V4zm0 6h2v2H7v-2z"></path></svg> <span>${s(i.error)}</span></div>`)):n.push("\x3c!--[!--\x3e"),n.push('\x3c!--]--\x3e <div class="session-actions svelte-ulgnqa">'),u(n,{variant:"ghost",size:"sm",onclick:s=>{var e;s.stopPropagation(),e=i.id,g.setCurrentSession(e)},children:s=>{s.push("\x3c!----\x3eView Details")},$$slots:{default:!0}}),n.push("\x3c!----\x3e "),u(n,{variant:"ghost",size:"sm",onclick:s=>{var e;s.stopPropagation(),e=i.id,confirm("Are you sure you want to delete this workflow session?")&&g.deleteSession(e)},children:s=>{s.push("\x3c!----\x3eDelete")},$$slots:{default:!0}}),n.push("\x3c!----\x3e</div></div>")}n.push("\x3c!--]--\x3e</div>")}else n.push("\x3c!--[!--\x3e"),n.push('<div class="empty-state svelte-ulgnqa"><div class="empty-icon svelte-ulgnqa">üìã</div> <p class="empty-title svelte-ulgnqa">No workflow history</p> <p class="empty-description svelte-ulgnqa">Start a workflow to see your history here.</p></div>');n.push("\x3c!--]--\x3e</div>")})}(n)},$$slots:{default:!0}})):n.push("\x3c!--[!--\x3e"),n.push('\x3c!--]--\x3e</div> <div class="right-column svelte-qayffx">'),a?(n.push("\x3c!--[--\x3e"),a.status===l.RUNNING?(n.push("\x3c!--[--\x3e"),d(n,{title:"Workflow Executing",children:e=>{a.workflow?(e.push("\x3c!--[--\x3e"),q(e,{workflow:a.workflow}),e.push(`\x3c!----\x3e <div class="workflow-progress svelte-qayffx"><div class="progress-label svelte-qayffx">Overall Progress</div> <div class="progress-bar svelte-qayffx"><div class="progress-bar-fill svelte-qayffx"${i(`width: ${o(y(a.workflow))}%`)}></div></div> <div class="progress-percent svelte-qayffx">${s(y(a.workflow).toFixed(0))}%</div></div>`)):(e.push("\x3c!--[!--\x3e"),e.push('<div class="progress-message svelte-qayffx"><div class="spinner svelte-qayffx"></div> <p class="svelte-qayffx">Initializing workflow...</p></div>')),e.push("\x3c!--]--\x3e")},$$slots:{default:!0}})):(n.push("\x3c!--[!--\x3e"),a.status===l.COMPLETED&&a.workflow?(n.push("\x3c!--[--\x3e"),d(n,{title:"Workflow Completed",children:s=>{s.push('<div class="success-state svelte-qayffx"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="svelte-qayffx"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><polyline points="22 4 12 14.01 9 11.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline></svg> <h3 class="svelte-qayffx">Workflow Executed Successfully</h3> <p class="svelte-qayffx">All agents have completed their tasks.</p></div> <div class="workflow-results svelte-qayffx">'),q(s,{workflow:a.workflow}),s.push("\x3c!----\x3e</div>")},$$slots:{default:!0}})):(n.push("\x3c!--[!--\x3e"),a.status===l.FAILED?(n.push("\x3c!--[--\x3e"),d(n,{title:"Workflow Failed",children:e=>{e.push('<div class="error-state svelte-qayffx"><svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor" class="svelte-qayffx"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM7 4h2v5H7V4zm0 6h2v2H7v-2z"></path></svg> <h3 class="svelte-qayffx">Workflow Failed</h3> '),a.error?(e.push("\x3c!--[--\x3e"),e.push(`<p class="error-message svelte-qayffx">${s(a.error)}</p>`)):e.push("\x3c!--[!--\x3e"),e.push("\x3c!--]--\x3e</div> "),a.workflow?(e.push("\x3c!--[--\x3e"),e.push('<div class="workflow-results svelte-qayffx">'),q(e,{workflow:a.workflow}),e.push("\x3c!----\x3e</div>")):e.push("\x3c!--[!--\x3e"),e.push("\x3c!--]--\x3e")},$$slots:{default:!0}})):n.push("\x3c!--[!--\x3e"),n.push("\x3c!--]--\x3e")),n.push("\x3c!--]--\x3e")),n.push("\x3c!--]--\x3e")):(n.push("\x3c!--[!--\x3e"),d(n,{title:"Welcome",children:s=>{s.push('<div class="empty-state svelte-qayffx"><div class="empty-icon svelte-qayffx">üéØ</div> <h2 class="svelte-qayffx">Create a Workflow</h2> <p class="svelte-qayffx">Design and execute multi-agent coordination workflows to handle complex tasks.</p></div>')},$$slots:{default:!0}})),n.push("\x3c!--]--\x3e</div></div></div>")},$$slots:{default:!0}})})}export{S as default};
