{"version":3,"file":"_page.svelte.js","sources":["../../../../../../src/routes/library/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { skillRegistry } from '$lib/api/skillRegistry';\n  import type { Skill } from '$lib/api/types';\n  import { Panel, Input, Select, Button, Badge, Alert } from '$lib/components';\n  import VirtualList from '$lib/components/VirtualList.svelte';\n  import { debounce } from '$lib/utils';\n\n  let skills: Skill[] = $state([]);\n  let filteredSkills: Skill[] = $state([]);\n  let loading = $state(true);\n  let error = $state<string | null>(null);\n\n  // Filter states\n  let searchQuery = $state('');\n  let debouncedSearchQuery = $state('');\n  let selectedSection = $state<string>('all');\n  let selectedCategory = $state<string>('all');\n  let selectedAccess = $state<'all' | 'PUBLIC' | 'BDS_ONLY'>('all');\n\n  // View modes\n  let viewMode = $state<'grid' | 'list'>('grid');\n  let sortBy = $state<'name' | 'section' | 'category'>('name');\n\n  // Virtual scrolling heights\n  const gridItemHeight = 300;\n  const listItemHeight = 200;\n\n  // Sections and categories (derived from skills)\n  let sections = $derived.by(() => {\n    const sectionSet = new Set(skills.map((s) => s.section));\n    return ['all', ...Array.from(sectionSet)];\n  });\n\n  let categories = $derived.by(() => {\n    const categorySet = new Set(skills.map((s) => s.category));\n    return ['all', ...Array.from(categorySet)];\n  });\n\n  // Stats\n  let stats = $derived.by(() => ({\n    total: skills.length,\n    public: skills.filter((s) => s.access === 'PUBLIC').length,\n    bdsOnly: skills.filter((s) => s.access === 'BDS_ONLY').length,\n    filtered: filteredSkills.length\n  }));\n\n  // Dropdown options\n  let sectionOptions = $derived(sections.map((s) => ({\n    value: s,\n    label: s === 'all' ? 'All Sections' : s\n  })));\n\n  let categoryOptions = $derived(categories.map((c) => ({\n    value: c,\n    label: c === 'all' ? 'All Categories' : c\n  })));\n\n  const accessOptions = [\n    { value: 'all', label: 'All Access' },\n    { value: 'PUBLIC', label: 'Public' },\n    { value: 'BDS_ONLY', label: 'BDS Only' }\n  ];\n\n  const sortOptions = [\n    { value: 'name', label: 'Name' },\n    { value: 'section', label: 'Section' },\n    { value: 'category', label: 'Category' }\n  ];\n\n  onMount(async () => {\n    try {\n      skills = await skillRegistry.getAllSkills();\n      applyFilters();\n      loading = false;\n    } catch (err) {\n      error = err instanceof Error ? err.message : 'Failed to load skills';\n      loading = false;\n    }\n  });\n\n  // Debounced search handler\n  const debouncedSearch = debounce((query: string) => {\n    debouncedSearchQuery = query;\n  }, 300);\n\n  // Filter logic\n  function applyFilters() {\n    let result = [...skills];\n\n    // Search filter\n    if (debouncedSearchQuery.trim()) {\n      const q = debouncedSearchQuery.toLowerCase();\n      result = result.filter(\n        (s) =>\n          s.name.toLowerCase().includes(q) ||\n          s.description.toLowerCase().includes(q) ||\n          s.tags.some((tag) => tag.toLowerCase().includes(q))\n      );\n    }\n\n    // Section filter\n    if (selectedSection !== 'all') {\n      result = result.filter((s) => s.section === selectedSection);\n    }\n\n    // Category filter\n    if (selectedCategory !== 'all') {\n      result = result.filter((s) => s.category === selectedCategory);\n    }\n\n    // Access filter\n    if (selectedAccess !== 'all') {\n      result = result.filter((s) => s.access === selectedAccess);\n    }\n\n    // Sort\n    result.sort((a, b) => {\n      if (sortBy === 'name') return a.name.localeCompare(b.name);\n      if (sortBy === 'section') return a.section.localeCompare(b.section);\n      if (sortBy === 'category') return a.category.localeCompare(b.category);\n      return 0;\n    });\n\n    filteredSkills = result;\n  }\n\n  // Reactive filtering\n  $effect(() => {\n    debouncedSearchQuery;\n    selectedSection;\n    selectedCategory;\n    selectedAccess;\n    sortBy;\n    applyFilters();\n  });\n\n  // Watch search query and debounce it\n  $effect(() => {\n    debouncedSearch(searchQuery);\n  });\n\n  function clearFilters() {\n    searchQuery = '';\n    debouncedSearchQuery = '';\n    selectedSection = 'all';\n    selectedCategory = 'all';\n    selectedAccess = 'all';\n  }\n</script>\n\n<div class=\"library-container\">\n  <!-- Page Header -->\n  <div class=\"page-header\">\n    <div class=\"header-content\">\n      <h1 class=\"page-title\">Skill Library</h1>\n      <div class=\"stats-row\">\n        <div class=\"stat-item\">\n          <span class=\"stat-value\">{stats.total}</span>\n          <span class=\"stat-label\">Total</span>\n        </div>\n        <div class=\"stat-item\">\n          <span class=\"stat-value success\">{stats.public}</span>\n          <span class=\"stat-label\">Public</span>\n        </div>\n        <div class=\"stat-item\">\n          <span class=\"stat-value warning\">{stats.bdsOnly}</span>\n          <span class=\"stat-label\">BDS Only</span>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Filters Panel -->\n  <Panel variant=\"bordered\" padding=\"lg\">\n    <div class=\"filters-section\">\n      <!-- Search and Dropdowns Row -->\n      <div class=\"filter-row\">\n        <Input\n          type=\"search\"\n          bind:value={searchQuery}\n          placeholder=\"Search skills by name, description, or tags...\"\n          fullWidth\n        />\n      </div>\n\n      <div class=\"filter-row\">\n        <Select\n          bind:value={selectedSection}\n          options={sectionOptions}\n          placeholder=\"All Sections\"\n          fullWidth\n        />\n        <Select\n          bind:value={selectedCategory}\n          options={categoryOptions}\n          placeholder=\"All Categories\"\n          fullWidth\n        />\n        <Select\n          bind:value={selectedAccess}\n          options={accessOptions}\n          placeholder=\"All Access\"\n          fullWidth\n        />\n        <Button variant=\"secondary\" on:click={clearFilters}>Clear</Button>\n      </div>\n\n      <!-- Controls Row -->\n      <div class=\"controls-row\">\n        <div class=\"sort-section\">\n          <Select bind:value={sortBy} options={sortOptions} />\n        </div>\n\n        <div class=\"view-section\">\n          <Button\n            variant={viewMode === 'grid' ? 'primary' : 'ghost'}\n            size=\"sm\"\n            on:click={() => (viewMode = 'grid')}\n          >\n            Grid\n          </Button>\n          <Button\n            variant={viewMode === 'list' ? 'primary' : 'ghost'}\n            size=\"sm\"\n            on:click={() => (viewMode = 'list')}\n          >\n            List\n          </Button>\n        </div>\n\n        <div class=\"result-count\">\n          <Badge variant=\"default\">{stats.filtered} skills</Badge>\n        </div>\n      </div>\n    </div>\n  </Panel>\n\n  <!-- Content -->\n  <div class=\"library-content\">\n    {#if loading}\n      <div class=\"loading-state\">\n        <div class=\"spinner\"></div>\n        <p>Loading skills...</p>\n      </div>\n    {:else if error}\n      <Alert variant=\"error\" title=\"Failed to Load Skills\">\n        {error}\n      </Alert>\n    {:else if filteredSkills.length === 0}\n      <Panel variant=\"elevated\" padding=\"lg\">\n        <div class=\"empty-state\">\n          <p class=\"empty-message\">No skills found matching your filters.</p>\n          <Button variant=\"primary\" on:click={clearFilters}>Clear Filters</Button>\n        </div>\n      </Panel>\n    {:else}\n      <div class=\"virtual-container\">\n        <VirtualList\n          items={filteredSkills}\n          itemHeight={viewMode === 'grid' ? gridItemHeight : listItemHeight}\n          height=\"calc(100vh - 400px)\"\n          gap={viewMode === 'grid' ? 24 : 16}\n        >\n          {#snippet children({ item: skill, index })}\n            <div class=\"skill-wrapper {viewMode}\">\n              <a href=\"/library/{skill.id}\" class=\"skill-link\">\n                <Panel variant=\"bordered\" padding=\"lg\">\n                  <div class=\"skill-header\">\n                    <h3 class=\"skill-name\">{skill.name}</h3>\n                    <Badge\n                      variant={skill.access === 'PUBLIC' ? 'success' : 'warning'}\n                      size=\"sm\"\n                    >\n                      {skill.access}\n                    </Badge>\n                  </div>\n\n                  <p class=\"skill-description\">{skill.description}</p>\n\n                  <div class=\"skill-meta\">\n                    <div class=\"meta-item\">\n                      <span class=\"meta-label\">Section:</span>\n                      <Badge variant=\"default\" size=\"sm\">{skill.section}</Badge>\n                    </div>\n                    <div class=\"meta-item\">\n                      <span class=\"meta-label\">Category:</span>\n                      <Badge variant=\"default\" size=\"sm\">{skill.category}</Badge>\n                    </div>\n                  </div>\n\n                  <div class=\"skill-tags\">\n                    {#each skill.tags.slice(0, 4) as tag}\n                      <Badge variant=\"info\" size=\"sm\" outline>{tag}</Badge>\n                    {/each}\n                    {#if skill.tags.length > 4}\n                      <span class=\"tag-more\">+{skill.tags.length - 4}</span>\n                    {/if}\n                  </div>\n\n                  <div class=\"skill-footer\">\n                    <div class=\"cost-info\">\n                      <span class=\"cost-label\">Est. Cost:</span>\n                      <Badge variant=\"accent\" size=\"sm\">\n                        ${skill.estimatedCost.min.toFixed(3)} - ${skill.estimatedCost.max.toFixed(3)}\n                      </Badge>\n                    </div>\n                  </div>\n                </Panel>\n              </a>\n            </div>\n          {/snippet}\n        </VirtualList>\n      </div>\n    {/if}\n  </div>\n</div>\n\n<style>\n  /* ═══════════════════════════════════════════════════════════════════════\n     Library Container\n     ═══════════════════════════════════════════════════════════════════════ */\n\n  .library-container {\n    max-width: 1400px;\n    margin: 0 auto;\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-xl);\n  }\n\n  /* Page Header */\n  .page-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    gap: var(--spacing-lg);\n  }\n\n  .header-content {\n    flex: 1;\n  }\n\n  .page-title {\n    font-family: var(--font-family-heading);\n    font-size: 2.5rem;\n    font-weight: 300;\n    color: var(--color-text-primary);\n    margin: 0 0 var(--spacing-lg) 0;\n    letter-spacing: 0.02em;\n  }\n\n  .stats-row {\n    display: flex;\n    gap: var(--spacing-xl);\n  }\n\n  .stat-item {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-xs);\n  }\n\n  .stat-value {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--color-text-primary);\n    font-family: var(--font-family-mono);\n  }\n\n  .stat-value.success {\n    color: var(--color-success);\n  }\n\n  .stat-value.warning {\n    color: var(--color-warning);\n  }\n\n  .stat-label {\n    font-size: 0.75rem;\n    color: var(--color-text-tertiary);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n  }\n\n  /* Filters Section */\n  .filters-section {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .filter-row {\n    display: flex;\n    gap: var(--spacing-md);\n    align-items: center;\n  }\n\n  .controls-row {\n    display: flex;\n    gap: var(--spacing-md);\n    align-items: center;\n  }\n\n  .sort-section {\n    display: flex;\n    gap: var(--spacing-sm);\n    align-items: center;\n  }\n\n  .view-section {\n    display: flex;\n    gap: var(--spacing-xs);\n    margin-left: auto;\n  }\n\n  .result-count {\n    margin-left: var(--spacing-md);\n  }\n\n  /* Library Content */\n  .library-content {\n    flex: 1;\n  }\n\n  .loading-state,\n  .empty-state {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: var(--spacing-lg);\n    padding: var(--spacing-3xl) var(--spacing-xl);\n    text-align: center;\n  }\n\n  .spinner {\n    width: 48px;\n    height: 48px;\n    border: 4px solid var(--color-border-subtle);\n    border-top-color: var(--color-brass);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n  }\n\n  @keyframes spin {\n    to {\n      transform: rotate(360deg);\n    }\n  }\n\n  .empty-message {\n    font-size: 1.125rem;\n    color: var(--color-text-secondary);\n    margin: 0;\n  }\n\n  /* Virtual Container */\n  .virtual-container {\n    width: 100%;\n  }\n\n  /* Skill Wrapper - handles grid/list layout within virtual items */\n  .skill-wrapper {\n    width: 100%;\n    height: 100%;\n  }\n\n  .skill-link {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  .skill-link :global(.panel) {\n    height: 100%;\n    transition: all var(--transition-fast);\n  }\n\n  .skill-link:hover :global(.panel) {\n    transform: translateY(-4px);\n    box-shadow: var(--shadow-lg);\n    border-color: var(--color-brass);\n  }\n\n  .skill-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    gap: var(--spacing-md);\n    margin-bottom: var(--spacing-md);\n  }\n\n  .skill-name {\n    font-family: var(--font-family-heading);\n    font-size: 1.25rem;\n    font-weight: 300;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 0.02em;\n  }\n\n  .skill-description {\n    font-size: 0.9375rem;\n    color: var(--color-text-secondary);\n    line-height: 1.6;\n    margin: 0 0 var(--spacing-md) 0;\n  }\n\n  .skill-meta {\n    display: flex;\n    gap: var(--spacing-lg);\n    margin-bottom: var(--spacing-md);\n  }\n\n  .meta-item {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-xs);\n    font-size: 0.875rem;\n  }\n\n  .meta-label {\n    color: var(--color-text-tertiary);\n  }\n\n  .skill-tags {\n    display: flex;\n    gap: var(--spacing-xs);\n    flex-wrap: wrap;\n    margin-bottom: var(--spacing-md);\n  }\n\n  .tag-more {\n    font-size: 0.75rem;\n    color: var(--color-brass);\n    font-weight: 500;\n  }\n\n  .skill-footer {\n    padding-top: var(--spacing-md);\n    border-top: 1px solid var(--color-border-subtle);\n    margin-top: auto;\n  }\n\n  .cost-info {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-sm);\n    font-size: 0.875rem;\n  }\n\n  .cost-label {\n    color: var(--color-text-tertiary);\n  }\n\n  /* Responsive */\n  @media (max-width: 768px) {\n    .page-title {\n      font-size: 2rem;\n    }\n\n    .stats-row {\n      flex-direction: column;\n      gap: var(--spacing-md);\n    }\n\n    .filter-row,\n    .controls-row {\n      flex-direction: column;\n      align-items: stretch;\n    }\n\n    .view-section {\n      margin-left: 0;\n    }\n\n    .skills-grid {\n      grid-template-columns: 1fr;\n    }\n  }\n</style>\n"],"names":["skills","filteredSkills","searchQuery","selectedSection","selectedCategory","selectedAccess","sortBy","sections","sectionSet","Set","map","s","section","Array","from","categories","categorySet","category","stats","total","length","public","filter","access","bdsOnly","filtered","sectionOptions","value","label","categoryOptions","c","accessOptions","sortOptions","$.escape","$$value","variant","$$renderer","push"],"mappings":"gTAQMA,EAAe,GACfC,EAAuB,GAKvBC,EAAqB,GAErBC,EAAiC,MACjCC,EAAkC,MAClCC,EAAuD,MAIvDC,EAAiD,OAOjDC,cACIC,EAAU,IAAOC,IAAIT,EAAOU,IAAKC,GAAMA,EAAEC,UACvC,MAAA,CAAA,SAAUC,MAAMC,KAAKN,GAC/B,KAEIO,cACIC,EAAW,IAAOP,IAAIT,EAAOU,IAAKC,GAAMA,EAAEM,WACxC,MAAA,CAAA,SAAUJ,MAAMC,KAAKE,GAC/B,KAGIE,EAAK,CACPC,MAAOnB,EAAOoB,OACdC,OAAQrB,EAAOsB,OAAQX,GAAmB,WAAbA,EAAEY,QAAqBH,OACpDI,QAASxB,EAAOsB,OAAQX,GAAmB,aAAbA,EAAEY,QAAuBH,OACvDK,SAAUxB,EAAemB,QAIvBM,EAA0BnB,EAASG,IAAKC,IAAA,CAC1CgB,MAAOhB,EACPiB,MAAa,QAANjB,EAAc,eAAiBA,KAGpCkB,EAA2Bd,EAAWL,IAAKoB,IAAA,CAC7CH,MAAOG,EACPF,MAAa,QAANE,EAAc,iBAAmBA,WAGpCC,EAAa,CACf,CAAAJ,MAAO,MAAOC,MAAO,cACrB,CAAAD,MAAO,SAAUC,MAAO,UACxB,CAAAD,MAAO,WAAYC,MAAO,aAGxBI,EAAW,CACb,CAAAL,MAAO,OAAQC,MAAO,QACtB,CAAAD,MAAO,UAAWC,MAAO,WACzB,CAAAD,MAAO,WAAYC,MAAO,yVA2FIV,EAAMC,+JAAKc,EAIHf,EAAMG,iKAAMY,EAIZf,EAAMM,iWAc5BtB,gBAAAA,EAAWgC,4FASdR,6DADGvB,gBAAAA,EAAe+B,gDAOlBL,+DADGzB,gBAAAA,EAAgB8B,gDAOnBH,2DADG1B,gBAAAA,EAAc6B,0PAWWF,qBAAjB1B,gBAAAA,EAAM4B,sFAKfC,QAAsB,mHAOtBA,QAAkC,8LASnBC,EAAAC,KAAA,gBAAAJ,EAAAf,EAAMO"}