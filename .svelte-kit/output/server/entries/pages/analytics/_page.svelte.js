import{f as e,l as s,e as t}from"../../../chunks/vendor-svelte.js";import{S as a}from"../../../chunks/Select.js";import{B as l}from"../../../chunks/Button.js";import{P as i}from"../../../chunks/Panel.js";import{B as c}from"../../../chunks/Badge.js";const r=new class{storageKey="execution_history";getHistory(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}catch(e){return[]}}filterByTimeRange(e,s){if("all"===s)return e;const t=new Date;let a;switch(s){case"24h":a=new Date(t.getTime()-864e5);break;case"7d":a=new Date(t.getTime()-6048e5);break;case"30d":a=new Date(t.getTime()-2592e6);break;default:return e}return e.filter(e=>new Date(e.timestamp)>=a)}getAnalytics(e="7d"){const s=this.getHistory(),t=this.filterByTimeRange(s,e);if(0===t.length)return this.getEmptyAnalytics();const a=t.length,l=t.filter(e=>e.success).length/a*100,i=100-l,c=t.filter(e=>void 0!==e.metadata.latency).map(e=>e.metadata.latency),r=c.length>0?c.reduce((e,s)=>e+s,0)/c.length:0,o=t.reduce((e,s)=>e+(s.metadata.cost||0),0),d=new Map;t.forEach(e=>{d.has(e.skillId)||d.set(e.skillId,{entries:[],name:e.skillName}),d.get(e.skillId).entries.push(e)});const n=Array.from(d.entries()).map(([e,{entries:s,name:t}])=>{const a=s.filter(e=>e.success).length,l=s.reduce((e,s)=>e+(s.metadata.cost||0),0),i=s.filter(e=>void 0!==e.metadata.latency).map(e=>e.metadata.latency),c=i.length>0?i.reduce((e,s)=>e+s,0)/i.length:0;return{skillId:e,skillName:t,count:s.length,successRate:a/s.length*100,avgCost:l/s.length,avgLatency:c}}).sort((e,s)=>s.count-e.count).slice(0,10),h=new Map;t.forEach(e=>{const s=e.metadata.model||"Unknown";h.has(s)||h.set(s,[]),h.get(s).push(e)});return{totalInvocations:a,successRate:l,avgResponseTime:r,totalCost:o,topSkills:n,modelUsage:Array.from(h.entries()).map(([e,s])=>{const t=s.filter(e=>e.success).length,a=s.reduce((e,s)=>e+(s.metadata.cost||0),0),l=s.filter(e=>void 0!==e.metadata.latency).map(e=>e.metadata.latency),i=l.length>0?l.reduce((e,s)=>e+s,0)/l.length:0;return{model:e,count:s.length,avgResponseTime:i,totalCost:a,successRate:t/s.length*100}}).sort((e,s)=>s.count-e.count),errorRate:i,timeSeriesData:this.generateTimeSeries(t,e),costTrend:this.generateCostTrend(t,e)}}generateTimeSeries(e,s){const t=new Map;e.forEach(e=>{const a=(e=>"24h"===s?`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:00`:`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`)(new Date(e.timestamp));t.has(a)||t.set(a,[]),t.get(a).push(e)});return Array.from(t.entries()).map(([e,s])=>({date:e,invocations:s.length,errors:s.filter(e=>!e.success).length,cost:s.reduce((e,s)=>e+(s.metadata.cost||0),0)})).sort((e,s)=>e.date.localeCompare(s.date))}generateCostTrend(e,s){const t=new Map;e.forEach(e=>{const a=(e=>"24h"===s?`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:00`:`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`)(new Date(e.timestamp));t.has(a)||t.set(a,[]),t.get(a).push(e)});return Array.from(t.entries()).map(([e,s])=>({date:e,cost:s.reduce((e,s)=>e+(s.metadata.cost||0),0),invocations:s.length})).sort((e,s)=>e.date.localeCompare(s.date))}getEmptyAnalytics(){return{totalInvocations:0,successRate:0,avgResponseTime:0,totalCost:0,topSkills:[],modelUsage:[],errorRate:0,timeSeriesData:[],costTrend:[]}}exportToCSV(e="7d"){const s=this.getAnalytics(e),t=[];return t.push("Analytics Summary"),t.push(`Time Range,${e}`),t.push(`Total Invocations,${s.totalInvocations}`),t.push(`Success Rate,${s.successRate.toFixed(2)}%`),t.push(`Error Rate,${s.errorRate.toFixed(2)}%`),t.push(`Average Response Time,${s.avgResponseTime.toFixed(3)}s`),t.push(`Total Cost,$${s.totalCost.toFixed(4)}`),t.push(""),t.push("Top Skills by Usage"),t.push("Skill ID,Skill Name,Count,Success Rate,Avg Cost,Avg Latency"),s.topSkills.forEach(e=>{t.push(`${e.skillId},${e.skillName},${e.count},${e.successRate.toFixed(2)}%,$${e.avgCost.toFixed(4)},${e.avgLatency.toFixed(3)}s`)}),t.push(""),t.push("Model Usage Breakdown"),t.push("Model,Count,Avg Response Time,Total Cost,Success Rate"),s.modelUsage.forEach(e=>{t.push(`${e.model},${e.count},${e.avgResponseTime.toFixed(3)}s,$${e.totalCost.toFixed(4)},${e.successRate.toFixed(2)}%`)}),t.push(""),t.push("Time Series Data"),t.push("Date,Invocations,Errors,Cost"),s.timeSeriesData.forEach(e=>{t.push(`${e.date},${e.invocations},${e.errors},$${e.cost.toFixed(4)}`)}),t.join("\n")}downloadCSV(e="7d"){const s=this.exportToCSV(e),t=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),l=URL.createObjectURL(t),i=(new Date).toISOString().split("T")[0];a.setAttribute("href",l),a.setAttribute("download",`vibeforge_analytics_${e}_${i}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l)}};function o(o,d){o.component(o=>{const d=import("../../../chunks/LineChart.js"),n=import("../../../chunks/BarChart.js");let h=null,v=!0,g="7d",m=!1;const u=[{value:"24h",label:"Last 24 Hours"},{value:"7d",label:"Last 7 Days"},{value:"30d",label:"Last 30 Days"},{value:"all",label:"All Time"}];function p(){m=!0,setTimeout(()=>{!function(){v=!0;try{h=r.getAnalytics(g)}catch(e){}finally{v=!1}}(),m=!1},500)}function x(){try{r.downloadCSV(g)}catch(e){alert("Failed to export CSV. Please try again.")}}function $(e){return`$${e.toFixed(4)}`}function b(e){return`${e.toFixed(1)}%`}function f(e){return e<1?`${(1e3*e).toFixed(0)}ms`:`${e.toFixed(2)}s`}function S(e){return e>=95?"success":e>=85?"warning":"error"}let y,k=h?{labels:h.timeSeriesData.map(e=>e.date),datasets:[{label:"Invocations",data:h.timeSeriesData.map(e=>e.invocations),borderColor:"rgb(197, 167, 123)",backgroundColor:"rgba(197, 167, 123, 0.1)",fill:!0,tension:.4},{label:"Errors",data:h.timeSeriesData.map(e=>e.errors),borderColor:"rgb(220, 68, 68)",backgroundColor:"rgba(220, 68, 68, 0.1)",fill:!0,tension:.4}]}:{labels:[],datasets:[]},C=h?{labels:h.costTrend.map(e=>e.date),datasets:[{label:"Cost ($)",data:h.costTrend.map(e=>e.cost),borderColor:"rgb(45, 212, 191)",backgroundColor:"rgba(45, 212, 191, 0.1)",fill:!0,tension:.4}]}:{labels:[],datasets:[]},R=h?{labels:h.topSkills.slice(0,10).map(e=>e.skillName),datasets:[{label:"Usage Count",data:h.topSkills.slice(0,10).map(e=>e.count),backgroundColor:h.topSkills.slice(0,10).map(()=>"rgba(197, 167, 123, 0.7)"),borderColor:h.topSkills.slice(0,10).map(()=>"rgb(197, 167, 123)"),borderWidth:1}]}:{labels:[],datasets:[]},T=(()=>{if(!h)return{labels:[],datasets:[]};const e=["rgba(197, 167, 123, 0.7)","rgba(45, 212, 191, 0.7)","rgba(99, 102, 241, 0.7)","rgba(236, 72, 153, 0.7)"];return{labels:h.modelUsage.map(e=>e.model),datasets:[{label:"Usage Count",data:h.modelUsage.map(e=>e.count),backgroundColor:e.slice(0,h.modelUsage.length),borderColor:e.map(e=>e.replace("0.7","1")).slice(0,h.modelUsage.length),borderWidth:1}]}})(),w=!0;function D(r){r.push('<div class="analytics-container svelte-1m0gshv"><div class="page-header svelte-1m0gshv"><div class="header-content svelte-1m0gshv"><h1 class="page-title svelte-1m0gshv">Analytics Dashboard</h1> <p class="page-description svelte-1m0gshv">Track usage, performance, and costs across all skills</p></div> <div class="header-actions svelte-1m0gshv">'),a(r,{options:u,get value(){return g},set value(e){g=e,w=!1}}),r.push("\x3c!----\x3e "),l(r,{variant:"secondary",size:"sm",onclick:p,loading:m,children:s=>{s.push(`\x3c!----\x3e${e(m?"Refreshing...":"Refresh")}`)},$$slots:{default:!0}}),r.push("\x3c!----\x3e "),l(r,{variant:"primary",size:"sm",onclick:x,children:e=>{e.push("\x3c!----\x3eExport CSV")},$$slots:{default:!0}}),r.push("\x3c!----\x3e</div></div> "),v?(r.push("\x3c!--[--\x3e"),r.push('<div class="loading-state svelte-1m0gshv"><div class="spinner svelte-1m0gshv"></div> <p>Loading analytics...</p></div>')):(r.push("\x3c!--[!--\x3e"),h&&h.totalInvocations>0?(r.push("\x3c!--[--\x3e"),r.push('<div class="metrics-grid svelte-1m0gshv">'),i(r,{variant:"bordered",padding:"lg",children:s=>{s.push(`<div class="metric-card svelte-1m0gshv"><div class="metric-icon svelte-1m0gshv">ðŸ“Š</div> <div class="metric-content svelte-1m0gshv"><div class="metric-label svelte-1m0gshv">Total Invocations</div> <div class="metric-value svelte-1m0gshv">${e(h.totalInvocations.toLocaleString())}</div></div></div>`)},$$slots:{default:!0}}),r.push("\x3c!----\x3e "),i(r,{variant:"bordered",padding:"lg",children:s=>{s.push('<div class="metric-card svelte-1m0gshv"><div class="metric-icon svelte-1m0gshv">âœ…</div> <div class="metric-content svelte-1m0gshv"><div class="metric-label svelte-1m0gshv">Success Rate</div> <div class="metric-value svelte-1m0gshv">'),c(s,{variant:S(h.successRate),children:s=>{s.push(`\x3c!----\x3e${e(b(h.successRate))}`)},$$slots:{default:!0}}),s.push("\x3c!----\x3e</div></div></div>")},$$slots:{default:!0}}),r.push("\x3c!----\x3e "),i(r,{variant:"bordered",padding:"lg",children:s=>{s.push(`<div class="metric-card svelte-1m0gshv"><div class="metric-icon svelte-1m0gshv">âš¡</div> <div class="metric-content svelte-1m0gshv"><div class="metric-label svelte-1m0gshv">Avg Response Time</div> <div class="metric-value svelte-1m0gshv">${e(f(h.avgResponseTime))}</div></div></div>`)},$$slots:{default:!0}}),r.push("\x3c!----\x3e "),i(r,{variant:"bordered",padding:"lg",children:s=>{s.push(`<div class="metric-card svelte-1m0gshv"><div class="metric-icon svelte-1m0gshv">ðŸ’°</div> <div class="metric-content svelte-1m0gshv"><div class="metric-label svelte-1m0gshv">Total Cost</div> <div class="metric-value svelte-1m0gshv">${e($(h.totalCost))}</div></div></div>`)},$$slots:{default:!0}}),r.push('\x3c!----\x3e</div> <div class="charts-row svelte-1m0gshv">'),i(r,{variant:"bordered",padding:"lg",children:e=>{e.push('<h2 class="chart-title svelte-1m0gshv">Invocations &amp; Errors Over Time</h2> '),s(e,d,()=>{e.push('<div class="chart-loading svelte-1m0gshv"><div class="spinner svelte-1m0gshv"></div> <p class="svelte-1m0gshv">Loading chart...</p></div>')},({default:s})=>{e.push("\x3c!----\x3e"),s(e,{labels:k.labels,datasets:k.datasets,height:300}),e.push("\x3c!----\x3e")}),e.push("\x3c!--]--\x3e")},$$slots:{default:!0}}),r.push('\x3c!----\x3e</div> <div class="charts-row svelte-1m0gshv">'),i(r,{variant:"bordered",padding:"lg",children:e=>{e.push('<h2 class="chart-title svelte-1m0gshv">Cost Trend</h2> '),s(e,d,()=>{e.push('<div class="chart-loading svelte-1m0gshv"><div class="spinner svelte-1m0gshv"></div> <p class="svelte-1m0gshv">Loading chart...</p></div>')},({default:s})=>{e.push("\x3c!----\x3e"),s(e,{labels:C.labels,datasets:C.datasets,height:300}),e.push("\x3c!----\x3e")}),e.push("\x3c!--]--\x3e")},$$slots:{default:!0}}),r.push('\x3c!----\x3e</div> <div class="charts-grid svelte-1m0gshv">'),i(r,{variant:"bordered",padding:"lg",children:e=>{e.push('<h2 class="chart-title svelte-1m0gshv">Top 10 Skills by Usage</h2> '),s(e,n,()=>{e.push('<div class="chart-loading svelte-1m0gshv"><div class="spinner svelte-1m0gshv"></div> <p class="svelte-1m0gshv">Loading chart...</p></div>')},({default:s})=>{e.push("\x3c!----\x3e"),s(e,{labels:R.labels,datasets:R.datasets,height:350,horizontal:!0}),e.push("\x3c!----\x3e")}),e.push("\x3c!--]--\x3e")},$$slots:{default:!0}}),r.push("\x3c!----\x3e "),i(r,{variant:"bordered",padding:"lg",children:e=>{e.push('<h2 class="chart-title svelte-1m0gshv">Model Usage Distribution</h2> '),s(e,n,()=>{e.push('<div class="chart-loading svelte-1m0gshv"><div class="spinner svelte-1m0gshv"></div> <p class="svelte-1m0gshv">Loading chart...</p></div>')},({default:s})=>{e.push("\x3c!----\x3e"),s(e,{labels:T.labels,datasets:T.datasets,height:350}),e.push("\x3c!----\x3e")}),e.push("\x3c!--]--\x3e")},$$slots:{default:!0}}),r.push("\x3c!----\x3e</div> "),i(r,{variant:"bordered",padding:"lg",children:s=>{s.push('<h2 class="section-title svelte-1m0gshv">Top Skills by Usage</h2> <div class="table-container svelte-1m0gshv"><table class="skills-table svelte-1m0gshv"><thead><tr class="svelte-1m0gshv"><th class="svelte-1m0gshv">Rank</th><th class="svelte-1m0gshv">Skill</th><th class="text-right svelte-1m0gshv">Usage</th><th class="text-right svelte-1m0gshv">Success Rate</th><th class="text-right svelte-1m0gshv">Avg Cost</th><th class="text-right svelte-1m0gshv">Avg Latency</th></tr></thead><tbody>\x3c!--[--\x3e');const a=t(h.topSkills.slice(0,10));for(let t=0,l=a.length;t<l;t++){let l=a[t];s.push('<tr class="svelte-1m0gshv"><td class="svelte-1m0gshv">'),c(s,{variant:"default",children:s=>{s.push(`\x3c!----\x3e${e(t+1)}`)},$$slots:{default:!0}}),s.push(`\x3c!----\x3e</td><td class="svelte-1m0gshv"><div class="skill-name svelte-1m0gshv">${e(l.skillName)}</div> <div class="skill-id svelte-1m0gshv">${e(l.skillId)}</div></td><td class="text-right svelte-1m0gshv">${e(l.count)}</td><td class="text-right svelte-1m0gshv">`),c(s,{variant:S(l.successRate),children:s=>{s.push(`\x3c!----\x3e${e(b(l.successRate))}`)},$$slots:{default:!0}}),s.push(`\x3c!----\x3e</td><td class="text-right svelte-1m0gshv">${e($(l.avgCost))}</td><td class="text-right svelte-1m0gshv">${e(f(l.avgLatency))}</td></tr>`)}s.push("\x3c!--]--\x3e</tbody></table></div>")},$$slots:{default:!0}}),r.push("\x3c!----\x3e "),i(r,{variant:"bordered",padding:"lg",children:s=>{s.push('<h2 class="section-title svelte-1m0gshv">Model Usage Statistics</h2> <div class="table-container svelte-1m0gshv"><table class="skills-table svelte-1m0gshv"><thead><tr class="svelte-1m0gshv"><th class="svelte-1m0gshv">Model</th><th class="text-right svelte-1m0gshv">Usage</th><th class="text-right svelte-1m0gshv">Success Rate</th><th class="text-right svelte-1m0gshv">Avg Response Time</th><th class="text-right svelte-1m0gshv">Total Cost</th></tr></thead><tbody>\x3c!--[--\x3e');const a=t(h.modelUsage);for(let t=0,l=a.length;t<l;t++){let l=a[t];s.push(`<tr class="svelte-1m0gshv"><td class="svelte-1m0gshv"><div class="model-name svelte-1m0gshv">${e(l.model)}</div></td><td class="text-right svelte-1m0gshv">${e(l.count)}</td><td class="text-right svelte-1m0gshv">`),c(s,{variant:S(l.successRate),children:s=>{s.push(`\x3c!----\x3e${e(b(l.successRate))}`)},$$slots:{default:!0}}),s.push(`\x3c!----\x3e</td><td class="text-right svelte-1m0gshv">${e(f(l.avgResponseTime))}</td><td class="text-right svelte-1m0gshv">${e($(l.totalCost))}</td></tr>`)}s.push("\x3c!--]--\x3e</tbody></table></div>")},$$slots:{default:!0}}),r.push("\x3c!----\x3e")):(r.push("\x3c!--[!--\x3e"),i(r,{variant:"elevated",padding:"lg",children:e=>{e.push('<div class="empty-state svelte-1m0gshv"><div class="empty-icon svelte-1m0gshv">ðŸ“Š</div> <h2 class="empty-title svelte-1m0gshv">No Analytics Data Available</h2> <p class="empty-message svelte-1m0gshv">Start using skills to see analytics and insights. Your usage statistics will appear here.</p> '),l(e,{variant:"primary",href:"/library",children:e=>{e.push("\x3c!----\x3eBrowse Skills")},$$slots:{default:!0}}),e.push("\x3c!----\x3e</div>")},$$slots:{default:!0}})),r.push("\x3c!--]--\x3e")),r.push("\x3c!--]--\x3e</div>")}do{w=!0,y=o.copy(),D(y)}while(!w);o.subsume(y)})}export{o as default};
