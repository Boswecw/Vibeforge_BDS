{"version":3,"file":"_page.svelte.js","sources":["../../../../../../src/routes/history/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { Panel, Input, Select, Button, Badge, Alert } from '$lib/components';\n  import VirtualList from '$lib/components/VirtualList.svelte';\n\n  interface HistoryEntry {\n    id: string;\n    timestamp: string;\n    skillId: string;\n    skillName: string;\n    section: string;\n    category: string;\n    inputs: Record<string, any>;\n    output: string;\n    metadata: {\n      sessionId?: string;\n      tokensUsed?: number;\n      cost?: number;\n      latency?: number;\n      model?: string;\n    };\n    success: boolean;\n    error?: string;\n  }\n\n  let history: HistoryEntry[] = $state([]);\n  let filteredHistory: HistoryEntry[] = $state([]);\n  let loading = $state(true);\n  let searchQuery = $state('');\n  let filterSection = $state('all');\n  let filterStatus = $state('all');\n  let sortBy = $state('recent');\n  let expandedId: string | null = $state(null);\n\n  // Virtual scrolling configuration\n  const collapsedItemHeight = 100;\n  const expandedItemHeight = 600; // Approximate height when expanded\n\n  const sections = $derived(Array.from(new Set(history.map((entry) => entry.section))).sort());\n\n  const sectionOptions = $derived([\n    { value: 'all', label: 'All Sections' },\n    ...sections.map((s) => ({ value: s, label: s }))\n  ]);\n\n  const statusOptions = [\n    { value: 'all', label: 'All Status' },\n    { value: 'success', label: 'Success Only' },\n    { value: 'error', label: 'Errors Only' }\n  ];\n\n  const sortOptions = [\n    { value: 'recent', label: 'Most Recent' },\n    { value: 'oldest', label: 'Oldest First' },\n    { value: 'name', label: 'Skill Name' },\n    { value: 'cost', label: 'Highest Cost' }\n  ];\n\n  onMount(() => {\n    loadHistory();\n    loading = false;\n  });\n\n  function loadHistory() {\n    const stored = localStorage.getItem('execution_history');\n    if (stored) {\n      try {\n        history = JSON.parse(stored);\n        applyFilters();\n      } catch (error) {\n        console.error('Failed to load history:', error);\n        history = [];\n      }\n    }\n  }\n\n  function applyFilters() {\n    let filtered = [...history];\n\n    if (searchQuery) {\n      const q = searchQuery.toLowerCase();\n      filtered = filtered.filter(\n        (entry) =>\n          entry.skillName.toLowerCase().includes(q) ||\n          entry.section.toLowerCase().includes(q) ||\n          entry.category.toLowerCase().includes(q)\n      );\n    }\n\n    if (filterSection !== 'all') {\n      filtered = filtered.filter((entry) => entry.section === filterSection);\n    }\n\n    if (filterStatus !== 'all') {\n      const isSuccess = filterStatus === 'success';\n      filtered = filtered.filter((entry) => entry.success === isSuccess);\n    }\n\n    filtered.sort((a, b) => {\n      switch (sortBy) {\n        case 'recent':\n          return new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime();\n        case 'oldest':\n          return new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime();\n        case 'name':\n          return a.skillName.localeCompare(b.skillName);\n        case 'cost':\n          return (b.metadata.cost || 0) - (a.metadata.cost || 0);\n        default:\n          return 0;\n      }\n    });\n\n    filteredHistory = filtered;\n  }\n\n  $effect(() => {\n    searchQuery;\n    filterSection;\n    filterStatus;\n    sortBy;\n    applyFilters();\n  });\n\n  function toggleExpand(id: string) {\n    expandedId = expandedId === id ? null : id;\n  }\n\n  function clearHistory() {\n    if (confirm('Are you sure you want to clear all execution history?')) {\n      localStorage.removeItem('execution_history');\n      history = [];\n      filteredHistory = [];\n    }\n  }\n\n  function deleteEntry(id: string) {\n    history = history.filter((entry) => entry.id !== id);\n    localStorage.setItem('execution_history', JSON.stringify(history));\n    applyFilters();\n  }\n\n  function formatDate(timestamp: string): string {\n    return new Date(timestamp).toLocaleString();\n  }\n\n  function formatCost(cost?: number): string {\n    return cost !== undefined ? `$${cost.toFixed(4)}` : 'N/A';\n  }\n\n  function formatLatency(latency?: number): string {\n    return latency !== undefined ? `${latency}ms` : 'N/A';\n  }\n</script>\n\n<div class=\"history-container\">\n  <div class=\"page-header\">\n    <div class=\"header-content\">\n      <h1 class=\"page-title\">Execution History</h1>\n      <p class=\"page-description\">{filteredHistory.length} execution entries</p>\n    </div>\n    {#if history.length > 0}\n      <Button variant=\"danger\" on:click={clearHistory}>Clear All History</Button>\n    {/if}\n  </div>\n\n  {#if history.length > 0}\n    <Panel variant=\"bordered\" padding=\"lg\">\n      <div class=\"filters-section\">\n        <Input\n          type=\"search\"\n          bind:value={searchQuery}\n          placeholder=\"Search by skill name, section, or category...\"\n          fullWidth\n        />\n\n        <div class=\"filter-row\">\n          <Select bind:value={filterSection} options={sectionOptions} fullWidth />\n          <Select bind:value={filterStatus} options={statusOptions} fullWidth />\n          <Select bind:value={sortBy} options={sortOptions} fullWidth />\n        </div>\n      </div>\n    </Panel>\n  {/if}\n\n  {#if loading}\n    <div class=\"loading-state\">\n      <div class=\"spinner\"></div>\n      <p>Loading history...</p>\n    </div>\n  {:else if filteredHistory.length === 0}\n    <Panel variant=\"elevated\" padding=\"lg\">\n      <div class=\"empty-state\">\n        <div class=\"empty-icon\">ðŸ“‹</div>\n        <p class=\"empty-message\">No execution history found</p>\n        <p class=\"empty-hint\">\n          {searchQuery || filterSection !== 'all' || filterStatus !== 'all'\n            ? 'Try adjusting your filters'\n            : 'Execute skills to see them appear here'}\n        </p>\n      </div>\n    </Panel>\n  {:else}\n    <div class=\"virtual-container\">\n      <VirtualList\n        items={filteredHistory}\n        itemHeight={collapsedItemHeight}\n        height=\"calc(100vh - 400px)\"\n        gap={16}\n      >\n        {#snippet children({ item: entry, index })}\n          <div class=\"history-item-wrapper\">\n            <Panel variant=\"bordered\" padding=\"none\">\n              <button class=\"entry-header\" onclick={() => toggleExpand(entry.id)}>\n                <div class=\"entry-info\">\n                  <div class=\"entry-title\">\n                    <span class=\"skill-name\">{entry.skillName}</span>\n                    <Badge variant={entry.success ? 'success' : 'error'} size=\"sm\">\n                      {entry.success ? 'Success' : 'Error'}\n                    </Badge>\n                  </div>\n                  <div class=\"entry-meta\">\n                    <span>{formatDate(entry.timestamp)}</span>\n                    <span class=\"separator\">â€¢</span>\n                    <Badge variant=\"default\" size=\"sm\">{entry.section}</Badge>\n                    <span class=\"separator\">â€¢</span>\n                    <Badge variant=\"default\" size=\"sm\">{entry.category}</Badge>\n                    {#if entry.metadata.cost}\n                      <span class=\"separator\">â€¢</span>\n                      <Badge variant=\"accent\" size=\"sm\">{formatCost(entry.metadata.cost)}</Badge>\n                    {/if}\n                  </div>\n                </div>\n                <span class=\"expand-icon\">{expandedId === entry.id ? 'â–¼' : 'â–¶'}</span>\n              </button>\n\n              {#if expandedId === entry.id}\n                <div class=\"entry-details\">\n                  {#if entry.metadata}\n                    <div class=\"details-section\">\n                      <h3 class=\"section-title\">Metadata</h3>\n                      <div class=\"metadata-grid\">\n                        {#if entry.metadata.sessionId}\n                          <div class=\"meta-item\">\n                            <span class=\"meta-label\">Session ID</span>\n                            <code>{entry.metadata.sessionId}</code>\n                          </div>\n                        {/if}\n                        {#if entry.metadata.model}\n                          <div class=\"meta-item\">\n                            <span class=\"meta-label\">Model</span>\n                            <code>{entry.metadata.model}</code>\n                          </div>\n                        {/if}\n                        {#if entry.metadata.tokensUsed}\n                          <div class=\"meta-item\">\n                            <span class=\"meta-label\">Tokens</span>\n                            <code>{entry.metadata.tokensUsed}</code>\n                          </div>\n                        {/if}\n                        {#if entry.metadata.latency}\n                          <div class=\"meta-item\">\n                            <span class=\"meta-label\">Latency</span>\n                            <code>{formatLatency(entry.metadata.latency)}</code>\n                          </div>\n                        {/if}\n                      </div>\n                    </div>\n                  {/if}\n\n                  {#if Object.keys(entry.inputs).length > 0}\n                    <div class=\"details-section\">\n                      <h3 class=\"section-title\">Inputs</h3>\n                      <pre class=\"code-block\">{JSON.stringify(entry.inputs, null, 2)}</pre>\n                    </div>\n                  {/if}\n\n                  <div class=\"details-section\">\n                    <h3 class=\"section-title\">{entry.success ? 'Output' : 'Error'}</h3>\n                    {#if entry.success}\n                      <div class=\"output-box\">{entry.output}</div>\n                    {:else}\n                      <Alert variant=\"error\">{entry.error || 'Unknown error occurred'}</Alert>\n                    {/if}\n                  </div>\n\n                  <div class=\"entry-actions\">\n                    <Button variant=\"danger\" size=\"sm\" on:click={() => deleteEntry(entry.id)}>\n                      Delete Entry\n                    </Button>\n                  </div>\n                </div>\n              {/if}\n            </Panel>\n          </div>\n        {/snippet}\n      </VirtualList>\n    </div>\n  {/if}\n</div>\n\n<style>\n  .history-container {\n    max-width: 1200px;\n    margin: 0 auto;\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-xl);\n  }\n\n  .page-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    gap: var(--spacing-lg);\n  }\n\n  .header-content {\n    flex: 1;\n  }\n\n  .page-title {\n    font-family: var(--font-family-heading);\n    font-size: 2.5rem;\n    font-weight: 300;\n    color: var(--color-text-primary);\n    margin: 0 0 var(--spacing-sm) 0;\n    letter-spacing: 0.02em;\n  }\n\n  .page-description {\n    font-size: 1.125rem;\n    color: var(--color-text-tertiary);\n    margin: 0;\n  }\n\n  .filters-section {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .filter-row {\n    display: flex;\n    gap: var(--spacing-md);\n  }\n\n  .loading-state,\n  .empty-state {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: var(--spacing-lg);\n    padding: var(--spacing-3xl) var(--spacing-xl);\n    text-align: center;\n  }\n\n  .spinner {\n    width: 48px;\n    height: 48px;\n    border: 4px solid var(--color-border-subtle);\n    border-top-color: var(--color-brass);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n  }\n\n  @keyframes spin {\n    to {\n      transform: rotate(360deg);\n    }\n  }\n\n  .empty-icon {\n    font-size: 4rem;\n  }\n\n  .empty-message {\n    font-size: 1.125rem;\n    color: var(--color-text-secondary);\n    margin: 0;\n  }\n\n  .empty-hint {\n    font-size: 0.875rem;\n    color: var(--color-text-tertiary);\n    margin: 0;\n  }\n\n  .virtual-container {\n    width: 100%;\n  }\n\n  .history-item-wrapper {\n    width: 100%;\n    height: 100%;\n  }\n\n  .entry-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: var(--spacing-lg);\n    background: transparent;\n    border: none;\n    width: 100%;\n    text-align: left;\n    cursor: pointer;\n    transition: background-color var(--transition-fast);\n  }\n\n  .entry-header:hover {\n    background-color: var(--color-surface-3);\n  }\n\n  .entry-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-sm);\n  }\n\n  .entry-title {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n  }\n\n  .skill-name {\n    font-family: var(--font-family-heading);\n    font-size: 1.125rem;\n    font-weight: 300;\n    color: var(--color-text-primary);\n    letter-spacing: 0.02em;\n  }\n\n  .entry-meta {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-sm);\n    font-size: 0.75rem;\n    color: var(--color-text-tertiary);\n  }\n\n  .separator {\n    color: var(--color-border-default);\n  }\n\n  .expand-icon {\n    font-size: 1rem;\n    color: var(--color-text-tertiary);\n  }\n\n  .entry-details {\n    padding: 0 var(--spacing-lg) var(--spacing-lg);\n    border-top: 1px solid var(--color-border-subtle);\n  }\n\n  .details-section {\n    margin-top: var(--spacing-lg);\n  }\n\n  .section-title {\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: var(--color-text-secondary);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n    margin: 0 0 var(--spacing-md) 0;\n  }\n\n  .metadata-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: var(--spacing-md);\n  }\n\n  .meta-item {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-xs);\n  }\n\n  .meta-label {\n    font-size: 0.75rem;\n    color: var(--color-text-tertiary);\n  }\n\n  code {\n    font-family: var(--font-family-mono);\n    font-size: 0.875rem;\n    color: var(--color-text-primary);\n  }\n\n  .code-block {\n    background-color: var(--color-surface-1);\n    border: 1px solid var(--color-border-subtle);\n    border-radius: var(--radius-md);\n    padding: var(--spacing-md);\n    overflow-x: auto;\n    font-family: var(--font-family-mono);\n    font-size: 0.75rem;\n    line-height: 1.5;\n    color: var(--color-text-secondary);\n    margin: 0;\n  }\n\n  .output-box {\n    background-color: var(--color-surface-3);\n    border-radius: var(--radius-md);\n    padding: var(--spacing-md);\n    color: var(--color-text-primary);\n    white-space: pre-wrap;\n    font-size: 0.875rem;\n    line-height: 1.6;\n    max-height: 400px;\n    overflow-y: auto;\n  }\n\n  .entry-actions {\n    margin-top: var(--spacing-lg);\n    display: flex;\n    gap: var(--spacing-md);\n  }\n\n  .pagination {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: var(--spacing-lg);\n    padding: var(--spacing-lg) 0;\n  }\n\n  @media (max-width: 768px) {\n    .page-title {\n      font-size: 2rem;\n    }\n\n    .filter-row {\n      flex-direction: column;\n    }\n\n    .entry-meta {\n      flex-wrap: wrap;\n    }\n  }\n</style>\n"],"names":["history","filteredHistory","searchQuery","filterSection","filterStatus","sortBy","sectionOptions","value","label","Array","from","Set","map","entry","section","sort","s","statusOptions","sortOptions","$$renderer","push","$.escape","length","$$value"],"mappings":"+QAyBMA,EAAuB,GACvBC,EAA+B,GAE/BC,EAAqB,GACrBC,EAAuB,MACvBC,EAAsB,MACtBC,EAAgB,SAOd,MAEAC,EAAc,CAChB,CAAAC,MAAO,MAAOC,MAAO,mBAHCC,MAAMC,KAAI,IAAKC,IAAIX,EAAQY,IAAKC,GAAUA,EAAMC,WAAWC,OAIvEH,IAAKI,IAAA,CAAST,MAAOS,EAAGR,MAAOQ,MAGvCC,EAAa,CACf,CAAAV,MAAO,MAAOC,MAAO,cACrB,CAAAD,MAAO,UAAWC,MAAO,gBACzB,CAAAD,MAAO,QAASC,MAAO,gBAGrBU,EAAW,CACb,CAAAX,MAAO,SAAUC,MAAO,eACxB,CAAAD,MAAO,SAAUC,MAAO,gBACxB,CAAAD,MAAO,OAAQC,MAAO,cACtB,CAAAD,MAAO,OAAQC,MAAO,0CAwGOW,EAAAC,KAAA,4OAAAC,EAAApB,EAAgBqB,wCAE1CtB,EAAQsB,OAAS,2LAKnBtB,EAAQsB,OAAS,oPAKFpB,gBAAAA,EAAWqB,uFAMqBjB,kCAAxBH,gBAAAA,EAAaoB,gDACUN,kCAAvBb,gBAAAA,EAAYmB,gDACKL,kCAAjBb,gBAAAA,EAAMkB"}