var t=Object.defineProperty,e=(e,a,s)=>((e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s)(e,"symbol"!=typeof a?a+"":a,s);import{b as a,c as s}from"./Be9ROwSi.js";var n=(t=>(t.PLAN="PLAN",t.ACT="ACT",t.OBSERVE="OBSERVE",t.REFLECT="REFLECT",t.TRANSITION="TRANSITION",t))(n||{}),r=(t=>(t.PENDING="PENDING",t.RUNNING="RUNNING",t.COMPLETED="COMPLETED",t.FAILED="FAILED",t.CANCELLED="CANCELLED",t))(r||{}),c=(t=>(t.PENDING="PENDING",t.RUNNING="RUNNING",t.COMPLETED="COMPLETED",t.FAILED="FAILED",t.PARTIAL="PARTIAL",t))(c||{});const o=new class{constructor(){e(this,"activeStreams",new Map)}subscribe(t,e={}){const{onChunk:n,onStageStart:r,onStageEnd:c,onComplete:o,onError:i,reconnect:l=!0,reconnectDelay:E=3e3,maxReconnectAttempts:d=5}=e;let u=null,N=0,p=!1,L=!1,S=null;const m=()=>{if(!L)try{u=new EventSource(t),this.activeStreams.set(t,u),u.addEventListener("chunk",t=>{if(!p&&!L)try{const e=JSON.parse(t.data);if("chunk"===e.type&&"object"==typeof e.data&&null!==e.data){const t=e.data;t.content&&n&&n(t.content)}}catch(e){}}),u.addEventListener("stage_start",t=>{if(!p&&!L)try{const e=JSON.parse(t.data);if("stage_start"===e.type&&"object"==typeof e.data&&null!==e.data){const t=e.data;t.stage&&r&&r(t.stage)}}catch(e){}}),u.addEventListener("stage_end",t=>{if(!p&&!L)try{const e=JSON.parse(t.data);if("stage_end"===e.type&&"object"==typeof e.data&&null!==e.data){const t=e.data;t.stage&&c&&c(t.stage,t.output)}}catch(e){}}),u.addEventListener("complete",t=>{if(!p&&!L)try{const e=JSON.parse(t.data);if("complete"===e.type&&"object"==typeof e.data&&null!==e.data){const t=e.data;o&&o(t.result)}}catch(e){}finally{f()}}),u.addEventListener("error",()=>{if(L)return;const e=a("Stream connection error");l&&N<d?(N++,u?.close(),this.activeStreams.delete(t),S=setTimeout(()=>{m()},E)):(i&&i(e),f())}),u.addEventListener("open",()=>{N=0})}catch(e){const t=s(e);i&&i(t),f()}},f=()=>{L=!0,p=!1,S&&(clearTimeout(S),S=null),u&&(u.close(),this.activeStreams.delete(t),u=null)};return m(),{close:f,pause:()=>{p=!0},resume:()=>{p=!1},get isActive(){return!L&&null!==u},get isPaused(){return p}}}closeAll(){this.activeStreams.forEach(t=>{t.close()}),this.activeStreams.clear()}get activeStreamCount(){return this.activeStreams.size}};export{n as P,r as S,c as W,o as s};
