var h=Object.defineProperty;var m=(e,r,t)=>r in e?h(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var c=(e,r,t)=>m(e,typeof r!="symbol"?r+"":r,t);import{R as T}from"./CJ97sMGe.js";import{_ as E}from"./Dp1pzeXC.js";function O(e){const r=u(),t=new Date;return I(e)?{...e,id:r,timestamp:t}:e instanceof Response?A(e,r,t):e instanceof TypeError?{id:r,category:"NETWORK",severity:"HIGH",message:e.message,userMessage:"Network connection error. Please check your internet connection.",timestamp:t,retryable:!0,retryAfter:5e3,originalError:e}:e instanceof Error?e.message.includes("timeout")?{id:r,category:"TIMEOUT",severity:"MEDIUM",message:e.message,userMessage:"Request timed out. Please try again.",timestamp:t,retryable:!0,retryAfter:3e3,originalError:e}:e.message.includes("not found")||e.message.includes("404")?{id:r,category:"NOT_FOUND",severity:"MEDIUM",message:e.message,userMessage:"Resource not found.",timestamp:t,retryable:!1,originalError:e}:{id:r,category:"UNKNOWN",severity:"MEDIUM",message:e.message,userMessage:"An unexpected error occurred. Please try again.",timestamp:t,retryable:!0,retryAfter:3e3,originalError:e}:typeof e=="string"?{id:r,category:"UNKNOWN",severity:"LOW",message:e,userMessage:e,timestamp:t,retryable:!0}:{id:r,category:"UNKNOWN",severity:"MEDIUM",message:"Unknown error",userMessage:"An unexpected error occurred. Please try again.",details:JSON.stringify(e),timestamp:t,retryable:!0}}function A(e,r,t){const{status:a,statusText:i}=e,n={id:r,timestamp:t,statusCode:a,details:i};if(a>=400&&a<500)switch(a){case 400:return{...n,category:"VALIDATION",severity:"LOW",message:"Invalid request",userMessage:"Invalid input. Please check your data and try again.",retryable:!1};case 401:return{...n,category:"AUTHENTICATION",severity:"HIGH",message:"Authentication required",userMessage:"You need to log in to access this resource.",retryable:!1};case 403:return{...n,category:"AUTHORIZATION",severity:"HIGH",message:"Access forbidden",userMessage:"You don't have permission to access this resource.",retryable:!1};case 404:return{...n,category:"NOT_FOUND",severity:"MEDIUM",message:"Resource not found",userMessage:"The requested resource was not found.",retryable:!1};case 429:{const l=e.headers.get("Retry-After");let o=6e4;if(l){const y=parseInt(l,10);if(!isNaN(y))o=y*1e3;else{const d=new Date(l);isNaN(d.getTime())||(o=Math.max(0,d.getTime()-Date.now()))}}return{...n,category:"RATE_LIMIT",severity:"MEDIUM",message:"Rate limit exceeded",userMessage:`Too many requests. Please wait ${Math.ceil(o/1e3)} seconds and try again.`,retryable:!0,retryAfter:o}}default:return{...n,category:"API",severity:"MEDIUM",message:`Client error: ${a}`,userMessage:"Request failed. Please check your input and try again.",retryable:!1}}return a>=500?{...n,category:"SERVER",severity:"HIGH",message:`Server error: ${a}`,userMessage:"Server error. Please try again later.",retryable:!0,retryAfter:1e4}:{...n,category:"API",severity:"MEDIUM",message:`HTTP error: ${a}`,userMessage:"Request failed. Please try again.",retryable:!0}}function D(e,r){return{id:u(),category:"NETWORK",severity:"HIGH",message:e,userMessage:"Network error. Please check your connection.",details:r,timestamp:new Date,retryable:!0,retryAfter:5e3}}function _(e,r){return{id:u(),category:"VALIDATION",severity:"LOW",message:e,userMessage:e,context:r,timestamp:new Date,retryable:!1}}function b(e){return{id:u(),category:"AUTHENTICATION",severity:"HIGH",message:e,userMessage:"Authentication required. Please log in.",timestamp:new Date,retryable:!1}}function I(e){return typeof e=="object"&&e!==null&&"category"in e&&"severity"in e&&"message"in e&&"userMessage"in e}function u(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function R(e,r,t=3){return!(!e.retryable||r>=t||e.category==="VALIDATION"||e.category==="AUTHENTICATION"||e.category==="AUTHORIZATION"||e.category==="NOT_FOUND")}function H(e,r){return e.retryAfter?e.retryAfter:Math.min(1e3*Math.pow(2,r),3e4)}function w(e,r){const t={error:e,userAgent:navigator.userAgent,url:window.location.href,...r};try{const a=JSON.parse(localStorage.getItem("vibeforge_error_log")||"[]");a.push(t),a.length>50&&a.shift(),localStorage.setItem("vibeforge_error_log",JSON.stringify(a))}catch(a){console.error("Failed to store error log:",a)}}function U(e){switch(e){case"CRITICAL":case"HIGH":return"error";case"MEDIUM":return"warning";case"LOW":return"info";default:return"info"}}const s=T({errors:[],lastError:null,dismissedErrors:new Set}),S={get errors(){return s.errors.filter(e=>!s.dismissedErrors.has(e.id))},get lastError(){return s.lastError},get hasErrors(){return s.errors.length>0},get criticalErrors(){return s.errors.filter(e=>e.severity==="CRITICAL"&&!s.dismissedErrors.has(e.id))},get highErrors(){return s.errors.filter(e=>e.severity==="HIGH"&&!s.dismissedErrors.has(e.id))},addError(e){s.errors=[...s.errors,e],s.lastError=e,w(e),e.severity==="LOW"&&setTimeout(()=>{this.dismissError(e.id)},5e3),s.errors.length>100&&(s.errors=s.errors.slice(-100))},dismissError(e){s.dismissedErrors.add(e)},clearError(e){var r;s.errors=s.errors.filter(t=>t.id!==e),s.dismissedErrors.delete(e),((r=s.lastError)==null?void 0:r.id)===e&&(s.lastError=s.errors[s.errors.length-1]||null)},clearAll(){s.errors=[],s.lastError=null,s.dismissedErrors.clear()},clearDismissed(){s.errors=s.errors.filter(e=>!s.dismissedErrors.has(e.id)),s.dismissedErrors.clear()}},g="forge_auth_tokens";function M(){return typeof window<"u"&&"__TAURI__"in window}async function f(){if(M())try{return(await E(()=>import("./CJ97sMGe.js").then(r=>r.af),[],import.meta.url)).invoke}catch{return null}return null}class k{constructor(){c(this,"accessToken",null);c(this,"refreshToken",null);c(this,"expiresAt",null);this.initialize().catch(r=>console.warn("TokenManager init failed:",r))}async initialize(){try{if(typeof window>"u")return;const r=await f();if(r){const t=await r("load_tokens");t&&(this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expiresAt=new Date(t.expiresAt).getTime())}else{const t=localStorage.getItem(g);if(t){const a=JSON.parse(t);this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expiresAt=new Date(a.expiresAt).getTime()}}}catch(r){console.warn("Token load failed:",r)}}async setTokens(r,t,a){if(this.accessToken=r,this.refreshToken=t,this.expiresAt=new Date(a).getTime(),!(typeof window>"u"))try{const i=await f();i?await i("save_tokens",{accessToken:r,refreshToken:t,expiresAt:a}):localStorage.setItem(g,JSON.stringify({accessToken:r,refreshToken:t,expiresAt:a}))}catch(i){throw console.error("Token save failed:",i),i}}async clearTokens(){if(this.accessToken=null,this.refreshToken=null,this.expiresAt=null,!(typeof window>"u"))try{const r=await f();r?await r("clear_tokens"):localStorage.removeItem(g)}catch(r){console.warn("Token clear failed:",r)}}getAccessToken(){return this.expiresAt&&Date.now()>=this.expiresAt-6e4?null:this.accessToken}getRefreshToken(){return this.refreshToken}isAuthenticated(){return!!this.getAccessToken()}isExpiringSoon(){return this.expiresAt?Date.now()>=this.expiresAt-3e5:!0}}const x=new k;export{O as a,_ as b,D as c,H as d,S as e,b as f,U as g,R as s,x as t};
