var b=Object.defineProperty;var N=(e,t,r)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var c=(e,t,r)=>N(e,typeof t!="symbol"?t+"":t,r);import{R as _,ac as S,T as D,p as O,k as x,d as R,i as U,g as z,q as H,h as k,j as L,f as P,m as h,e as I,r as y,c as W}from"./DkYuCCRR.js";import{_ as C}from"./Dp1pzeXC.js";function X(e){const t=g(),r=new Date;return q(e)?{...e,id:t,timestamp:r}:e instanceof Response?$(e,t,r):e instanceof TypeError?{id:t,category:"NETWORK",severity:"HIGH",message:e.message,userMessage:"Network connection error. Please check your internet connection.",timestamp:r,retryable:!0,retryAfter:5e3,originalError:e}:e instanceof Error?e.message.includes("timeout")?{id:t,category:"TIMEOUT",severity:"MEDIUM",message:e.message,userMessage:"Request timed out. Please try again.",timestamp:r,retryable:!0,retryAfter:3e3,originalError:e}:e.message.includes("not found")||e.message.includes("404")?{id:t,category:"NOT_FOUND",severity:"MEDIUM",message:e.message,userMessage:"Resource not found.",timestamp:r,retryable:!1,originalError:e}:{id:t,category:"UNKNOWN",severity:"MEDIUM",message:e.message,userMessage:"An unexpected error occurred. Please try again.",timestamp:r,retryable:!0,retryAfter:3e3,originalError:e}:typeof e=="string"?{id:t,category:"UNKNOWN",severity:"LOW",message:e,userMessage:e,timestamp:r,retryable:!0}:{id:t,category:"UNKNOWN",severity:"MEDIUM",message:"Unknown error",userMessage:"An unexpected error occurred. Please try again.",details:JSON.stringify(e),timestamp:r,retryable:!0}}function $(e,t,r){const{status:s,statusText:n}=e,i={id:t,timestamp:r,statusCode:s,details:n};if(s>=400&&s<500)switch(s){case 400:return{...i,category:"VALIDATION",severity:"LOW",message:"Invalid request",userMessage:"Invalid input. Please check your data and try again.",retryable:!1};case 401:return{...i,category:"AUTHENTICATION",severity:"HIGH",message:"Authentication required",userMessage:"You need to log in to access this resource.",retryable:!1};case 403:return{...i,category:"AUTHORIZATION",severity:"HIGH",message:"Access forbidden",userMessage:"You don't have permission to access this resource.",retryable:!1};case 404:return{...i,category:"NOT_FOUND",severity:"MEDIUM",message:"Resource not found",userMessage:"The requested resource was not found.",retryable:!1};case 429:{const o=e.headers.get("Retry-After");let u=6e4;if(o){const d=parseInt(o,10);if(!isNaN(d))u=d*1e3;else{const f=new Date(o);isNaN(f.getTime())||(u=Math.max(0,f.getTime()-Date.now()))}}return{...i,category:"RATE_LIMIT",severity:"MEDIUM",message:"Rate limit exceeded",userMessage:`Too many requests. Please wait ${Math.ceil(u/1e3)} seconds and try again.`,retryable:!0,retryAfter:u}}default:return{...i,category:"API",severity:"MEDIUM",message:`Client error: ${s}`,userMessage:"Request failed. Please check your input and try again.",retryable:!1}}return s>=500?{...i,category:"SERVER",severity:"HIGH",message:`Server error: ${s}`,userMessage:"Server error. Please try again later.",retryable:!0,retryAfter:1e4}:{...i,category:"API",severity:"MEDIUM",message:`HTTP error: ${s}`,userMessage:"Request failed. Please try again.",retryable:!0}}function ee(e,t){return{id:g(),category:"NETWORK",severity:"HIGH",message:e,userMessage:"Network error. Please check your connection.",details:t,timestamp:new Date,retryable:!0,retryAfter:5e3}}function te(e,t){return{id:g(),category:"VALIDATION",severity:"LOW",message:e,userMessage:e,context:t,timestamp:new Date,retryable:!1}}function re(e){return{id:g(),category:"AUTHENTICATION",severity:"HIGH",message:e,userMessage:"Authentication required. Please log in.",timestamp:new Date,retryable:!1}}function q(e){return typeof e=="object"&&e!==null&&"category"in e&&"severity"in e&&"message"in e&&"userMessage"in e}function g(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function se(e,t,r=3){return!(!e.retryable||t>=r||e.category==="VALIDATION"||e.category==="AUTHENTICATION"||e.category==="AUTHORIZATION"||e.category==="NOT_FOUND")}function ae(e,t){return e.retryAfter?e.retryAfter:Math.min(1e3*Math.pow(2,t),3e4)}function G(e,t){const r={error:e,userAgent:navigator.userAgent,url:window.location.href,...t};try{const s=JSON.parse(localStorage.getItem("vibeforge_error_log")||"[]");s.push(r),s.length>50&&s.shift(),localStorage.setItem("vibeforge_error_log",JSON.stringify(s))}catch(s){console.error("Failed to store error log:",s)}}function ie(e){switch(e){case"CRITICAL":case"HIGH":return"error";case"MEDIUM":return"warning";case"LOW":return"info";default:return"info"}}const a=_({errors:[],lastError:null,dismissedErrors:new Set}),ne={get errors(){return a.errors.filter(e=>!a.dismissedErrors.has(e.id))},get lastError(){return a.lastError},get hasErrors(){return a.errors.length>0},get criticalErrors(){return a.errors.filter(e=>e.severity==="CRITICAL"&&!a.dismissedErrors.has(e.id))},get highErrors(){return a.errors.filter(e=>e.severity==="HIGH"&&!a.dismissedErrors.has(e.id))},addError(e){a.errors=[...a.errors,e],a.lastError=e,G(e),e.severity==="LOW"&&setTimeout(()=>{this.dismissError(e.id)},5e3),a.errors.length>100&&(a.errors=a.errors.slice(-100))},dismissError(e){a.dismissedErrors.add(e)},clearError(e){var t;a.errors=a.errors.filter(r=>r.id!==e),a.dismissedErrors.delete(e),((t=a.lastError)==null?void 0:t.id)===e&&(a.lastError=a.errors[a.errors.length-1]||null)},clearAll(){a.errors=[],a.lastError=null,a.dismissedErrors.clear()},clearDismissed(){a.errors=a.errors.filter(e=>!a.dismissedErrors.has(e.id)),a.dismissedErrors.clear()}},v="forge_auth_tokens";function K(){return typeof window<"u"&&"__TAURI__"in window}async function m(){if(K())try{return(await C(()=>import("./DkYuCCRR.js").then(t=>t.ag),[],import.meta.url)).invoke}catch{return null}return null}class j{constructor(){c(this,"accessToken",null);c(this,"refreshToken",null);c(this,"expiresAt",null);this.initialize().catch(t=>console.warn("TokenManager init failed:",t))}async initialize(){try{if(typeof window>"u")return;const t=await m();if(t){const r=await t("load_tokens");r&&(this.accessToken=r.accessToken,this.refreshToken=r.refreshToken,this.expiresAt=new Date(r.expiresAt).getTime())}else{const r=localStorage.getItem(v);if(r){const s=JSON.parse(r);this.accessToken=s.accessToken,this.refreshToken=s.refreshToken,this.expiresAt=new Date(s.expiresAt).getTime()}}}catch(t){console.warn("Token load failed:",t)}}async setTokens(t,r,s){if(this.accessToken=t,this.refreshToken=r,this.expiresAt=new Date(s).getTime(),!(typeof window>"u"))try{const n=await m();n?await n("save_tokens",{accessToken:t,refreshToken:r,expiresAt:s}):localStorage.setItem(v,JSON.stringify({accessToken:t,refreshToken:r,expiresAt:s}))}catch(n){throw console.error("Token save failed:",n),n}}async clearTokens(){if(this.accessToken=null,this.refreshToken=null,this.expiresAt=null,!(typeof window>"u"))try{const t=await m();t?await t("clear_tokens"):localStorage.removeItem(v)}catch(t){console.warn("Token clear failed:",t)}}getAccessToken(){return this.expiresAt&&Date.now()>=this.expiresAt-6e4?null:this.accessToken}getRefreshToken(){return this.refreshToken}isAuthenticated(){return!!this.getAccessToken()}isExpiringSoon(){return this.expiresAt?Date.now()>=this.expiresAt-3e5:!0}}const oe=new j;class p{constructor(t={}){c(this,"cache");c(this,"maxSize");c(this,"ttl");c(this,"hits",0);c(this,"misses",0);this.cache=new Map,this.maxSize=t.maxSize??100,this.ttl=t.ttl??300*1e3}get(t){const r=this.cache.get(t);return r?Date.now()>r.expiresAt?(this.cache.delete(t),this.misses++,null):(this.cache.delete(t),this.cache.set(t,r),this.hits++,r.value):(this.misses++,null)}set(t,r,s){if(this.cache.has(t)&&this.cache.delete(t),this.cache.size>=this.maxSize){const o=this.cache.keys().next().value;o!==void 0&&this.cache.delete(o)}const n=s??this.ttl,i={value:r,expiresAt:Date.now()+n};this.cache.set(t,i)}has(t){const r=this.cache.get(t);return r?Date.now()>r.expiresAt?(this.cache.delete(t),!1):!0:!1}delete(t){return this.cache.delete(t)}clear(){this.cache.clear(),this.hits=0,this.misses=0}prune(){const t=Date.now();let r=0;for(const[s,n]of this.cache.entries())t>n.expiresAt&&(this.cache.delete(s),r++);return r}getStats(){return{hits:this.hits,misses:this.misses,size:this.cache.size,maxSize:this.maxSize}}getHitRate(){const t=this.hits+this.misses;return t===0?0:this.hits/t*100}keys(){return Array.from(this.cache.keys())}size(){return this.cache.size}}function ce(e,t,r){const s=[e];if(t){const n=Object.keys(t).sort().map(i=>`${i}=${JSON.stringify(t[i])}`).join("&");s.push(n)}return s.join("|")}async function le(e,t,r,s){const n=r.get(e);if(n!==null)return t().then(o=>{r.set(e,o)}).catch(o=>{console.warn(`Failed to revalidate cache for key: ${e}`,o)}),n;const i=await t();return r.set(e,i),i}new p({maxSize:100,ttl:300*1e3});const ue=new p({maxSize:50,ttl:600*1e3}),de=new p({maxSize:50,ttl:120*1e3});let l=null,w=$state(!1),V=$state(!1);async function fe(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}try{l=new S("/sw.js",{scope:"/"}),l.addEventListener("waiting",()=>{console.log("New service worker waiting to activate"),w=!0}),l.addEventListener("activated",e=>{console.log("Service worker activated"),e.isUpdate||(console.log("First time service worker activated"),V=!0)}),l.addEventListener("controlling",()=>{console.log("Service worker is now controlling"),window.location.reload()}),await l.register(),console.log("Service worker registered successfully")}catch(e){console.error("Failed to register service worker:",e)}}function F(){if(!l){console.warn("Workbox not initialized");return}l.messageSkipWaiting(),w=!1}const J={get updateAvailable(){return w}};function ge(e,t){window.addEventListener("online",()=>{console.log("App is online"),e&&e()}),window.addEventListener("offline",()=>{console.log("App is offline"),t&&t()})}var Y=P('<div class="update-banner svelte-z1ckp5"><div class="update-content svelte-z1ckp5"><div class="update-icon svelte-z1ckp5">ðŸŽ‰</div> <div class="update-text svelte-z1ckp5"><strong class="svelte-z1ckp5">New version available!</strong> <span class="svelte-z1ckp5">Click "Update" to get the latest features and improvements.</span></div> <div class="update-actions svelte-z1ckp5"><button class="btn-update svelte-z1ckp5">Update Now</button> <button class="btn-dismiss svelte-z1ckp5">Later</button></div></div></div>');function he(e,t){O(t,!0);let r=H(()=>J.updateAvailable);function s(){F()}function n(){W(r,!1)}var i=x(),o=R(i);{var u=d=>{var f=Y(),E=h(f),A=I(h(E),4),T=h(A);T.__click=s;var M=I(T,2);M.__click=n,y(A),y(E),y(f),k(d,f)};U(o,d=>{z(r)&&d(u)})}k(e,i),L()}D(["click"]);export{he as U,X as a,te as b,ee as c,se as d,ne as e,ae as f,ie as g,ue as h,ce as i,le as j,re as k,fe as r,ge as s,oe as t,de as u};
