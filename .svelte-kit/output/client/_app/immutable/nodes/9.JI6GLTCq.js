import{S as s,W as e,s as t}from"../chunks/YOoqYTui.js";import{T as a,p as n,s as r,e as i,q as o,j as l,a2 as d,r as c,G as v,H as u,P as f,I as p,i as g,g as w,y as x,z as h,A as k,k as m,x as y,Q as q,a as S,W as A,l as b,N as E,a3 as $,S as D,h as N,m as C,V as I}from"../chunks/DMG9opGF.js";import{E as _}from"../chunks/BUOzqyaV.js";import{P as L}from"../chunks/B9fUN0C4.js";import{B as P}from"../chunks/CPI7VlXT.js";import{A as W}from"../chunks/IY61Ops4.js";import{c as z,a as M}from"../chunks/Be9ROwSi.js";import{B as F}from"../chunks/Bd01I2fe.js";const O=a({sessions:[],currentSession:null,isCoordinating:!1}),j={get sessions(){return O.sessions},get currentSession(){return O.currentSession},get isCoordinating(){return O.isCoordinating},get activeSessions(){return O.sessions.filter(e=>e.status===s.RUNNING||e.status===s.PENDING)},get completedSessions(){return O.sessions.filter(e=>e.status===s.COMPLETED)},get failedSessions(){return O.sessions.filter(e=>e.status===s.FAILED)},createSession(t){const a={nodes:t.agents.map(s=>({nodeId:s.id,status:"pending",progress:0})),status:e.PENDING},n={id:`coordination_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"coordination",status:s.PENDING,createdAt:new Date,request:t,workflow:a};return O.sessions=[...O.sessions,n],O.currentSession=n,n},startSession(t){const a=O.sessions.find(s=>s.id===t);a&&(a.status=s.RUNNING,a.startedAt=new Date,a.workflow.status=e.RUNNING,a.workflow.startedAt=new Date,O.isCoordinating=!0,O.sessions=[...O.sessions])},updateNodeExecution(s,e,t){const a=O.sessions.find(e=>e.id===s);if(!a)return;const n=a.workflow.nodes.find(s=>s.nodeId===e);n&&(Object.assign(n,t),O.sessions=[...O.sessions])},startNode(s,e,t){const a=O.sessions.find(e=>e.id===s);if(!a)return;const n=a.workflow.nodes.find(s=>s.nodeId===e);n&&(n.status="running",n.sessionId=t,n.startedAt=new Date,n.progress=0,O.sessions=[...O.sessions])},updateNodeProgress(s,e,t){const a=O.sessions.find(e=>e.id===s);if(!a)return;const n=a.workflow.nodes.find(s=>s.nodeId===e);n&&(n.progress=Math.min(100,Math.max(0,t)),O.sessions=[...O.sessions])},completeNode(s,e){const t=O.sessions.find(e=>e.id===s);if(!t)return;const a=t.workflow.nodes.find(s=>s.nodeId===e);if(!a)return;a.status="completed",a.completedAt=new Date,a.progress=100;t.workflow.nodes.every(s=>"completed"===s.status)&&this.completeSession(s),O.sessions=[...O.sessions]},failNode(s,t,a){const n=O.sessions.find(e=>e.id===s);if(!n)return;const r=n.workflow.nodes.find(s=>s.nodeId===t);r&&(r.status="failed",r.completedAt=new Date,r.error=a,n.workflow.status=e.PARTIAL,O.sessions=[...O.sessions])},completeSession(t){const a=O.sessions.find(s=>s.id===t);a&&(a.status=s.COMPLETED,a.completedAt=new Date,a.workflow.status=e.COMPLETED,a.workflow.completedAt=new Date,O.isCoordinating=!1,O.sessions=[...O.sessions])},failSession(t,a){const n=O.sessions.find(s=>s.id===t);n&&(n.status=s.FAILED,n.completedAt=new Date,n.error=a,n.workflow.status=e.FAILED,n.workflow.error=a,n.workflow.completedAt=new Date,O.isCoordinating=!1,O.sessions=[...O.sessions])},cancelSession(t){const a=O.sessions.find(s=>s.id===t);a&&(a.status=s.CANCELLED,a.completedAt=new Date,a.workflow.status=e.FAILED,a.workflow.error="Workflow cancelled by user",a.workflow.completedAt=new Date,O.currentSession?.id===t&&(O.isCoordinating=!1),O.sessions=[...O.sessions])},setCurrentSession(s){if(null===s)return void(O.currentSession=null);const e=O.sessions.find(e=>e.id===s);e&&(O.currentSession=e)},deleteSession(s){O.sessions=O.sessions.filter(e=>e.id!==s),O.currentSession?.id===s&&(O.currentSession=null,O.isCoordinating=!1)},clearAll(){O.sessions=[],O.currentSession=null,O.isCoordinating=!1}};function T(s){if(!s.task||0===s.task.trim().length)return M("Task description is required");if(!s.agents||0===s.agents.length)return M("At least one agent node is required");const e=["planning","execution","evaluation"];for(const t of s.agents)if(!e.includes(t.type))return M(`Invalid agent type: ${t.type}`);return function(s,e){const t=new Map;s.forEach(s=>t.set(s.id,new Set)),e.forEach(s=>{const e=t.get(s.from);e&&e.add(s.to)});const a=new Set,n=new Set;function r(s){if(n.has(s))return!0;if(a.has(s))return!1;a.add(s),n.add(s);const e=t.get(s);if(e)for(const t of e)if(r(t))return!0;return n.delete(s),!1}for(const i of t.keys())if(r(i))return!0;return!1}(s.agents,s.dependencies||[])?M("Workflow contains circular dependencies"):null}function G(s){const e=s.agent_states.length;if(0===e)return 0;return s.agent_states.filter(s=>"completed"===s.status).length/e*100}var R=i('<label><input type="checkbox" class="svelte-1x9907x"/> <div class="agent-content svelte-1x9907x"><div class="agent-header svelte-1x9907x"><span class="agent-icon svelte-1x9907x"> </span> <span class="agent-label svelte-1x9907x"> </span></div> <div class="agent-description svelte-1x9907x"> </div></div></label>'),B=i('<div class="option-detail svelte-1x9907x"><label for="maxRetries">Max Retries:</label> <input type="number" id="maxRetries" min="1" max="10" class="svelte-1x9907x"/></div>'),H=i('<div class="workflow-request svelte-1x9907x"><div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x" for="task">Task Description</label> <textarea id="task" placeholder="Describe the multi-step task to be executed by the agent workflow..." rows="4" class="svelte-1x9907x"></textarea></div> <div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x">Agent Pipeline</label> <p class="text-muted svelte-1x9907x">Select agents to include in the workflow</p> <div class="agents-grid svelte-1x9907x"></div></div> <div class="form-section svelte-1x9907x"><label class="form-label svelte-1x9907x">Workflow Options</label> <div class="options-list svelte-1x9907x"><label class="option svelte-1x9907x"><input type="checkbox" class="svelte-1x9907x"/> <div class="option-content svelte-1x9907x"><span class="option-title svelte-1x9907x">Retry on Failure</span> <span class="option-description svelte-1x9907x">Automatically retry failed agents</span></div></label> <!></div></div> <!> <!></div>');function U(s,e){n(e,!0);let i=r(""),D=r(a(new Set(["planning","execution","evaluation"]))),N=r(!0),C=r(3),I=r(null),_=r(!1);const L=[{type:"planning",label:"Planning Agent",icon:"ðŸ“",description:"Define task strategy"},{type:"execution",label:"Execution Agent",icon:"âš¡",description:"Generate code"},{type:"evaluation",label:"Evaluator Agent",icon:"âœ“",description:"Assess quality"}];var M=H(),F=o(M),O=l(o(F),2);d(O),c(F);var G=l(F,2),U=l(o(G),4);v(U,21,()=>L,u,(s,e)=>{var t=R();let a;var n=o(t);f(n),n.__change=()=>{return s=w(e).type,w(D).has(s)?w(D).delete(s):w(D).add(s),void S(D,new Set(w(D)),!0);var s};var r=l(n,2),i=o(r),d=o(i),v=o(d,!0);c(d);var u=l(d,2),p=o(u,!0);c(u),c(i);var g=l(i,2),x=o(g,!0);c(g),c(r),c(t),h((s,r)=>{a=E(t,1,"agent-card svelte-1x9907x",null,a,s),$(n,r),k(v,w(e).icon),k(p,w(e).label),k(x,w(e).description)},[()=>({selected:w(D).has(w(e).type)}),()=>w(D).has(w(e).type)]),m(s,t)}),c(U),c(G);var V=l(G,2),Q=l(o(V),2),J=o(Q),K=o(J);f(K),p(2),c(J);var X=l(J,2),Y=s=>{var e=B(),t=l(o(e),2);f(t),c(e),q(t,()=>w(C),s=>S(C,s)),m(s,e)};g(X,s=>{w(N)&&s(Y)}),c(Q),c(V);var Z=l(V,2),ss=s=>{W(s,{variant:"error",children:(s,e)=>{p();var t=x();h(()=>k(t,w(I))),m(s,t)},$$slots:{default:!0}})};g(Z,s=>{w(I)&&s(ss)});var es=l(Z,2);{let s=y(()=>w(_)||0===w(D).size);P(es,{onclick:async function(){if(w(i).trim())if(0!==w(D).size){S(I,null),S(_,!0);try{const s=Array.from(w(D)).map((s,e)=>({id:`${s}_${e}`,type:s,status:"pending"})),e=[],a=["planning","execution","evaluation"],n=s.sort((s,e)=>a.indexOf(s.type)-a.indexOf(e.type));for(let t=1;t<n.length;t++)e.push({from:n[t-1].id,to:n[t].id});const r=await async function(s){const e=T(s);if(e)return{success:!1,error:e};try{const e=j.createSession(s);j.startSession(e.id);const a=`http://localhost:8787/api/v1/bds/workflow/${e.id}/stream`;return t.subscribe(a,{onChunk:s=>{j.appendStreamingOutput(s)},onStageStart:s=>{j.updateAgentStatus(e.id,s,"running")},onStageEnd:(s,t)=>{j.updateAgentStatus(e.id,s,"completed"),j.updateAgentOutput(e.id,s,t)},onComplete:s=>{const t=s;j.completeSession(e.id,t)},onError:s=>{j.failSession(e.id,s.message)}}),{success:!0,sessionId:e.id}}catch(I){return{success:!1,error:z(I)}}}({task:w(i),agents:s,dependencies:e,options:{parallel_execution:!1,retry_on_failure:w(N),max_retries:w(C)}});r.success||S(I,r.error?.message||"Failed to start workflow",!0)}catch(s){S(I,s instanceof Error?s.message:"An unknown error occurred",!0)}finally{S(_,!1)}}else S(I,"Select at least one agent");else S(I,"Task description is required")},get disabled(){return w(s)},fullWidth:!0,children:(s,e)=>{p();var t=x();h(()=>k(t,w(_)?"Starting Workflow...":"Start Workflow")),m(s,t)},$$slots:{default:!0}})}c(M),q(O,()=>w(i),s=>S(i,s)),A(K,()=>w(N),s=>S(N,s)),m(s,M),b()}D(["change"]);var V=i('<div class="pipeline-arrow svelte-erxgpi"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"></path></svg></div>'),Q=i('<div class="pipeline-step svelte-erxgpi"><div><div class="node-icon svelte-erxgpi"> </div> <div class="node-content svelte-erxgpi"><div class="node-title svelte-erxgpi"> </div> <!></div></div> <!></div>'),J=i('<div class="current-agent-info svelte-erxgpi"><div class="info-label svelte-erxgpi">Currently Executing:</div> <div class="info-value svelte-erxgpi"> </div></div>'),K=i('<div class="workflow-pipeline svelte-erxgpi"></div> <!>',1),X=i('<div class="empty-state svelte-erxgpi"><p class="text-muted svelte-erxgpi">No workflow visualization available</p></div>'),Y=i('<div class="workflow-visualization svelte-erxgpi"><!></div>');function Z(s,e){n(e,!0);var t=Y(),a=o(t),r=s=>{var t=K(),a=N(t);v(a,21,()=>e.workflow.agent_states,u,(s,t,a)=>{var n=Q(),r=o(n);let i;var d=o(r),v=o(d,!0);c(d);var u=l(d,2),f=o(u),q=o(f,!0);c(f);var S=l(f,2);{let s=y(()=>function(s){switch(s){case"completed":return"success";case"running":return"warning";case"failed":return"danger";default:return"neutral"}}(w(t).status));F(S,{get variant(){return w(s)},children:(s,e)=>{p();var a=x();h(s=>k(a,`${s??""} ${w(t).status??""}`),[()=>function(s){switch(s){case"completed":return"âœ…";case"running":return"â³";case"failed":return"âŒ";case"pending":return"â¸ï¸";default:return"âšª"}}(w(t).status)]),m(s,a)},$$slots:{default:!0}})}c(u),c(r);var A=l(r,2),b=s=>{var e=V();m(s,e)};g(A,s=>{a<e.workflow.agent_states.length-1&&s(b)}),c(n),h(s=>{i=E(r,1,"agent-node svelte-erxgpi",null,i,{active:"running"===w(t).status,completed:"completed"===w(t).status,failed:"failed"===w(t).status}),k(v,s),k(q,w(t).agent_id)},[()=>function(s){switch(s){case"planning":return"ðŸ“";case"execution":return"âš¡";case"evaluation":return"âœ“";default:return"ðŸ¤–"}}(w(t).agent_id.split("_")[0])]),m(s,n)}),c(a);var n=l(a,2),r=s=>{var t=J(),a=l(o(t),2),n=o(a,!0);c(a),c(t),h(()=>k(n,e.workflow.current_agent)),m(s,t)};g(n,s=>{e.workflow.current_agent&&s(r)}),m(s,t)},i=s=>{var e=X();m(s,e)};g(a,s=>{e.workflow&&e.workflow.agent_states?s(r):s(i,!1)}),c(t),m(s,t),b()}var ss=i('<div class="session-stats svelte-ulgnqa"><div class="stat svelte-ulgnqa"><span class="stat-icon svelte-ulgnqa">ðŸ¤–</span> <span class="stat-value svelte-ulgnqa"> </span> <span class="stat-label svelte-ulgnqa">agents</span></div> <div class="stat svelte-ulgnqa"><span class="stat-icon svelte-ulgnqa">ðŸ“Š</span> <span class="stat-value svelte-ulgnqa"> </span> <span class="stat-label svelte-ulgnqa">progress</span></div></div>'),es=i('<div class="session-error svelte-ulgnqa"><svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM7 4h2v5H7V4zm0 6h2v2H7v-2z"></path></svg> <span> </span></div>'),ts=i('<div role="button" tabindex="0"><div class="session-header svelte-ulgnqa"><div class="session-info svelte-ulgnqa"><span class="session-icon svelte-ulgnqa"> </span> <div class="session-title-group svelte-ulgnqa"><div class="session-title svelte-ulgnqa"> </div> <div class="session-meta svelte-ulgnqa"><span class="session-date"> </span></div></div></div> <!></div> <!> <!> <div class="session-actions svelte-ulgnqa"><!> <!></div></div>'),as=i('<div class="history-header svelte-ulgnqa"><h3 class="svelte-ulgnqa"> </h3> <!></div> <div class="sessions-list svelte-ulgnqa"></div>',1),ns=i('<div class="empty-state svelte-ulgnqa"><div class="empty-icon svelte-ulgnqa">ðŸ“‹</div> <p class="empty-title svelte-ulgnqa">No workflow history</p> <p class="empty-description svelte-ulgnqa">Start a workflow to see your history here.</p></div>'),rs=i('<div class="workflow-history svelte-ulgnqa"><!></div>');function is(e,t){n(t,!0);const a=y(()=>j.sessions);function r(s){j.setCurrentSession(s)}var i=rs(),d=o(i),f=e=>{var t=as(),n=N(t),i=o(n),d=o(i);c(i);var f=l(i,2);P(f,{variant:"ghost",size:"sm",onclick:()=>j.clearAll(),children:(s,e)=>{p();var t=x("Clear All");m(s,t)},$$slots:{default:!0}}),c(n);var q=l(n,2);v(q,21,()=>w(a),u,(e,t)=>{const a=y(()=>j.currentSession?.id===w(t).id);var n=ts();let i;n.__click=()=>r(w(t).id),n.__keydown=s=>"Enter"===s.key&&r(w(t).id);var d=o(n),v=o(d),u=o(v),f=o(u,!0);c(u);var q=l(u,2),S=o(q),A=o(S,!0);c(S);var b=l(S,2),$=o(b),D=o($,!0);c($),c(b),c(q),c(v);var N=l(v,2);{let e=y(()=>function(e){switch(e){case s.COMPLETED:return"success";case s.RUNNING:return"warning";case s.FAILED:case s.CANCELLED:return"danger";default:return"neutral"}}(w(t).status));F(N,{get variant(){return w(e)},children:(s,e)=>{p();var a=x();h(()=>k(a,w(t).status)),m(s,a)},$$slots:{default:!0}})}c(d);var C=l(d,2),I=s=>{var e=ss(),a=o(e),n=l(o(a),2),r=o(n,!0);c(n),p(2),c(a);var i=l(a,2),d=l(o(i),2),v=o(d);c(d),p(2),c(i),c(e),h(s=>{k(r,w(t).workflow.agent_states.length),k(v,`${s??""}%`)},[()=>G(w(t).workflow).toFixed(0)]),m(s,e)};g(C,s=>{w(t).workflow&&s(I)});var _=l(C,2),L=s=>{var e=es(),a=l(o(e),2),n=o(a,!0);c(a),c(e),h(()=>k(n,w(t).error)),m(s,e)};g(_,s=>{w(t).error&&s(L)});var W=l(_,2),z=o(W);P(z,{variant:"ghost",size:"sm",onclick:s=>{s.stopPropagation(),r(w(t).id)},children:(s,e)=>{p();var t=x("View Details");m(s,t)},$$slots:{default:!0}});var M=l(z,2);P(M,{variant:"ghost",size:"sm",onclick:s=>{var e;s.stopPropagation(),e=w(t).id,confirm("Are you sure you want to delete this workflow session?")&&j.deleteSession(e)},children:(s,e)=>{p();var t=x("Delete");m(s,t)},$$slots:{default:!0}}),c(W),c(n),h((s,e,t)=>{i=E(n,1,"session-card svelte-ulgnqa",null,i,{active:w(a)}),k(f,s),k(A,e),k(D,t)},[()=>function(e){switch(e){case s.COMPLETED:return"âœ…";case s.RUNNING:return"â³";case s.FAILED:return"âŒ";case s.CANCELLED:return"ðŸš«";default:return"â¸ï¸"}}(w(t).status),()=>w(t).request.task||`Workflow #${w(t).id.split("_")[1]}`,()=>{return s=w(t).createdAt,new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s);var s}]),m(e,n)}),c(q),h(()=>k(d,`Past Workflows (${w(a).length??""})`)),m(e,t)},q=s=>{var e=ns();m(s,e)};g(d,s=>{w(a).length>0?s(f):s(q,!1)}),c(i),m(e,i),b()}D(["click","keydown"]);var os=i('<!> <div class="workflow-progress svelte-qayffx"><div class="progress-label svelte-qayffx">Overall Progress</div> <div class="progress-bar svelte-qayffx"><div class="progress-bar-fill svelte-qayffx"></div></div> <div class="progress-percent svelte-qayffx"> </div></div>',1),ls=i('<div class="progress-message svelte-qayffx"><div class="spinner svelte-qayffx"></div> <p class="svelte-qayffx">Initializing workflow...</p></div>'),ds=i('<div class="success-state svelte-qayffx"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="svelte-qayffx"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><polyline points="22 4 12 14.01 9 11.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline></svg> <h3 class="svelte-qayffx">Workflow Executed Successfully</h3> <p class="svelte-qayffx">All agents have completed their tasks.</p></div> <div class="workflow-results svelte-qayffx"><!></div>',1),cs=i('<p class="error-message svelte-qayffx"> </p>'),vs=i('<div class="workflow-results svelte-qayffx"><!></div>'),us=i('<div class="error-state svelte-qayffx"><svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor" class="svelte-qayffx"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM7 4h2v5H7V4zm0 6h2v2H7v-2z"></path></svg> <h3 class="svelte-qayffx">Workflow Failed</h3> <!></div> <!>',1),fs=i('<div class="empty-state svelte-qayffx"><div class="empty-icon svelte-qayffx">ðŸŽ¯</div> <h2 class="svelte-qayffx">Create a Workflow</h2> <p class="svelte-qayffx">Design and execute multi-agent coordination workflows to handle complex tasks.</p></div>'),ps=i('<div class="coordinator-page svelte-qayffx"><header class="page-header svelte-qayffx"><h1 class="svelte-qayffx">Coordinator Agent</h1> <p class="text-muted svelte-qayffx">Orchestrate multi-agent workflows</p></header> <div class="content-grid svelte-qayffx"><div class="left-column svelte-qayffx"><!> <!></div> <div class="right-column svelte-qayffx"><!></div></div></div>');function gs(e,t){n(t,!0);const a=y(()=>j.currentSession);_(e,{children:(e,t)=>{var n=ps(),r=l(o(n),2),i=o(r),d=o(i);L(d,{title:"New Workflow",children:(s,e)=>{U(s,{})},$$slots:{default:!0}});var v=l(d,2),u=s=>{L(s,{title:"Workflow History",class:"mt-6",children:(s,e)=>{is(s,{})},$$slots:{default:!0}})};g(v,s=>{w(a)&&s(u)}),c(i);var f=l(i,2),p=o(f),x=e=>{var t=C(),n=N(t),r=s=>{L(s,{title:"Workflow Executing",children:(s,e)=>{var t=C(),n=N(t),r=s=>{var e=os(),t=N(e);Z(t,{get workflow(){return w(a).workflow}});var n=l(t,2),r=l(o(n),2),i=o(r);c(r);var d=l(r,2),v=o(d);c(d),c(n),h((s,e)=>{I(i,`width: ${s??""}%`),k(v,`${e??""}%`)},[()=>G(w(a).workflow),()=>G(w(a).workflow).toFixed(0)]),m(s,e)},i=s=>{var e=ls();m(s,e)};g(n,s=>{w(a).workflow?s(r):s(i,!1)}),m(s,t)},$$slots:{default:!0}})},i=e=>{var t=C(),n=N(t),r=s=>{L(s,{title:"Workflow Completed",children:(s,e)=>{var t=ds(),n=l(N(t),2);Z(o(n),{get workflow(){return w(a).workflow}}),c(n),m(s,t)},$$slots:{default:!0}})},i=e=>{var t=C(),n=N(t),r=s=>{L(s,{title:"Workflow Failed",children:(s,e)=>{var t=us(),n=N(t),r=l(o(n),4),i=s=>{var e=cs(),t=o(e,!0);c(e),h(()=>k(t,w(a).error)),m(s,e)};g(r,s=>{w(a).error&&s(i)}),c(n);var d=l(n,2),v=s=>{var e=vs();Z(o(e),{get workflow(){return w(a).workflow}}),c(e),m(s,e)};g(d,s=>{w(a).workflow&&s(v)}),m(s,t)},$$slots:{default:!0}})};g(n,e=>{w(a).status===s.FAILED&&e(r)},!0),m(e,t)};g(n,e=>{w(a).status===s.COMPLETED&&w(a).workflow?e(r):e(i,!1)},!0),m(e,t)};g(n,e=>{w(a).status===s.RUNNING?e(r):e(i,!1)}),m(e,t)},y=s=>{L(s,{title:"Welcome",children:(s,e)=>{var t=fs();m(s,t)},$$slots:{default:!0}})};g(p,s=>{w(a)?s(x):s(y,!1)}),c(f),c(r),c(n),m(e,n)},$$slots:{default:!0}}),b()}export{gs as component};
