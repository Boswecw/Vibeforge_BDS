import{s as e}from"../chunks/DRhfx38_.js";import{a7 as s,p as t,c as a,X as l,C as r,g as i,K as n,a as o,O as v,E as d,F as c,m as u,Q as p,$ as f,h as m,i as k,k as g,l as h,e as y,q as w,j as $,r as j,U as z,L as b,v as S,z as D,N,A as C,s as O,T as I,o as W,d as E,x as F,a8 as J,I as T,y as x,G as A,H as K,a9 as q,S as B}from"../chunks/CS1oB8eq.js";import{P as L}from"../chunks/BcpFO3YO.js";import{B as R}from"../chunks/B_xsWB_l.js";import{I as U}from"../chunks/B9KmbTeL.js";import{B as _}from"../chunks/BXiH49b8.js";import{u as M,a as P,D as G,b as H,c as Q,d as V,S as X,K as Y,P as Z,C as ee,e as se}from"../chunks/D-jDLIAh.js";import{A as te}from"../chunks/oHG5MZam.js";import{F as ae}from"../chunks/0OOX5gzM.js";import{S as le}from"../chunks/D4deE_xW.js";import{T as re}from"../chunks/CntLKQcI.js";var ie=y('<h3 class="modal-title svelte-ta60gp" id="modal-title"> </h3>'),ne=y('<div class="modal-title svelte-ta60gp"><!></div>'),oe=y('<button class="modal-close svelte-ta60gp" aria-label="Close modal">✕</button>'),ve=y('<div class="modal-footer svelte-ta60gp"><!></div>'),de=y('<div class="modal-backdrop svelte-ta60gp" role="presentation"><div role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-ta60gp"><!> <!></div> <div class="modal-body svelte-ta60gp"><!></div> <!></div></div>');var ce=y('<div><!> <div class="skill-info svelte-uujcry"><strong class="svelte-uujcry"> </strong> <p class="svelte-uujcry"> </p></div> <div class="drag-handle svelte-uujcry">⋮⋮</div></div>'),ue=y('<span class="saved-indicator svelte-uujcry"> </span>'),pe=y('<span class="unsaved-indicator svelte-uujcry">● Unsaved changes</span>'),fe=y('<div class="empty-state svelte-uujcry"><div class="empty-icon svelte-uujcry">⚡</div> <p class="svelte-uujcry">Drag skills from the library to build your workflow</p> <p class="empty-hint svelte-uujcry">You can reorder steps by dragging them</p></div>'),me=y('<div class="drag-preview svelte-uujcry"><!> <strong class="svelte-uujcry"> </strong></div>'),ke=y('<div class="drag-preview step-preview svelte-uujcry"><!> <strong class="svelte-uujcry"> </strong></div>'),ge=y('<div class="builder-content svelte-uujcry"><div class="skill-library svelte-uujcry"><h3 class="svelte-uujcry">Skill Library</h3> <p class="hint svelte-uujcry">Drag skills to the workflow canvas</p> <div class="skill-list svelte-uujcry"></div></div> <div class="workflow-canvas svelte-uujcry" id="workflow-canvas" data-droppable="true"><h3 class="svelte-uujcry"> </h3> <!></div></div> <!>',1),he=y('<li class="svelte-uujcry"> </li>'),ye=y('<li class="svelte-uujcry"> </li>'),we=y('<strong> </strong> <ul class="svelte-uujcry"><!> <!></ul>',1),$e=y('<div class="validation-errors svelte-uujcry"><!></div>'),je=y('<div class="config-modal svelte-uujcry"><div class="form-group svelte-uujcry"><!></div> <div class="form-group svelte-uujcry"><!></div> <div class="modal-actions svelte-uujcry"><!> <!></div></div>'),ze=y('<div class="workflow-builder svelte-uujcry"><div class="toolbar svelte-uujcry"><div class="toolbar-left svelte-uujcry"><h2 class="svelte-uujcry">Workflow Builder</h2> <div class="status svelte-uujcry"><!></div></div> <div class="toolbar-right svelte-uujcry"><!> <!> <!> <!></div></div> <!> <!></div> <!>',1);function be(e,y){t(y,!0);let B=a(y,"initialSteps",19,()=>[]),L=O(I([...B()])),U=O(null),be=O(null),Se=O(!1),De=O(!1),Ne=O(null),Ce=O("{}"),Oe=O(I([])),Ie=O(null),We=O(I([])),Ee=O(-1);const Fe=M(P(Z),P(Y));let Je=F(()=>i(Ee)>0),Te=F(()=>i(Ee)<i(We).length-1);function xe(e){i(Ee)<i(We).length-1&&o(We,i(We).slice(0,i(Ee)+1),!0),o(We,[...i(We),{steps:JSON.parse(JSON.stringify(e)),timestamp:Date.now()}],!0),i(We).length>20&&o(We,i(We).slice(i(We).length-20),!0),o(Ee,i(We).length-1)}function Ae(){i(Je)&&(J(Ee,-1),o(L,JSON.parse(JSON.stringify(i(We)[i(Ee)].steps)),!0))}function Ke(){i(Te)&&(J(Ee),o(L,JSON.parse(JSON.stringify(i(We)[i(Ee)].steps)),!0))}function qe(){if(!i(Ne))return;const e=i(L).findIndex(e=>e.id===i(Ne).id);if(-1!==e){let s={};try{s=JSON.parse(i(Ce))}catch{s=i(Ne).inputs}i(L)[e]={...i(Ne),inputs:s},xe(i(L))}o(De,!1),o(Ne,null),o(Ce,"{}")}W(()=>{xe(i(L))}),E(()=>{if(i(L).length>0&&y.onSave){const e=setTimeout(()=>{y.onSave(i(L)),o(Ie,new Date,!0)},1e3);return()=>clearTimeout(e)}}),E(()=>{!function(){const e=[];i(L).forEach(s=>{const t=y.skills.find(e=>e.id===s.skillId);t?.requiredInputs&&t.requiredInputs.forEach(t=>{s.inputs[t]||s.useOutputFrom||e.push({stepId:s.id,message:`Missing required input: ${t}`})})});const s=new Map(i(L).map(e=>[e.id,e]));i(L).forEach(t=>{const a=new Set;let l=t;for(;l.useOutputFrom;){if(a.has(l.id)){e.push({stepId:t.id,message:"Circular dependency detected"});break}a.add(l.id);const r=s.get(l.useOutputFrom);if(!r)break;l=r}}),o(Oe,e,!0)}()}),W(()=>{function e(e){!e.metaKey&&!e.ctrlKey||"z"!==e.key||e.shiftKey?(e.metaKey||e.ctrlKey)&&"z"===e.key&&e.shiftKey&&(e.preventDefault(),Ke()):(e.preventDefault(),Ae())}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)});var Be=ze(),Le=m(Be),Re=w(Le),Ue=w(Re),_e=$(w(Ue),2),Me=w(_e),Pe=e=>{var s=ue(),t=w(s);j(s),D(e=>C(t,`✓ Saved ${e??""}`),[()=>i(Ie).toLocaleTimeString()]),g(e,s)},Ge=e=>{var s=pe();g(e,s)};k(Me,e=>{i(Ie)?e(Pe):e(Ge,!1)}),j(_e),j(Ue);var He=$(Ue,2),Qe=w(He);{let e=F(()=>!i(Je));R(Qe,{variant:"ghost",size:"sm",onclick:Ae,get disabled(){return i(e)},children:(e,s)=>{T();var t=x("↶ Undo");g(e,t)},$$slots:{default:!0}})}var Ve=$(Qe,2);{let e=F(()=>!i(Te));R(Ve,{variant:"ghost",size:"sm",onclick:Ke,get disabled(){return i(e)},children:(e,s)=>{T();var t=x("↷ Redo");g(e,t)},$$slots:{default:!0}})}var Xe=$(Ve,2);R(Xe,{variant:"ghost",size:"sm",onclick:function(){y.onCancel&&y.onCancel()},children:(e,s)=>{T();var t=x("Cancel");g(e,t)},$$slots:{default:!0}});var Ye=$(Xe,2);R(Ye,{variant:"primary",size:"sm",onclick:function(){y.onSave&&(y.onSave(i(L)),o(Ie,new Date,!0))},children:(e,s)=>{T();var t=x("Save Workflow");g(e,t)},$$slots:{default:!0}}),j(He),j(Re);var Ze=$(Re,2);G(Ze,{get sensors(){return Fe},get collisionDetection(){return Q},onDragStart:function(e){const{active:s}=e,t=s.id;t.startsWith("skill-")?(o(U,t.replace("skill-",""),!0),o(Se,!0)):t.startsWith("step-")&&(o(be,t,!0),o(Se,!1))},onDragEnd:function(e){const{active:s,over:t}=e;if(!t)return o(U,null),o(be,null),void o(Se,!1);const a=s.id,l=t.id;if(i(Se)&&"workflow-canvas"===l){const e=y.skills.find(e=>e.id===i(U));e&&function(e){const s={id:`step-${Date.now()}`,skillId:e.id,skillName:e.name,order:i(L).length,inputs:{},useOutputFrom:i(L).length>0?i(L)[i(L).length-1].id:void 0};o(L,[...i(L),s],!0),xe(i(L))}(e)}else if(!i(Se)&&a.startsWith("step-")){const e=i(L).findIndex(e=>`step-${e.id}`===a),s=i(L).findIndex(e=>`step-${e.id}`===l);if(-1!==e&&-1!==s){const t=V(i(L),e,s);o(L,t.map((e,s)=>({...e,order:s})),!0),xe(i(L))}}o(U,null),o(be,null),o(Se,!1)},children:(e,s)=>{var t=ge(),a=m(t),l=w(a),r=$(w(l),4);A(r,21,()=>y.skills,K,(e,s)=>{((e,s)=>{let t=()=>s?.().skill;const a=F(()=>se({id:`skill-${t().id}`}));var l=ce();q(l,e=>({class:"skill-item",style:e,...i(a).attributes,...i(a).listeners}),[()=>i(a).transform?`transform: ${ee.Transform.toString(i(a).transform)}`:""],void 0,void 0,"svelte-uujcry");var r=w(l);_(r,{variant:"primary",size:"sm",children:(e,s)=>{T();var a=x();D(()=>C(a,t().category)),g(e,a)},$$slots:{default:!0}});var n=$(r,2),o=w(n),v=w(o,!0);j(o);var d=$(o,2),c=w(d,!0);j(d),j(n),T(2),j(l),D(()=>{C(v,t().name),C(c,t().description)}),g(e,l)})(e,{get skill(){return i(s)}})}),j(r),j(l);var n=$(l,2),o=w(n),v=w(o);j(o);var d=$(o,2),c=e=>{var s=fe();g(e,s)},p=e=>{X(e)};k(d,e=>{0===i(L).length?e(c):e(p,!1)}),j(n),j(a);var f=$(a,2);H(f,{children:(e,s)=>{var t=u(),a=m(t),l=e=>{const s=F(()=>y.skills.find(e=>e.id===i(U)));var t=u(),a=m(t),l=e=>{var t=me(),a=w(t);_(a,{variant:"primary",children:(e,t)=>{T();var a=x();D(()=>C(a,i(s).category)),g(e,a)},$$slots:{default:!0}});var l=$(a,2),r=w(l,!0);j(l),j(t),D(()=>C(r,i(s).name)),g(e,t)};k(a,e=>{i(s)&&e(l)}),g(e,t)},r=e=>{var s=u(),t=m(s),a=e=>{const s=F(()=>i(L).find(e=>`step-${e.id}`===i(be)));var t=u(),a=m(t),l=e=>{var t=ke(),a=w(t);_(a,{variant:"info",children:(e,t)=>{T();var a=x();D(()=>C(a,`Step ${i(s).order+1}`)),g(e,a)},$$slots:{default:!0}});var l=$(a,2),r=w(l,!0);j(l),j(t),D(()=>C(r,i(s).skillName)),g(e,t)};k(a,e=>{i(s)&&e(l)}),g(e,t)};k(t,e=>{i(be)&&e(a)},!0),g(e,s)};k(a,e=>{i(U)?e(l):e(r,!1)}),g(e,t)},$$slots:{default:!0}}),D(()=>C(v,`Workflow Steps (${i(L).length??""})`)),g(e,t)},$$slots:{default:!0}});var es=$(Ze,2),ss=e=>{var s=$e(),t=w(s);te(t,{variant:"error",children:(e,s)=>{var t=we(),a=m(t),l=w(a);j(a);var r=$(a,2),n=w(r);A(n,17,()=>i(Oe).slice(0,5),K,(e,s)=>{var t=he(),a=w(t);j(t),D(e=>C(a,`${i(s).message??""} (Step ${e??""})`),[()=>i(L).find(e=>e.id===i(s).stepId)?.order??"?"]),g(e,t)});var o=$(n,2),v=e=>{var s=ye(),t=w(s);j(s),D(()=>C(t,`...and ${i(Oe).length-5} more`)),g(e,s)};k(o,e=>{i(Oe).length>5&&e(v)}),j(r),D(()=>C(l,`Validation Errors (${i(Oe).length??""})`)),g(e,t)},$$slots:{default:!0}}),j(s),g(e,s)};k(es,e=>{i(Oe).length>0&&e(ss)}),j(Le);var ts=$(Le,2),as=e=>{!function(e,y){const O=s(y);t(y,!1);const I=n();let W=a(y,"open",12,!1),E=a(y,"title",8,""),F=a(y,"size",8,"md"),J=a(y,"closeOnBackdrop",8,!0),T=a(y,"closeOnEscape",8,!0),x=a(y,"showClose",8,!0),A=a(y,"showFooter",8,!0),K=a(y,"onClose",8,void 0);const q=l();let B=n(null),L=n();function R(e){J()&&e.target===e.currentTarget&&U()}function U(){W(!1),q("close"),K()&&K()()}r(()=>(v(W()),i(L),i(B),ae),()=>{W()&&i(L)?setTimeout(()=>{o(B,new ae(i(L))),i(B).activate()},50):!W()&&i(B)&&(i(B).deactivate(),o(B,null))}),r(()=>v(F()),()=>{o(I,{sm:"modal-sm",md:"modal-md",lg:"modal-lg",xl:"modal-xl",full:"modal-full"}[F()])}),d(),c();var _=u();p("keydown",f,function(e){T()&&"Escape"===e.key&&W()&&U()});var M=m(_),P=e=>{var s=de(),t=w(s),a=w(t),l=w(a),r=e=>{var s=ie(),t=w(s,!0);j(s),D(()=>C(t,E())),g(e,s)},n=e=>{var s=u(),t=m(s),a=e=>{var s=ne(),t=w(s);z(t,y,"header",{}),j(s),g(e,s)};k(t,e=>{b(()=>O.header)&&e(a)},!0),g(e,s)};k(l,e=>{E()?e(r):e(n,!1)});var d=$(l,2),c=e=>{var s=oe();p("click",s,U),g(e,s)};k(d,e=>{x()&&e(c)}),j(a);var f=$(a,2),h=w(f);z(h,y,"default",{}),j(f);var W=$(f,2),F=e=>{var s=ve(),t=w(s);z(t,y,"footer",{}),j(s),g(e,s)};k(W,e=>{v(A()),b(()=>A()&&O.footer)&&e(F)}),j(t),S(t,e=>o(L,e),()=>i(L)),j(s),D(()=>N(t,1,`modal ${i(I)??""}`,"svelte-ta60gp")),p("click",s,R),g(e,s)};k(M,e=>{W()&&e(P)}),g(e,_),h()}(e,{get title(){return`Configure Step: ${i(Ne).skillName??""}`},get open(){return i(De)},onClose:()=>{o(De,!1),o(Ne,null)},children:(e,s)=>{var t=je(),a=w(t),l=w(a);{let e=F(()=>[{value:"",label:"None"},...i(L).filter(e=>e.order<i(Ne).order).map(e=>({value:e.id,label:`Step ${e.order+1}: ${e.skillName}`}))]);le(l,{label:"Use output from previous step",get options(){return i(e)},get value(){return i(Ne).useOutputFrom},set value(e){i(Ne).useOutputFrom=e}})}j(a);var r=$(a,2),n=w(r);re(n,{label:"Custom Inputs (JSON)",rows:6,placeholder:'{"key": "value"}',get value(){return i(Ce)},set value(e){o(Ce,e,!0)}}),j(r);var v=$(r,2),d=w(v);R(d,{variant:"ghost",onclick:()=>{o(De,!1),o(Ne,null)},children:(e,s)=>{T();var t=x("Cancel");g(e,t)},$$slots:{default:!0}});var c=$(d,2);R(c,{variant:"primary",onclick:qe,children:(e,s)=>{T();var t=x("Save Configuration");g(e,t)},$$slots:{default:!0}}),j(v),j(t),g(e,t)},$$slots:{default:!0}})};k(ts,e=>{i(De)&&i(Ne)&&e(as)}),g(e,Be),h()}var Se=y('<div class="create-workflow-form svelte-1k5z4u1"><!> <!> <div class="form-actions svelte-1k5z4u1"><!> <!></div></div>'),De=y('<div class="empty-state svelte-1k5z4u1"><p>No workflows yet. Create your first workflow to get started.</p></div>'),Ne=y('<div role="button" tabindex="0"><div class="workflow-info svelte-1k5z4u1"><div class="workflow-name svelte-1k5z4u1"> </div> <div class="workflow-description svelte-1k5z4u1"> </div> <div class="workflow-meta svelte-1k5z4u1"><!> <span class="workflow-steps svelte-1k5z4u1"> </span></div></div> <!></div>'),Ce=y('<div class="workflows-list svelte-1k5z4u1"></div>'),Oe=y('<div class="section-header svelte-1k5z4u1"><h2 class="svelte-1k5z4u1">My Workflows</h2> <!></div> <!> <!>',1),Ie=y('<div class="no-selection svelte-1k5z4u1"><p>Select a workflow from the list to view and edit its steps.</p></div>'),We=y('<div class="workflows-container svelte-1k5z4u1"><div class="page-header svelte-1k5z4u1"><div class="header-content svelte-1k5z4u1"><h1 class="page-title svelte-1k5z4u1">Skill Workflows</h1> <p class="page-description svelte-1k5z4u1">Build multi-step workflows by chaining skills together for complex automation</p></div> <div class="stats-row svelte-1k5z4u1"><div class="stat-item svelte-1k5z4u1"><span class="stat-value svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Total</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value default svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Draft</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value success svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Active</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value warning svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Archived</span></div></div></div> <div class="content-grid svelte-1k5z4u1"><!> <!></div></div>');function Ee(s,a){t(a,!0);let l=O(I([])),r=O(I([])),n=O(!0),v=O(null),d=O(!1),c=O(""),u=O("");function p(){localStorage.setItem("workflows",JSON.stringify(i(l)))}function f(){if(!i(c).trim())return;const e={id:`wf-${Date.now()}`,name:i(c),description:i(u),steps:[],createdAt:new Date,status:"draft"};o(l,[...i(l),e],!0),p(),o(v,e,!0),o(d,!1),o(c,""),o(u,"")}W(async()=>{try{o(r,await e.getAllSkills(),!0),function(){const e=localStorage.getItem("workflows");if(e)try{const s=JSON.parse(e);o(l,s.map(e=>({...e,createdAt:new Date(e.createdAt),lastRun:e.lastRun?new Date(e.lastRun):void 0})),!0)}catch(s){o(l,[],!0)}}(),o(n,!1)}catch(s){o(n,!1)}});let y=F(()=>({total:i(l).length,draft:i(l).filter(e=>"draft"===e.status).length,active:i(l).filter(e=>"active"===e.status).length,archived:i(l).filter(e=>"archived"===e.status).length}));var z=We(),b=w(z),S=$(w(b),2),E=w(S),J=w(E),K=w(J,!0);j(J),T(2),j(E);var q=$(E,2),B=w(q),M=w(B,!0);j(B),T(2),j(q);var P=$(q,2),G=w(P),H=w(G,!0);j(G),T(2),j(P);var Q=$(P,2),V=w(Q),X=w(V,!0);j(V),T(2),j(Q),j(S),j(b);var Y=$(b,2),Z=w(Y);L(Z,{variant:"bordered",padding:"lg",children:(e,s)=>{var t=Oe(),a=m(t),r=$(w(a),2);R(r,{variant:"primary",size:"sm",get disabled(){return i(d)},$$events:{click:()=>o(d,!0)},children:(e,s)=>{T();var t=x("+ New Workflow");g(e,t)},$$slots:{default:!0}}),j(a);var n=$(a,2),h=e=>{L(e,{variant:"elevated",padding:"md",children:(e,s)=>{var t=Se(),a=w(t);U(a,{label:"Workflow Name",placeholder:"e.g., Code Review & Test",required:!0,fullWidth:!0,get value(){return i(c)},set value(e){o(c,e,!0)}});var l=$(a,2);U(l,{label:"Description",placeholder:"Describe what this workflow does...",fullWidth:!0,get value(){return i(u)},set value(e){o(u,e,!0)}});var r=$(l,2),n=w(r);{let e=F(()=>!i(c).trim());R(n,{variant:"primary",get disabled(){return i(e)},$$events:{click:f},children:(e,s)=>{T();var t=x("Create");g(e,t)},$$slots:{default:!0}})}var v=$(n,2);R(v,{variant:"ghost",$$events:{click:()=>o(d,!1)},children:(e,s)=>{T();var t=x("Cancel");g(e,t)},$$slots:{default:!0}}),j(r),j(t),g(e,t)},$$slots:{default:!0}})};k(n,e=>{i(d)&&e(h)});var y=$(n,2),z=e=>{var s=De();g(e,s)},b=e=>{var s=Ce();A(s,21,()=>i(l),e=>e.id,(e,s)=>{var t=Ne();let a;t.__click=()=>o(v,i(s),!0),t.__keydown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o(v,i(s),!0))};var r=w(t),n=w(r),d=w(n,!0);j(n);var c=$(n,2),u=w(c,!0);j(c);var f=$(c,2),m=w(f);{let e=F(()=>({draft:"default",active:"success",archived:"warning"}[i(s).status]));_(m,{get variant(){return i(e)},size:"sm",children:(e,t)=>{T();var a=x();D(()=>C(a,i(s).status)),g(e,a)},$$slots:{default:!0}})}var k=$(m,2),h=w(k);j(k),j(f),j(r);var y=$(r,2);R(y,{variant:"danger",size:"sm",$$events:{click:e=>{var t;e.stopPropagation(),t=i(s).id,o(l,i(l).filter(e=>e.id!==t),!0),p(),i(v)?.id===t&&o(v,null)}},children:(e,s)=>{T();var t=x("Delete");g(e,t)},$$slots:{default:!0}}),j(t),D(()=>{a=N(t,1,"workflow-item svelte-1k5z4u1",null,a,{selected:i(v)?.id===i(s).id}),C(d,i(s).name),C(u,i(s).description||"No description"),C(h,`${i(s).steps.length??""} steps`)}),g(e,t)}),j(s),g(e,s)};k(y,e=>{0===i(l).length?e(z):e(b,!1)}),g(e,t)},$$slots:{default:!0}});var ee=$(Z,2),se=e=>{be(e,{get skills(){return i(r)},get initialSteps(){return i(v).steps},onSave:e=>{o(l,i(l).map(s=>s.id===i(v).id?{...s,steps:e}:s),!0),p(),o(v,i(l).find(e=>e.id===i(v).id)||null,!0)},onCancel:()=>o(v,null)})},te=e=>{L(e,{variant:"bordered",padding:"lg",children:(e,s)=>{var t=Ie();g(e,t)},$$slots:{default:!0}})};k(ee,e=>{i(v)?e(se):e(te,!1)}),j(Y),j(z),D(()=>{C(K,i(y).total),C(M,i(y).draft),C(H,i(y).active),C(X,i(y).archived)}),g(s,z),h()}B(["click","keydown"]);export{Ee as component};
