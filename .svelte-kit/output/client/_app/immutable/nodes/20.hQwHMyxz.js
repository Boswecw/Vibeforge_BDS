import{s as e}from"../chunks/Bgf5SIXN.js";import{ad as s,p as t,c as a,X as l,C as r,g as i,K as n,a as o,O as v,E as d,F as c,m as u,R as p,$ as f,h as k,i as m,k as g,l as h,e as y,q as w,j as $,r as j,U as b,L as z,v as S,z as D,N,A as C,s as O,T as I,o as W,d as E,x as F,ae as T,I as x,y as A,G as J,H as K,af as q,S as B}from"../chunks/DMG9opGF.js";import{P as R}from"../chunks/B9fUN0C4.js";import{B as L}from"../chunks/CPI7VlXT.js";import{I as U}from"../chunks/5k5SHSMS.js";import{B as _}from"../chunks/Bd01I2fe.js";import{u as M,a as P,D as G,b as H,c as V,d as X,S as Y,K as Q,P as Z,C as ee,e as se}from"../chunks/D-jDLIAh.js";import{A as te}from"../chunks/IY61Ops4.js";import{F as ae}from"../chunks/0OOX5gzM.js";import{T as le}from"../chunks/BTXiV6h6.js";var re=y('<h3 class="modal-title svelte-ta60gp" id="modal-title"> </h3>'),ie=y('<div class="modal-title svelte-ta60gp"><!></div>'),ne=y('<button class="modal-close svelte-ta60gp" aria-label="Close modal">✕</button>'),oe=y('<div class="modal-footer svelte-ta60gp"><!></div>'),ve=y('<div class="modal-backdrop svelte-ta60gp" role="presentation"><div role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-ta60gp"><!> <!></div> <div class="modal-body svelte-ta60gp"><!></div> <!></div></div>');var de=y('<div><!> <div class="skill-info svelte-uujcry"><strong class="svelte-uujcry"> </strong> <p class="svelte-uujcry"> </p></div> <div class="drag-handle svelte-uujcry">⋮⋮</div></div>'),ce=y('<span class="saved-indicator svelte-uujcry"> </span>'),ue=y('<span class="unsaved-indicator svelte-uujcry">● Unsaved changes</span>'),pe=y('<div class="empty-state svelte-uujcry"><div class="empty-icon svelte-uujcry">⚡</div> <p class="svelte-uujcry">Drag skills from the library to build your workflow</p> <p class="empty-hint svelte-uujcry">You can reorder steps by dragging them</p></div>'),fe=y('<div class="drag-preview svelte-uujcry"><!> <strong class="svelte-uujcry"> </strong></div>'),ke=y('<div class="drag-preview step-preview svelte-uujcry"><!> <strong class="svelte-uujcry"> </strong></div>'),me=y('<div class="builder-content svelte-uujcry"><div class="skill-library svelte-uujcry"><h3 class="svelte-uujcry">Skill Library</h3> <p class="hint svelte-uujcry">Drag skills to the workflow canvas</p> <div class="skill-list svelte-uujcry"></div></div> <div class="workflow-canvas svelte-uujcry" id="workflow-canvas" data-droppable="true"><h3 class="svelte-uujcry"> </h3> <!></div></div> <!>',1),ge=y('<li class="svelte-uujcry"> </li>'),he=y('<li class="svelte-uujcry"> </li>'),ye=y('<strong> </strong> <ul class="svelte-uujcry"><!> <!></ul>',1),we=y('<div class="validation-errors svelte-uujcry"><!></div>'),$e=y('<div class="config-modal svelte-uujcry"><div class="form-group svelte-uujcry"><label class="svelte-uujcry">Use output from previous step:</label> <!></div> <div class="form-group svelte-uujcry"><label class="svelte-uujcry">Custom Inputs (JSON):</label> <!></div> <div class="modal-actions svelte-uujcry"><!> <!></div></div>'),je=y('<div class="workflow-builder svelte-uujcry"><div class="toolbar svelte-uujcry"><div class="toolbar-left svelte-uujcry"><h2 class="svelte-uujcry">Workflow Builder</h2> <div class="status svelte-uujcry"><!></div></div> <div class="toolbar-right svelte-uujcry"><!> <!> <!> <!></div></div> <!> <!></div> <!>',1);function be(e,y){t(y,!0);let B=a(y,"initialSteps",19,()=>[]),R=O(I([...B()])),U=O(null),be=O(null),ze=O(!1),Se=O(!1),De=O(null),Ne=O(I([])),Ce=O(null),Oe=O(I([])),Ie=O(-1);const We=M(P(Z),P(Q));let Ee=F(()=>i(Ie)>0),Fe=F(()=>i(Ie)<i(Oe).length-1);function Te(e){i(Ie)<i(Oe).length-1&&o(Oe,i(Oe).slice(0,i(Ie)+1),!0),o(Oe,[...i(Oe),{steps:JSON.parse(JSON.stringify(e)),timestamp:Date.now()}],!0),i(Oe).length>20&&o(Oe,i(Oe).slice(i(Oe).length-20),!0),o(Ie,i(Oe).length-1)}function xe(){i(Ee)&&(T(Ie,-1),o(R,JSON.parse(JSON.stringify(i(Oe)[i(Ie)].steps)),!0))}function Ae(){i(Fe)&&(T(Ie),o(R,JSON.parse(JSON.stringify(i(Oe)[i(Ie)].steps)),!0))}function Je(){if(!i(De))return;const e=i(R).findIndex(e=>e.id===i(De).id);-1!==e&&(i(R)[e]={...i(De)},Te(i(R))),o(Se,!1),o(De,null)}W(()=>{Te(i(R))}),E(()=>{if(i(R).length>0&&y.onSave){const e=setTimeout(()=>{y.onSave(i(R)),o(Ce,new Date,!0)},1e3);return()=>clearTimeout(e)}}),E(()=>{!function(){const e=[];i(R).forEach(s=>{const t=y.skills.find(e=>e.id===s.skillId);t?.requiredInputs&&t.requiredInputs.forEach(t=>{s.inputs[t]||s.useOutputFrom||e.push({stepId:s.id,message:`Missing required input: ${t}`})})});const s=new Map(i(R).map(e=>[e.id,e]));i(R).forEach(t=>{const a=new Set;let l=t;for(;l.useOutputFrom;){if(a.has(l.id)){e.push({stepId:t.id,message:"Circular dependency detected"});break}a.add(l.id);const r=s.get(l.useOutputFrom);if(!r)break;l=r}}),o(Ne,e,!0)}()}),W(()=>{function e(e){!e.metaKey&&!e.ctrlKey||"z"!==e.key||e.shiftKey?(e.metaKey||e.ctrlKey)&&"z"===e.key&&e.shiftKey&&(e.preventDefault(),Ae()):(e.preventDefault(),xe())}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)});var Ke=je(),qe=k(Ke),Be=w(qe),Re=w(Be),Le=$(w(Re),2),Ue=w(Le),_e=e=>{var s=ce(),t=w(s);j(s),D(e=>C(t,`✓ Saved ${e??""}`),[()=>i(Ce).toLocaleTimeString()]),g(e,s)},Me=e=>{var s=ue();g(e,s)};m(Ue,e=>{i(Ce)?e(_e):e(Me,!1)}),j(Le),j(Re);var Pe=$(Re,2),Ge=w(Pe);{let e=F(()=>!i(Ee));L(Ge,{variant:"ghost",size:"sm",onclick:xe,get disabled(){return i(e)},children:(e,s)=>{x();var t=A("↶ Undo");g(e,t)},$$slots:{default:!0}})}var He=$(Ge,2);{let e=F(()=>!i(Fe));L(He,{variant:"ghost",size:"sm",onclick:Ae,get disabled(){return i(e)},children:(e,s)=>{x();var t=A("↷ Redo");g(e,t)},$$slots:{default:!0}})}var Ve=$(He,2);L(Ve,{variant:"ghost",size:"sm",onclick:function(){y.onCancel&&y.onCancel()},children:(e,s)=>{x();var t=A("Cancel");g(e,t)},$$slots:{default:!0}});var Xe=$(Ve,2);L(Xe,{variant:"primary",size:"sm",onclick:function(){y.onSave&&(y.onSave(i(R)),o(Ce,new Date,!0))},children:(e,s)=>{x();var t=A("Save Workflow");g(e,t)},$$slots:{default:!0}}),j(Pe),j(Be);var Ye=$(Be,2);G(Ye,{get sensors(){return We},get collisionDetection(){return V},onDragStart:function(e){const{active:s}=e,t=s.id;t.startsWith("skill-")?(o(U,t.replace("skill-",""),!0),o(ze,!0)):t.startsWith("step-")&&(o(be,t,!0),o(ze,!1))},onDragEnd:function(e){const{active:s,over:t}=e;if(!t)return o(U,null),o(be,null),void o(ze,!1);const a=s.id,l=t.id;if(i(ze)&&"workflow-canvas"===l){const e=y.skills.find(e=>e.id===i(U));e&&function(e){const s={id:`step-${Date.now()}`,skillId:e.id,skillName:e.name,order:i(R).length,inputs:{},useOutputFrom:i(R).length>0?i(R)[i(R).length-1].id:void 0};o(R,[...i(R),s],!0),Te(i(R))}(e)}else if(!i(ze)&&a.startsWith("step-")){const e=i(R).findIndex(e=>`step-${e.id}`===a),s=i(R).findIndex(e=>`step-${e.id}`===l);if(-1!==e&&-1!==s){const t=X(i(R),e,s);o(R,t.map((e,s)=>({...e,order:s})),!0),Te(i(R))}}o(U,null),o(be,null),o(ze,!1)},children:(e,s)=>{var t=me(),a=k(t),l=w(a),r=$(w(l),4);J(r,21,()=>y.skills,K,(e,s)=>{((e,s)=>{let t=()=>s?.().skill;const a=F(()=>se({id:`skill-${t().id}`}));var l=de();q(l,e=>({class:"skill-item",style:e,...i(a).attributes,...i(a).listeners}),[()=>i(a).transform?`transform: ${ee.Transform.toString(i(a).transform)}`:""],void 0,void 0,"svelte-uujcry");var r=w(l);_(r,{variant:"primary",size:"sm",children:(e,s)=>{x();var a=A();D(()=>C(a,t().category)),g(e,a)},$$slots:{default:!0}});var n=$(r,2),o=w(n),v=w(o,!0);j(o);var d=$(o,2),c=w(d,!0);j(d),j(n),x(2),j(l),D(()=>{C(v,t().name),C(c,t().description)}),g(e,l)})(e,{get skill(){return i(s)}})}),j(r),j(l);var n=$(l,2),o=w(n),v=w(o);j(o);var d=$(o,2),c=e=>{var s=pe();g(e,s)},p=e=>{Y(e)};m(d,e=>{0===i(R).length?e(c):e(p,!1)}),j(n),j(a);var f=$(a,2);H(f,{children:(e,s)=>{var t=u(),a=k(t),l=e=>{const s=F(()=>y.skills.find(e=>e.id===i(U)));var t=u(),a=k(t),l=e=>{var t=fe(),a=w(t);_(a,{variant:"primary",children:(e,t)=>{x();var a=A();D(()=>C(a,i(s).category)),g(e,a)},$$slots:{default:!0}});var l=$(a,2),r=w(l,!0);j(l),j(t),D(()=>C(r,i(s).name)),g(e,t)};m(a,e=>{i(s)&&e(l)}),g(e,t)},r=e=>{var s=u(),t=k(s),a=e=>{const s=F(()=>i(R).find(e=>`step-${e.id}`===i(be)));var t=u(),a=k(t),l=e=>{var t=ke(),a=w(t);_(a,{variant:"info",children:(e,t)=>{x();var a=A();D(()=>C(a,`Step ${i(s).order+1}`)),g(e,a)},$$slots:{default:!0}});var l=$(a,2),r=w(l,!0);j(l),j(t),D(()=>C(r,i(s).skillName)),g(e,t)};m(a,e=>{i(s)&&e(l)}),g(e,t)};m(t,e=>{i(be)&&e(a)},!0),g(e,s)};m(a,e=>{i(U)?e(l):e(r,!1)}),g(e,t)},$$slots:{default:!0}}),D(()=>C(v,`Workflow Steps (${i(R).length??""})`)),g(e,t)},$$slots:{default:!0}});var Qe=$(Ye,2),Ze=e=>{var s=we(),t=w(s);te(t,{variant:"error",children:(e,s)=>{var t=ye(),a=k(t),l=w(a);j(a);var r=$(a,2),n=w(r);J(n,17,()=>i(Ne).slice(0,5),K,(e,s)=>{var t=ge(),a=w(t);j(t),D(e=>C(a,`${i(s).message??""} (Step ${e??""})`),[()=>i(R).find(e=>e.id===i(s).stepId)?.order??"?"]),g(e,t)});var o=$(n,2),v=e=>{var s=he(),t=w(s);j(s),D(()=>C(t,`...and ${i(Ne).length-5} more`)),g(e,s)};m(o,e=>{i(Ne).length>5&&e(v)}),j(r),D(()=>C(l,`Validation Errors (${i(Ne).length??""})`)),g(e,t)},$$slots:{default:!0}}),j(s),g(e,s)};m(Qe,e=>{i(Ne).length>0&&e(Ze)}),j(qe);var es=$(qe,2),ss=e=>{!function(e,y){const O=s(y);t(y,!1);const I=n();let W=a(y,"open",12,!1),E=a(y,"title",8,""),F=a(y,"size",8,"md"),T=a(y,"closeOnBackdrop",8,!0),x=a(y,"closeOnEscape",8,!0),A=a(y,"showClose",8,!0),J=a(y,"showFooter",8,!0);const K=l();let q=n(null),B=n();function R(e){T()&&e.target===e.currentTarget&&L()}function L(){W(!1),K("close")}r(()=>(v(W()),i(B),i(q),ae),()=>{W()&&i(B)?setTimeout(()=>{o(q,new ae(i(B))),i(q).activate()},50):!W()&&i(q)&&(i(q).deactivate(),o(q,null))}),r(()=>v(F()),()=>{o(I,{sm:"modal-sm",md:"modal-md",lg:"modal-lg",xl:"modal-xl",full:"modal-full"}[F()])}),d(),c();var U=u();p("keydown",f,function(e){x()&&"Escape"===e.key&&W()&&L()});var _=k(U),M=e=>{var s=ve(),t=w(s),a=w(t),l=w(a),r=e=>{var s=re(),t=w(s,!0);j(s),D(()=>C(t,E())),g(e,s)},n=e=>{var s=u(),t=k(s),a=e=>{var s=ie(),t=w(s);b(t,y,"header",{}),j(s),g(e,s)};m(t,e=>{z(()=>O.header)&&e(a)},!0),g(e,s)};m(l,e=>{E()?e(r):e(n,!1)});var d=$(l,2),c=e=>{var s=ne();p("click",s,L),g(e,s)};m(d,e=>{A()&&e(c)}),j(a);var f=$(a,2),h=w(f);b(h,y,"default",{}),j(f);var W=$(f,2),F=e=>{var s=oe(),t=w(s);b(t,y,"footer",{}),j(s),g(e,s)};m(W,e=>{v(J()),z(()=>J()&&O.footer)&&e(F)}),j(t),S(t,e=>o(B,e),()=>i(B)),j(s),D(()=>N(t,1,`modal ${i(I)??""}`,"svelte-ta60gp")),p("click",s,R),g(e,s)};m(_,e=>{W()&&e(M)}),g(e,U),h()}(e,{get title(){return`Configure Step: ${i(De).skillName??""}`},get isOpen(){return i(Se)},onClose:()=>{o(Se,!1),o(De,null)},children:(e,s)=>{var t=$e(),a=w(t),l=$(w(a),2);{let e=F(()=>[{value:"",label:"None"},...i(R).filter(e=>e.order<i(De).order).map(e=>({value:e.id,label:`Step ${e.order+1}: ${e.skillName}`}))]);Select(l,{get options(){return i(e)},get value(){return i(De).useOutputFrom},set value(e){i(De).useOutputFrom=e}})}j(a);var r=$(a,2),n=$(w(r),2);le(n,{rows:6,placeholder:'{"key": "value"}',get value(){return i(De).inputs},set value(e){i(De).inputs=e}}),j(r);var v=$(r,2),d=w(v);L(d,{variant:"ghost",onclick:()=>{o(Se,!1),o(De,null)},children:(e,s)=>{x();var t=A("Cancel");g(e,t)},$$slots:{default:!0}});var c=$(d,2);L(c,{variant:"primary",onclick:Je,children:(e,s)=>{x();var t=A("Save Configuration");g(e,t)},$$slots:{default:!0}}),j(v),j(t),g(e,t)},$$slots:{default:!0}})};m(es,e=>{i(Se)&&i(De)&&e(ss)}),g(e,Ke),h()}var ze=y('<div class="create-workflow-form svelte-1k5z4u1"><!> <!> <div class="form-actions svelte-1k5z4u1"><!> <!></div></div>'),Se=y('<div class="empty-state svelte-1k5z4u1"><p>No workflows yet. Create your first workflow to get started.</p></div>'),De=y('<div role="button" tabindex="0"><div class="workflow-info svelte-1k5z4u1"><div class="workflow-name svelte-1k5z4u1"> </div> <div class="workflow-description svelte-1k5z4u1"> </div> <div class="workflow-meta svelte-1k5z4u1"><!> <span class="workflow-steps svelte-1k5z4u1"> </span></div></div> <!></div>'),Ne=y('<div class="workflows-list svelte-1k5z4u1"></div>'),Ce=y('<div class="section-header svelte-1k5z4u1"><h2 class="svelte-1k5z4u1">My Workflows</h2> <!></div> <!> <!>',1),Oe=y('<div class="no-selection svelte-1k5z4u1"><p>Select a workflow from the list to view and edit its steps.</p></div>'),Ie=y('<div class="workflows-container svelte-1k5z4u1"><div class="page-header svelte-1k5z4u1"><div class="header-content svelte-1k5z4u1"><h1 class="page-title svelte-1k5z4u1">Skill Workflows</h1> <p class="page-description svelte-1k5z4u1">Build multi-step workflows by chaining skills together for complex automation</p></div> <div class="stats-row svelte-1k5z4u1"><div class="stat-item svelte-1k5z4u1"><span class="stat-value svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Total</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value default svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Draft</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value success svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Active</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value warning svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Archived</span></div></div></div> <div class="content-grid svelte-1k5z4u1"><!> <!></div></div>');function We(s,a){t(a,!0);let l=O(I([])),r=O(I([])),n=O(!0),v=O(null),d=O(!1),c=O(""),u=O("");function p(){localStorage.setItem("workflows",JSON.stringify(i(l)))}function f(){if(!i(c).trim())return;const e={id:`wf-${Date.now()}`,name:i(c),description:i(u),steps:[],createdAt:new Date,status:"draft"};o(l,[...i(l),e],!0),p(),o(v,e,!0),o(d,!1),o(c,""),o(u,"")}W(async()=>{try{o(r,await e.getAllSkills(),!0),function(){const e=localStorage.getItem("workflows");if(e)try{const s=JSON.parse(e);o(l,s.map(e=>({...e,createdAt:new Date(e.createdAt),lastRun:e.lastRun?new Date(e.lastRun):void 0})),!0)}catch(s){o(l,[],!0)}}(),o(n,!1)}catch(s){o(n,!1)}});let y=F(()=>({total:i(l).length,draft:i(l).filter(e=>"draft"===e.status).length,active:i(l).filter(e=>"active"===e.status).length,archived:i(l).filter(e=>"archived"===e.status).length}));var b=Ie(),z=w(b),S=$(w(z),2),E=w(S),T=w(E),K=w(T,!0);j(T),x(2),j(E);var q=$(E,2),B=w(q),M=w(B,!0);j(B),x(2),j(q);var P=$(q,2),G=w(P),H=w(G,!0);j(G),x(2),j(P);var V=$(P,2),X=w(V),Y=w(X,!0);j(X),x(2),j(V),j(S),j(z);var Q=$(z,2),Z=w(Q);R(Z,{variant:"bordered",padding:"lg",children:(e,s)=>{var t=Ce(),a=k(t),r=$(w(a),2);L(r,{variant:"primary",size:"sm",get disabled(){return i(d)},$$events:{click:()=>o(d,!0)},children:(e,s)=>{x();var t=A("+ New Workflow");g(e,t)},$$slots:{default:!0}}),j(a);var n=$(a,2),h=e=>{R(e,{variant:"elevated",padding:"md",children:(e,s)=>{var t=ze(),a=w(t);U(a,{label:"Workflow Name",placeholder:"e.g., Code Review & Test",required:!0,fullWidth:!0,get value(){return i(c)},set value(e){o(c,e,!0)}});var l=$(a,2);U(l,{label:"Description",placeholder:"Describe what this workflow does...",fullWidth:!0,get value(){return i(u)},set value(e){o(u,e,!0)}});var r=$(l,2),n=w(r);{let e=F(()=>!i(c).trim());L(n,{variant:"primary",get disabled(){return i(e)},$$events:{click:f},children:(e,s)=>{x();var t=A("Create");g(e,t)},$$slots:{default:!0}})}var v=$(n,2);L(v,{variant:"ghost",$$events:{click:()=>o(d,!1)},children:(e,s)=>{x();var t=A("Cancel");g(e,t)},$$slots:{default:!0}}),j(r),j(t),g(e,t)},$$slots:{default:!0}})};m(n,e=>{i(d)&&e(h)});var y=$(n,2),b=e=>{var s=Se();g(e,s)},z=e=>{var s=Ne();J(s,21,()=>i(l),e=>e.id,(e,s)=>{var t=De();let a;t.__click=()=>o(v,i(s),!0),t.__keydown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o(v,i(s),!0))};var r=w(t),n=w(r),d=w(n,!0);j(n);var c=$(n,2),u=w(c,!0);j(c);var f=$(c,2),k=w(f);{let e=F(()=>({draft:"default",active:"success",archived:"warning"}[i(s).status]));_(k,{get variant(){return i(e)},size:"sm",children:(e,t)=>{x();var a=A();D(()=>C(a,i(s).status)),g(e,a)},$$slots:{default:!0}})}var m=$(k,2),h=w(m);j(m),j(f),j(r);var y=$(r,2);L(y,{variant:"danger",size:"sm",$$events:{click:e=>{var t;e.stopPropagation(),t=i(s).id,o(l,i(l).filter(e=>e.id!==t),!0),p(),i(v)?.id===t&&o(v,null)}},children:(e,s)=>{x();var t=A("Delete");g(e,t)},$$slots:{default:!0}}),j(t),D(()=>{a=N(t,1,"workflow-item svelte-1k5z4u1",null,a,{selected:i(v)?.id===i(s).id}),C(d,i(s).name),C(u,i(s).description||"No description"),C(h,`${i(s).steps.length??""} steps`)}),g(e,t)}),j(s),g(e,s)};m(y,e=>{0===i(l).length?e(b):e(z,!1)}),g(e,t)},$$slots:{default:!0}});var ee=$(Z,2),se=e=>{be(e,{get skills(){return i(r)},get initialSteps(){return i(v).steps},onSave:e=>{o(l,i(l).map(s=>s.id===i(v).id?{...s,steps:e}:s),!0),p(),o(v,i(l).find(e=>e.id===i(v).id)||null,!0)},onCancel:()=>o(v,null)})},te=e=>{R(e,{variant:"bordered",padding:"lg",children:(e,s)=>{var t=Oe();g(e,t)},$$slots:{default:!0}})};m(ee,e=>{i(v)?e(se):e(te,!1)}),j(Q),j(b),D(()=>{C(K,i(y).total),C(M,i(y).draft),C(H,i(y).active),C(Y,i(y).archived)}),g(s,b),h()}B(["click","keydown"]);export{We as component};
