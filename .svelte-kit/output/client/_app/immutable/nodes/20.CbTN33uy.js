import{s as e}from"../chunks/Jf6GASyq.js";import{ae as s,p as t,a,Z as l,z as r,c as i,J as n,N as o,B as v,D as d,k as c,Q as u,a1 as p,d as f,i as k,h as m,j as g,f as h,m as y,e as w,r as $,W as j,K as z,w as b,M as S,g as D,x as N,s as O,T as C,af as I,ag as W,o as E,b as J,q as x,ah as F,G as T,v as A,ai as K,E as q,F as B,aj as R,ak as L,al as M,am as _,an as U,ao as P,ap as G,aq as Q,ar as V,S as Y}from"../chunks/CEBGzJg8.js";import{P as Z}from"../chunks/BFaR4WWh.js";import{B as H}from"../chunks/wNGl6z03.js";import{I as X}from"../chunks/BvPI1pIT.js";import{B as ee}from"../chunks/-MggM-z0.js";import{A as se}from"../chunks/x5TBZFzC.js";import{T as te}from"../chunks/DX0SbVy8.js";var ae=h('<h3 class="modal-title svelte-ta60gp" id="modal-title"> </h3>'),le=h('<div class="modal-title svelte-ta60gp"><!></div>'),re=h('<button class="modal-close svelte-ta60gp" aria-label="Close modal">✕</button>'),ie=h('<div class="modal-footer svelte-ta60gp"><!></div>'),ne=h('<div class="modal-backdrop svelte-ta60gp" role="presentation"><div role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-ta60gp"><!> <!></div> <div class="modal-body svelte-ta60gp"><!></div> <!></div></div>');var oe=h('<div><!> <div class="skill-info svelte-uujcry"><strong class="svelte-uujcry"> </strong> <p class="svelte-uujcry"> </p></div> <div class="drag-handle svelte-uujcry">⋮⋮</div></div>'),ve=h('<span class="saved-indicator svelte-uujcry"> </span>'),de=h('<span class="unsaved-indicator svelte-uujcry">● Unsaved changes</span>'),ce=h('<div class="empty-state svelte-uujcry"><div class="empty-icon svelte-uujcry">⚡</div> <p class="svelte-uujcry">Drag skills from the library to build your workflow</p> <p class="empty-hint svelte-uujcry">You can reorder steps by dragging them</p></div>'),ue=h('<div class="drag-preview svelte-uujcry"><!> <strong class="svelte-uujcry"> </strong></div>'),pe=h('<div class="drag-preview step-preview svelte-uujcry"><!> <strong class="svelte-uujcry"> </strong></div>'),fe=h('<div class="builder-content svelte-uujcry"><div class="skill-library svelte-uujcry"><h3 class="svelte-uujcry">Skill Library</h3> <p class="hint svelte-uujcry">Drag skills to the workflow canvas</p> <div class="skill-list svelte-uujcry"></div></div> <div class="workflow-canvas svelte-uujcry" id="workflow-canvas" data-droppable="true"><h3 class="svelte-uujcry"> </h3> <!></div></div> <!>',1),ke=h('<li class="svelte-uujcry"> </li>'),me=h('<li class="svelte-uujcry"> </li>'),ge=h('<strong> </strong> <ul class="svelte-uujcry"><!> <!></ul>',1),he=h('<div class="validation-errors svelte-uujcry"><!></div>'),ye=h('<div class="config-modal svelte-uujcry"><div class="form-group svelte-uujcry"><label class="svelte-uujcry">Use output from previous step:</label> <!></div> <div class="form-group svelte-uujcry"><label class="svelte-uujcry">Custom Inputs (JSON):</label> <!></div> <div class="modal-actions svelte-uujcry"><!> <!></div></div>'),we=h('<div class="workflow-builder svelte-uujcry"><div class="toolbar svelte-uujcry"><div class="toolbar-left svelte-uujcry"><h2 class="svelte-uujcry">Workflow Builder</h2> <div class="status svelte-uujcry"><!></div></div> <div class="toolbar-right svelte-uujcry"><!> <!> <!> <!></div></div> <!> <!></div> <!>',1);function $e(e,h){t(h,!0);let Y=a(h,"initialSteps",19,()=>[]),Z=O(C([...Y()])),X=O(null),$e=O(null),je=O(!1),ze=O(!1),be=O(null),Se=O(C([])),De=O(null),Ne=O(C([])),Oe=O(-1);const Ce=I(W(G),W(P));let Ie=x(()=>D(Oe)>0),We=x(()=>D(Oe)<D(Ne).length-1);function Ee(e){D(Oe)<D(Ne).length-1&&i(Ne,D(Ne).slice(0,D(Oe)+1),!0),i(Ne,[...D(Ne),{steps:JSON.parse(JSON.stringify(e)),timestamp:Date.now()}],!0),D(Ne).length>20&&i(Ne,D(Ne).slice(D(Ne).length-20),!0),i(Oe,D(Ne).length-1)}function Je(){D(Ie)&&(F(Oe,-1),i(Z,JSON.parse(JSON.stringify(D(Ne)[D(Oe)].steps)),!0))}function xe(){D(We)&&(F(Oe),i(Z,JSON.parse(JSON.stringify(D(Ne)[D(Oe)].steps)),!0))}function Fe(){if(!D(be))return;const e=D(Z).findIndex(e=>e.id===D(be).id);-1!==e&&(D(Z)[e]={...D(be)},Ee(D(Z))),i(ze,!1),i(be,null)}E(()=>{Ee(D(Z))}),J(()=>{if(D(Z).length>0&&h.onSave){const e=setTimeout(()=>{h.onSave(D(Z)),i(De,new Date,!0)},1e3);return()=>clearTimeout(e)}}),J(()=>{!function(){const e=[];D(Z).forEach(s=>{const t=h.skills.find(e=>e.id===s.skillId);(null==t?void 0:t.requiredInputs)&&t.requiredInputs.forEach(t=>{s.inputs[t]||s.useOutputFrom||e.push({stepId:s.id,message:`Missing required input: ${t}`})})});const s=new Map(D(Z).map(e=>[e.id,e]));D(Z).forEach(t=>{const a=new Set;let l=t;for(;l.useOutputFrom;){if(a.has(l.id)){e.push({stepId:t.id,message:"Circular dependency detected"});break}a.add(l.id);const r=s.get(l.useOutputFrom);if(!r)break;l=r}}),i(Se,e,!0)}()}),E(()=>{function e(e){!e.metaKey&&!e.ctrlKey||"z"!==e.key||e.shiftKey?(e.metaKey||e.ctrlKey)&&"z"===e.key&&e.shiftKey&&(e.preventDefault(),xe()):(e.preventDefault(),Je())}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)});var Te=we(),Ae=f(Te),Ke=y(Ae),qe=y(Ke),Be=w(y(qe),2),Re=y(Be),Le=e=>{var s=ve(),t=y(s);$(s),b(e=>N(t,`✓ Saved ${e??""}`),[()=>D(De).toLocaleTimeString()]),m(e,s)},Me=e=>{var s=de();m(e,s)};k(Re,e=>{D(De)?e(Le):e(Me,!1)}),$(Be),$(qe);var _e=w(qe,2),Ue=y(_e);{let e=x(()=>!D(Ie));H(Ue,{variant:"ghost",size:"sm",onclick:Je,get disabled(){return D(e)},children:(e,s)=>{T();var t=A("↶ Undo");m(e,t)},$$slots:{default:!0}})}var Pe=w(Ue,2);{let e=x(()=>!D(We));H(Pe,{variant:"ghost",size:"sm",onclick:xe,get disabled(){return D(e)},children:(e,s)=>{T();var t=A("↷ Redo");m(e,t)},$$slots:{default:!0}})}var Ge=w(Pe,2);H(Ge,{variant:"ghost",size:"sm",onclick:function(){h.onCancel&&h.onCancel()},children:(e,s)=>{T();var t=A("Cancel");m(e,t)},$$slots:{default:!0}});var Qe=w(Ge,2);H(Qe,{variant:"primary",size:"sm",onclick:function(){h.onSave&&(h.onSave(D(Z)),i(De,new Date,!0))},children:(e,s)=>{T();var t=A("Save Workflow");m(e,t)},$$slots:{default:!0}}),$(_e),$(Ke);var Ve=w(Ke,2);K(Ve,{get sensors(){return Ce},get collisionDetection(){return L},onDragStart:function(e){const{active:s}=e,t=s.id;t.startsWith("skill-")?(i(X,t.replace("skill-",""),!0),i(je,!0)):t.startsWith("step-")&&(i($e,t,!0),i(je,!1))},onDragEnd:function(e){const{active:s,over:t}=e;if(!t)return i(X,null),i($e,null),void i(je,!1);const a=s.id,l=t.id;if(D(je)&&"workflow-canvas"===l){const e=h.skills.find(e=>e.id===D(X));e&&function(e){const s={id:`step-${Date.now()}`,skillId:e.id,skillName:e.name,order:D(Z).length,inputs:{},useOutputFrom:D(Z).length>0?D(Z)[D(Z).length-1].id:void 0};i(Z,[...D(Z),s],!0),Ee(D(Z))}(e)}else if(!D(je)&&a.startsWith("step-")){const e=D(Z).findIndex(e=>`step-${e.id}`===a),s=D(Z).findIndex(e=>`step-${e.id}`===l);if(-1!==e&&-1!==s){const t=M(D(Z),e,s);i(Z,t.map((e,s)=>({...e,order:s})),!0),Ee(D(Z))}}i(X,null),i($e,null),i(je,!1)},children:(e,s)=>{var t=fe(),a=f(t),l=y(a),r=w(y(l),4);q(r,21,()=>h.skills,B,(e,s)=>{((e,s)=>{let t=()=>null==s?void 0:s().skill;const a=x(()=>V({id:`skill-${t().id}`}));var l=oe();U(l,e=>({class:"skill-item",style:e,...D(a).attributes,...D(a).listeners}),[()=>D(a).transform?`transform: ${Q.Transform.toString(D(a).transform)}`:""],void 0,void 0,"svelte-uujcry");var r=y(l);ee(r,{variant:"primary",size:"sm",children:(e,s)=>{T();var a=A();b(()=>N(a,t().category)),m(e,a)},$$slots:{default:!0}});var i=w(r,2),n=y(i),o=y(n,!0);$(n);var v=w(n,2),d=y(v,!0);$(v),$(i),T(2),$(l),b(()=>{N(o,t().name),N(d,t().description)}),m(e,l)})(e,{get skill(){return D(s)}})}),$(r),$(l);var i=w(l,2),n=y(i),o=y(n);$(n);var v=w(n,2),d=e=>{var s=ce();m(e,s)},u=e=>{_(e)};k(v,e=>{0===D(Z).length?e(d):e(u,!1)}),$(i),$(a);var p=w(a,2);R(p,{children:(e,s)=>{var t=c(),a=f(t),l=e=>{const s=x(()=>h.skills.find(e=>e.id===D(X)));var t=c(),a=f(t),l=e=>{var t=ue(),a=y(t);ee(a,{variant:"primary",children:(e,t)=>{T();var a=A();b(()=>N(a,D(s).category)),m(e,a)},$$slots:{default:!0}});var l=w(a,2),r=y(l,!0);$(l),$(t),b(()=>N(r,D(s).name)),m(e,t)};k(a,e=>{D(s)&&e(l)}),m(e,t)},r=e=>{var s=c(),t=f(s),a=e=>{const s=x(()=>D(Z).find(e=>`step-${e.id}`===D($e)));var t=c(),a=f(t),l=e=>{var t=pe(),a=y(t);ee(a,{variant:"info",children:(e,t)=>{T();var a=A();b(()=>N(a,`Step ${D(s).order+1}`)),m(e,a)},$$slots:{default:!0}});var l=w(a,2),r=y(l,!0);$(l),$(t),b(()=>N(r,D(s).skillName)),m(e,t)};k(a,e=>{D(s)&&e(l)}),m(e,t)};k(t,e=>{D($e)&&e(a)},!0),m(e,s)};k(a,e=>{D(X)?e(l):e(r,!1)}),m(e,t)},$$slots:{default:!0}}),b(()=>N(o,`Workflow Steps (${D(Z).length??""})`)),m(e,t)},$$slots:{default:!0}});var Ye=w(Ve,2),Ze=e=>{var s=he(),t=y(s);se(t,{variant:"error",children:(e,s)=>{var t=ge(),a=f(t),l=y(a);$(a);var r=w(a,2),i=y(r);q(i,17,()=>D(Se).slice(0,5),B,(e,s)=>{var t=ke(),a=y(t);$(t),b(e=>N(a,`${D(s).message??""} (Step ${e??""})`),[()=>{var e;return(null==(e=D(Z).find(e=>e.id===D(s).stepId))?void 0:e.order)??"?"}]),m(e,t)});var n=w(i,2),o=e=>{var s=me(),t=y(s);$(s),b(()=>N(t,`...and ${D(Se).length-5} more`)),m(e,s)};k(n,e=>{D(Se).length>5&&e(o)}),$(r),b(()=>N(l,`Validation Errors (${D(Se).length??""})`)),m(e,t)},$$slots:{default:!0}}),$(s),m(e,s)};k(Ye,e=>{D(Se).length>0&&e(Ze)}),$(Ae);var He=w(Ae,2),Xe=e=>{!function(e,h){const O=s(h);t(h,!1);const C=n();let I=a(h,"open",12,!1),W=a(h,"title",8,""),E=a(h,"size",8,"md"),J=a(h,"closeOnBackdrop",8,!0),x=a(h,"closeOnEscape",8,!0),F=a(h,"showClose",8,!0),T=a(h,"showFooter",8,!0);const A=l();function K(e){J()&&e.target===e.currentTarget&&q()}function q(){I(!1),A("close")}r(()=>o(E()),()=>{i(C,{sm:"modal-sm",md:"modal-md",lg:"modal-lg",xl:"modal-xl",full:"modal-full"}[E()])}),v(),d();var B=c();u("keydown",p,function(e){x()&&"Escape"===e.key&&I()&&q()});var R=f(B),L=e=>{var s=ne(),t=y(s),a=y(t),l=y(a),r=e=>{var s=ae(),t=y(s,!0);$(s),b(()=>N(t,W())),m(e,s)},i=e=>{var s=c(),t=f(s),a=e=>{var s=le(),t=y(s);j(t,h,"header",{}),$(s),m(e,s)};k(t,e=>{z(()=>O.header)&&e(a)},!0),m(e,s)};k(l,e=>{W()?e(r):e(i,!1)});var n=w(l,2),v=e=>{var s=re();u("click",s,q),m(e,s)};k(n,e=>{F()&&e(v)}),$(a);var d=w(a,2),p=y(d);j(p,h,"default",{}),$(d);var g=w(d,2),I=e=>{var s=ie(),t=y(s);j(t,h,"footer",{}),$(s),m(e,s)};k(g,e=>{o(T()),z(()=>T()&&O.footer)&&e(I)}),$(t),$(s),b(()=>S(t,1,`modal ${D(C)??""}`,"svelte-ta60gp")),u("click",s,K),m(e,s)};k(R,e=>{I()&&e(L)}),m(e,B),g()}(e,{get title(){return`Configure Step: ${D(be).skillName??""}`},get isOpen(){return D(ze)},onClose:()=>{i(ze,!1),i(be,null)},children:(e,s)=>{var t=ye(),a=y(t),l=w(y(a),2);{let e=x(()=>[{value:"",label:"None"},...D(Z).filter(e=>e.order<D(be).order).map(e=>({value:e.id,label:`Step ${e.order+1}: ${e.skillName}`}))]);Select(l,{get options(){return D(e)},get value(){return D(be).useOutputFrom},set value(e){D(be).useOutputFrom=e}})}$(a);var r=w(a,2),n=w(y(r),2);te(n,{rows:6,placeholder:'{"key": "value"}',get value(){return D(be).inputs},set value(e){D(be).inputs=e}}),$(r);var o=w(r,2),v=y(o);H(v,{variant:"ghost",onclick:()=>{i(ze,!1),i(be,null)},children:(e,s)=>{T();var t=A("Cancel");m(e,t)},$$slots:{default:!0}});var d=w(v,2);H(d,{variant:"primary",onclick:Fe,children:(e,s)=>{T();var t=A("Save Configuration");m(e,t)},$$slots:{default:!0}}),$(o),$(t),m(e,t)},$$slots:{default:!0}})};k(He,e=>{D(ze)&&D(be)&&e(Xe)}),m(e,Te),g()}var je=h('<div class="create-workflow-form svelte-1k5z4u1"><!> <!> <div class="form-actions svelte-1k5z4u1"><!> <!></div></div>'),ze=h('<div class="empty-state svelte-1k5z4u1"><p>No workflows yet. Create your first workflow to get started.</p></div>'),be=h('<div role="button" tabindex="0"><div class="workflow-info svelte-1k5z4u1"><div class="workflow-name svelte-1k5z4u1"> </div> <div class="workflow-description svelte-1k5z4u1"> </div> <div class="workflow-meta svelte-1k5z4u1"><!> <span class="workflow-steps svelte-1k5z4u1"> </span></div></div> <!></div>'),Se=h('<div class="workflows-list svelte-1k5z4u1"></div>'),De=h('<div class="section-header svelte-1k5z4u1"><h2 class="svelte-1k5z4u1">My Workflows</h2> <!></div> <!> <!>',1),Ne=h('<div class="no-selection svelte-1k5z4u1"><p>Select a workflow from the list to view and edit its steps.</p></div>'),Oe=h('<div class="workflows-container svelte-1k5z4u1"><div class="page-header svelte-1k5z4u1"><div class="header-content svelte-1k5z4u1"><h1 class="page-title svelte-1k5z4u1">Skill Workflows</h1> <p class="page-description svelte-1k5z4u1">Build multi-step workflows by chaining skills together for complex automation</p></div> <div class="stats-row svelte-1k5z4u1"><div class="stat-item svelte-1k5z4u1"><span class="stat-value svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Total</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value default svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Draft</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value success svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Active</span></div> <div class="stat-item svelte-1k5z4u1"><span class="stat-value warning svelte-1k5z4u1"> </span> <span class="stat-label svelte-1k5z4u1">Archived</span></div></div></div> <div class="content-grid svelte-1k5z4u1"><!> <!></div></div>');function Ce(s,a){t(a,!0);let l=O(C([])),r=O(C([])),n=O(!0),o=O(null),v=O(!1),d=O(""),c=O("");function u(){localStorage.setItem("workflows",JSON.stringify(D(l)))}function p(){if(!D(d).trim())return;const e={id:`wf-${Date.now()}`,name:D(d),description:D(c),steps:[],createdAt:new Date,status:"draft"};i(l,[...D(l),e],!0),u(),i(o,e,!0),i(v,!1),i(d,""),i(c,"")}E(async()=>{try{i(r,await e.getAllSkills(),!0),function(){const e=localStorage.getItem("workflows");if(e)try{const s=JSON.parse(e);i(l,s.map(e=>({...e,createdAt:new Date(e.createdAt),lastRun:e.lastRun?new Date(e.lastRun):void 0})),!0)}catch(s){i(l,[],!0)}}(),i(n,!1)}catch(s){i(n,!1)}});let h=x(()=>({total:D(l).length,draft:D(l).filter(e=>"draft"===e.status).length,active:D(l).filter(e=>"active"===e.status).length,archived:D(l).filter(e=>"archived"===e.status).length}));var j=Oe(),z=y(j),I=w(y(z),2),W=y(I),J=y(W),F=y(J,!0);$(J),T(2),$(W);var K=w(W,2),B=y(K),R=y(B,!0);$(B),T(2),$(K);var L=w(K,2),M=y(L),_=y(M,!0);$(M),T(2),$(L);var U=w(L,2),P=y(U),G=y(P,!0);$(P),T(2),$(U),$(I),$(z);var Q=w(z,2),V=y(Q);Z(V,{variant:"bordered",padding:"lg",children:(e,s)=>{var t=De(),a=f(t),r=w(y(a),2);H(r,{variant:"primary",size:"sm",get disabled(){return D(v)},$$events:{click:()=>i(v,!0)},children:(e,s)=>{T();var t=A("+ New Workflow");m(e,t)},$$slots:{default:!0}}),$(a);var n=w(a,2),g=e=>{Z(e,{variant:"elevated",padding:"md",children:(e,s)=>{var t=je(),a=y(t);X(a,{label:"Workflow Name",placeholder:"e.g., Code Review & Test",required:!0,fullWidth:!0,get value(){return D(d)},set value(e){i(d,e,!0)}});var l=w(a,2);X(l,{label:"Description",placeholder:"Describe what this workflow does...",fullWidth:!0,get value(){return D(c)},set value(e){i(c,e,!0)}});var r=w(l,2),n=y(r);{let e=x(()=>!D(d).trim());H(n,{variant:"primary",get disabled(){return D(e)},$$events:{click:p},children:(e,s)=>{T();var t=A("Create");m(e,t)},$$slots:{default:!0}})}var o=w(n,2);H(o,{variant:"ghost",$$events:{click:()=>i(v,!1)},children:(e,s)=>{T();var t=A("Cancel");m(e,t)},$$slots:{default:!0}}),$(r),$(t),m(e,t)},$$slots:{default:!0}})};k(n,e=>{D(v)&&e(g)});var h=w(n,2),j=e=>{var s=ze();m(e,s)},z=e=>{var s=Se();q(s,21,()=>D(l),e=>e.id,(e,s)=>{var t=be();let a;t.__click=()=>i(o,D(s),!0),t.__keydown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i(o,D(s),!0))};var r=y(t),n=y(r),v=y(n,!0);$(n);var d=w(n,2),c=y(d,!0);$(d);var p=w(d,2),f=y(p);{let e=x(()=>({draft:"default",active:"success",archived:"warning"}[D(s).status]));ee(f,{get variant(){return D(e)},size:"sm",children:(e,t)=>{T();var a=A();b(()=>N(a,D(s).status)),m(e,a)},$$slots:{default:!0}})}var k=w(f,2),g=y(k);$(k),$(p),$(r);var h=w(r,2);H(h,{variant:"danger",size:"sm",$$events:{click:e=>{var t,a;e.stopPropagation(),t=D(s).id,i(l,D(l).filter(e=>e.id!==t),!0),u(),(null==(a=D(o))?void 0:a.id)===t&&i(o,null)}},children:(e,s)=>{T();var t=A("Delete");m(e,t)},$$slots:{default:!0}}),$(t),b(()=>{var e;a=S(t,1,"workflow-item svelte-1k5z4u1",null,a,{selected:(null==(e=D(o))?void 0:e.id)===D(s).id}),N(v,D(s).name),N(c,D(s).description||"No description"),N(g,`${D(s).steps.length??""} steps`)}),m(e,t)}),$(s),m(e,s)};k(h,e=>{0===D(l).length?e(j):e(z,!1)}),m(e,t)},$$slots:{default:!0}});var Y=w(V,2),se=e=>{$e(e,{get skills(){return D(r)},get initialSteps(){return D(o).steps},onSave:e=>{i(l,D(l).map(s=>s.id===D(o).id?{...s,steps:e}:s),!0),u(),i(o,D(l).find(e=>e.id===D(o).id)||null,!0)},onCancel:()=>i(o,null)})},te=e=>{Z(e,{variant:"bordered",padding:"lg",children:(e,s)=>{var t=Ne();m(e,t)},$$slots:{default:!0}})};k(Y,e=>{D(o)?e(se):e(te,!1)}),$(Q),$(j),b(()=>{N(F,D(h).total),N(R,D(h).draft),N(_,D(h).active),N(G,D(h).archived)}),m(s,j),g()}Y(["click","keydown"]);export{Ce as component};
