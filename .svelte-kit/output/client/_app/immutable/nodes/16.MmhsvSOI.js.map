{"version":3,"file":"16.MmhsvSOI.js","sources":["../../../../../../src/lib/types/agents.ts","../../../../../../src/lib/stores/planning.svelte.ts","../../../../../../src/lib/services/streaming.ts","../../../../../../src/lib/services/planningService.ts","../../../../../../src/lib/components/panels/planning/RequestForm.svelte","../../../../../../src/lib/components/panels/planning/StageProgress.svelte","../../../../../../src/lib/components/panels/planning/SessionHistory.svelte","../../../../../../src/routes/planning/+page.svelte","../../../../../../src/lib/components/panels/planning/StageOutput.svelte","../../../../../../src/lib/components/panels/planning/DeliverableViewer.svelte"],"sourcesContent":["/**\n * Agent Type Definitions for VibeForge BDS\n *\n * Defines types for all agent workflows following the PAORT cycle.\n */\n\n// ═══════════════════════════════════════════════════════════════════════\n// PAORT Stage Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport enum PAORTStage {\n\tPLAN = 'PLAN',\n\tACT = 'ACT',\n\tOBSERVE = 'OBSERVE',\n\tREFLECT = 'REFLECT',\n\tTRANSITION = 'TRANSITION'\n}\n\nexport interface StageInput {\n\tstage: PAORTStage;\n\tdata: Record<string, unknown>;\n\tpreviousStageOutput?: StageOutput;\n}\n\nexport interface StageOutput {\n\tstage: PAORTStage;\n\tdata: Record<string, unknown>;\n\tsummary: string;\n\tstatus: 'success' | 'failure' | 'partial';\n\tmetrics?: StageMetrics;\n}\n\nexport interface StageMetrics {\n\ttokensUsed: number;\n\tcost: number;\n\tlatencyMs: number;\n\tmodelUsed: string;\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Session Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport enum SessionStatus {\n\tPENDING = 'PENDING',\n\tRUNNING = 'RUNNING',\n\tCOMPLETED = 'COMPLETED',\n\tFAILED = 'FAILED',\n\tCANCELLED = 'CANCELLED'\n}\n\nexport interface BaseSession {\n\tid: string;\n\ttype: 'planning' | 'execution' | 'evaluation' | 'coordination';\n\tstatus: SessionStatus;\n\tcreatedAt: Date;\n\tstartedAt?: Date;\n\tcompletedAt?: Date;\n\tcurrentStage?: PAORTStage;\n\terror?: string;\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Planning Agent Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport interface PlanningRequest {\n\ttitle: string;\n\tdescription: string;\n\tcontext?: Record<string, unknown>;\n\trequirements?: string[];\n\tconstraints?: string[];\n}\n\nexport interface PlanningSession extends BaseSession {\n\ttype: 'planning';\n\trequest: PlanningRequest;\n\tstages: PlanningStages;\n\tdeliverable?: PlanningDeliverable;\n}\n\nexport interface PlanningStages {\n\tplan?: StageOutput;\n\tact?: StageOutput;\n\tobserve?: StageOutput;\n\treflect?: StageOutput;\n}\n\nexport interface PlanningDeliverable {\n\tplan: {\n\t\ttitle: string;\n\t\toverview: string;\n\t\tsteps: PlanStep[];\n\t\testimatedEffort: string;\n\t\trisks: string[];\n\t};\n\tprompt: string;\n\tmetadata: {\n\t\ttotalTokens: number;\n\t\ttotalCost: number;\n\t\tduration: number;\n\t};\n}\n\nexport interface PlanStep {\n\tid: string;\n\ttitle: string;\n\tdescription: string;\n\tdependencies: string[];\n\testimatedEffort: string;\n\tacceptanceCriteria: string[];\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Execution Agent Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport interface ExecutionRequest {\n\tplanSessionId: string;\n\tplan: PlanningDeliverable;\n\toptions?: ExecutionOptions;\n}\n\nexport interface ExecutionOptions {\n\trunTests: boolean;\n\tgenerateDocs: boolean;\n\tautoCommit: boolean;\n}\n\nexport interface ExecutionSession extends BaseSession {\n\ttype: 'execution';\n\trequest: ExecutionRequest;\n\tstages: ExecutionStages;\n\tresult?: ExecutionResult;\n}\n\nexport interface ExecutionStages {\n\tplan?: StageOutput;\n\tact?: StageOutput;\n\tobserve?: StageOutput;\n\treflect?: StageOutput;\n}\n\nexport interface ExecutionResult {\n\tcode: {\n\t\tfilesModified: FileModification[];\n\t\tfilesCreated: FileCreation[];\n\t\tfilesDeleted: string[];\n\t};\n\ttests: TestResults;\n\tmetrics: ExecutionMetrics;\n\trollbackPoint?: string;\n}\n\nexport interface FileModification {\n\tpath: string;\n\tadditions: number;\n\tdeletions: number;\n\tdiff: string;\n}\n\nexport interface FileCreation {\n\tpath: string;\n\tcontent: string;\n\tlines: number;\n}\n\nexport interface TestResults {\n\tpassed: number;\n\tfailed: number;\n\tskipped: number;\n\ttotal: number;\n\tcoverage?: {\n\t\tlines: number;\n\t\tfunctions: number;\n\t\tbranches: number;\n\t\tstatements: number;\n\t};\n\tfailures: TestFailure[];\n}\n\nexport interface TestFailure {\n\ttestName: string;\n\tfilePath: string;\n\terror: string;\n\tstack?: string;\n}\n\nexport interface ExecutionMetrics {\n\ttokensUsed: number;\n\tcost: number;\n\tduration: number;\n\tmodelUsed: string;\n\tlinesOfCode: number;\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Evaluator Agent Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport interface EvaluationRequest {\n\texecutionSessionId: string;\n\tresult: ExecutionResult;\n\tcriteria?: EvaluationCriteria;\n}\n\nexport interface EvaluationCriteria {\n\tcheckSASCompliance: boolean;\n\tcheckTestCoverage: boolean;\n\tcheckCodeQuality: boolean;\n\tcheckPerformance: boolean;\n}\n\nexport interface EvaluationSession extends BaseSession {\n\ttype: 'evaluation';\n\trequest: EvaluationRequest;\n\tstages: EvaluationStages;\n\tassessment?: EvaluationAssessment;\n}\n\nexport interface EvaluationStages {\n\tplan?: StageOutput;\n\tact?: StageOutput;\n\tobserve?: StageOutput;\n\treflect?: StageOutput;\n}\n\nexport interface EvaluationAssessment {\n\tqualityScore: number; // 0-100\n\tsasCompliance: SASCompliance;\n\tcodeReview: CodeReview;\n\timprovements: Improvement[];\n\tmetrics: EvaluationMetrics;\n}\n\nexport interface SASCompliance {\n\tcompliant: boolean;\n\tviolations: SASViolation[];\n\tpassedChecks: string[];\n\tfailedChecks: string[];\n}\n\nexport interface SASViolation {\n\trule: string;\n\tseverity: 'error' | 'warning' | 'info';\n\tfilePath: string;\n\tlineNumber?: number;\n\tdescription: string;\n\tsuggestion: string;\n}\n\nexport interface CodeReview {\n\tfindings: CodeFinding[];\n\tsummary: string;\n\toverallRating: number; // 0-10\n}\n\nexport interface CodeFinding {\n\tid: string;\n\ttype: 'bug' | 'smell' | 'security' | 'performance' | 'style';\n\tseverity: 'critical' | 'high' | 'medium' | 'low';\n\tfilePath: string;\n\tlineNumber?: number;\n\tdescription: string;\n\tsuggestion: string;\n\tcodeSnippet?: string;\n}\n\nexport interface Improvement {\n\tid: string;\n\tpriority: 'critical' | 'high' | 'medium' | 'low';\n\tcategory: string;\n\tdescription: string;\n\tbefore: string;\n\tafter: string;\n\timpact: string;\n\teffort: string;\n}\n\nexport interface EvaluationMetrics {\n\ttokensUsed: number;\n\tcost: number;\n\tduration: number;\n\tmodelUsed: string;\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Coordinator Agent Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport interface WorkflowRequest {\n\ttitle: string;\n\tdescription: string;\n\tagents: AgentNode[];\n\tdependencies: Dependency[];\n}\n\nexport interface AgentNode {\n\tid: string;\n\ttype: 'planning' | 'execution' | 'evaluation';\n\tconfig: Record<string, unknown>;\n\tposition: { x: number; y: number };\n}\n\nexport interface Dependency {\n\tfrom: string; // Agent node ID\n\tto: string; // Agent node ID\n\tdataMapping?: Record<string, string>;\n}\n\nexport interface CoordinationSession extends BaseSession {\n\ttype: 'coordination';\n\trequest: WorkflowRequest;\n\tworkflow: WorkflowExecution;\n}\n\nexport interface WorkflowExecution {\n\tnodes: WorkflowNodeExecution[];\n\tstatus: WorkflowStatus;\n\tstartedAt?: Date;\n\tcompletedAt?: Date;\n\terror?: string;\n}\n\nexport interface WorkflowNodeExecution {\n\tnodeId: string;\n\tsessionId?: string;\n\tstatus: 'pending' | 'running' | 'completed' | 'failed';\n\tstartedAt?: Date;\n\tcompletedAt?: Date;\n\terror?: string;\n\tprogress?: number; // 0-100\n}\n\nexport enum WorkflowStatus {\n\tPENDING = 'PENDING',\n\tRUNNING = 'RUNNING',\n\tCOMPLETED = 'COMPLETED',\n\tFAILED = 'FAILED',\n\tPARTIAL = 'PARTIAL'\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Streaming Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport interface StreamChunk {\n\ttype: 'chunk' | 'stage_start' | 'stage_end' | 'complete' | 'error';\n\tdata: unknown;\n\ttimestamp: Date;\n}\n\nexport interface StageStreamChunk extends StreamChunk {\n\ttype: 'chunk';\n\tdata: {\n\t\tstage: PAORTStage;\n\t\tcontent: string;\n\t};\n}\n\nexport interface StageStartChunk extends StreamChunk {\n\ttype: 'stage_start';\n\tdata: {\n\t\tstage: PAORTStage;\n\t};\n}\n\nexport interface StageEndChunk extends StreamChunk {\n\ttype: 'stage_end';\n\tdata: {\n\t\tstage: PAORTStage;\n\t\toutput: StageOutput;\n\t};\n}\n\nexport interface CompleteChunk extends StreamChunk {\n\ttype: 'complete';\n\tdata: {\n\t\tsessionId: string;\n\t\tresult: unknown;\n\t};\n}\n\nexport interface ErrorChunk extends StreamChunk {\n\ttype: 'error';\n\tdata: {\n\t\terror: string;\n\t\tstage?: PAORTStage;\n\t};\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Union Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport type AgentSession = PlanningSession | ExecutionSession | EvaluationSession | CoordinationSession;\n\nexport type AgentRequest = PlanningRequest | ExecutionRequest | EvaluationRequest | WorkflowRequest;\n\nexport type AgentResult = PlanningDeliverable | ExecutionResult | EvaluationAssessment | WorkflowExecution;\n","/**\n * Planning Store\n *\n * Manages planning agent sessions using Svelte 5 runes.\n */\n\nimport type {\n\tPlanningSession,\n\tPlanningRequest,\n\tPlanningDeliverable,\n\tPAORTStage,\n\tStageOutput\n} from '$lib/types/agents';\nimport { SessionStatus, PAORTStage as Stage } from '$lib/types/agents';\n\n// ═══════════════════════════════════════════════════════════════════════\n// Planning Store State\n// ═══════════════════════════════════════════════════════════════════════\n\ninterface PlanningState {\n\tsessions: PlanningSession[];\n\tcurrentSession: PlanningSession | null;\n\tisStreaming: boolean;\n\tstreamingOutput: string;\n\tcurrentStage: PAORTStage | null;\n}\n\nconst state = $state<PlanningState>({\n\tsessions: [],\n\tcurrentSession: null,\n\tisStreaming: false,\n\tstreamingOutput: '',\n\tcurrentStage: null\n});\n\n// ═══════════════════════════════════════════════════════════════════════\n// Planning Store\n// ═══════════════════════════════════════════════════════════════════════\n\nexport const planningStore = {\n\t// Getters\n\tget sessions() {\n\t\treturn state.sessions;\n\t},\n\n\tget currentSession() {\n\t\treturn state.currentSession;\n\t},\n\n\tget isStreaming() {\n\t\treturn state.isStreaming;\n\t},\n\n\tget streamingOutput() {\n\t\treturn state.streamingOutput;\n\t},\n\n\tget currentStage() {\n\t\treturn state.currentStage;\n\t},\n\n\tget activeSessions() {\n\t\treturn state.sessions.filter(\n\t\t\t(s) => s.status === SessionStatus.RUNNING || s.status === SessionStatus.PENDING\n\t\t);\n\t},\n\n\tget completedSessions() {\n\t\treturn state.sessions.filter((s) => s.status === SessionStatus.COMPLETED);\n\t},\n\n\tget failedSessions() {\n\t\treturn state.sessions.filter((s) => s.status === SessionStatus.FAILED);\n\t},\n\n\t// Actions\n\tcreateSession(request: PlanningRequest): PlanningSession {\n\t\tconst session: PlanningSession = {\n\t\t\tid: generateSessionId(),\n\t\t\ttype: 'planning',\n\t\t\tstatus: SessionStatus.PENDING,\n\t\t\tcreatedAt: new Date(),\n\t\t\trequest,\n\t\t\tstages: {}\n\t\t};\n\n\t\tstate.sessions = [...state.sessions, session];\n\t\tstate.currentSession = session;\n\n\t\treturn session;\n\t},\n\n\tstartSession(sessionId: string): void {\n\t\tconst session = state.sessions.find((s) => s.id === sessionId);\n\t\tif (!session) return;\n\n\t\tsession.status = SessionStatus.RUNNING;\n\t\tsession.startedAt = new Date();\n\t\tsession.currentStage = Stage.PLAN;\n\n\t\tstate.currentStage = Stage.PLAN;\n\t\tstate.isStreaming = true;\n\t\tstate.streamingOutput = '';\n\n\t\t// Trigger reactivity\n\t\tstate.sessions = [...state.sessions];\n\t},\n\n\tupdateStageOutput(sessionId: string, stage: PAORTStage, output: StageOutput): void {\n\t\tconst session = state.sessions.find((s) => s.id === sessionId);\n\t\tif (!session) return;\n\n\t\t// Update stage output\n\t\tswitch (stage) {\n\t\t\tcase Stage.PLAN:\n\t\t\t\tsession.stages.plan = output;\n\t\t\t\tbreak;\n\t\t\tcase Stage.ACT:\n\t\t\t\tsession.stages.act = output;\n\t\t\t\tbreak;\n\t\t\tcase Stage.OBSERVE:\n\t\t\t\tsession.stages.observe = output;\n\t\t\t\tbreak;\n\t\t\tcase Stage.REFLECT:\n\t\t\t\tsession.stages.reflect = output;\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Trigger reactivity\n\t\tstate.sessions = [...state.sessions];\n\t},\n\n\tappendStreamingOutput(content: string): void {\n\t\tstate.streamingOutput += content;\n\t},\n\n\tclearStreamingOutput(): void {\n\t\tstate.streamingOutput = '';\n\t},\n\n\tadvanceStage(sessionId: string, nextStage: PAORTStage | null): void {\n\t\tconst session = state.sessions.find((s) => s.id === sessionId);\n\t\tif (!session) return;\n\n\t\tif (nextStage) {\n\t\t\tsession.currentStage = nextStage;\n\t\t\tstate.currentStage = nextStage;\n\t\t\tstate.streamingOutput = '';\n\t\t} else {\n\t\t\t// No next stage means we're done\n\t\t\tsession.currentStage = undefined;\n\t\t\tstate.currentStage = null;\n\t\t\tstate.isStreaming = false;\n\t\t}\n\n\t\t// Trigger reactivity\n\t\tstate.sessions = [...state.sessions];\n\t},\n\n\tcompleteSession(sessionId: string, deliverable: PlanningDeliverable): void {\n\t\tconst session = state.sessions.find((s) => s.id === sessionId);\n\t\tif (!session) return;\n\n\t\tsession.status = SessionStatus.COMPLETED;\n\t\tsession.completedAt = new Date();\n\t\tsession.deliverable = deliverable;\n\t\tsession.currentStage = undefined;\n\n\t\tstate.currentStage = null;\n\t\tstate.isStreaming = false;\n\t\tstate.streamingOutput = '';\n\n\t\t// Trigger reactivity\n\t\tstate.sessions = [...state.sessions];\n\t},\n\n\tfailSession(sessionId: string, error: string): void {\n\t\tconst session = state.sessions.find((s) => s.id === sessionId);\n\t\tif (!session) return;\n\n\t\tsession.status = SessionStatus.FAILED;\n\t\tsession.completedAt = new Date();\n\t\tsession.error = error;\n\t\tsession.currentStage = undefined;\n\n\t\tstate.currentStage = null;\n\t\tstate.isStreaming = false;\n\t\tstate.streamingOutput = '';\n\n\t\t// Trigger reactivity\n\t\tstate.sessions = [...state.sessions];\n\t},\n\n\tcancelSession(sessionId: string): void {\n\t\tconst session = state.sessions.find((s) => s.id === sessionId);\n\t\tif (!session) return;\n\n\t\tsession.status = SessionStatus.CANCELLED;\n\t\tsession.completedAt = new Date();\n\t\tsession.currentStage = undefined;\n\n\t\tif (state.currentSession?.id === sessionId) {\n\t\t\tstate.currentStage = null;\n\t\t\tstate.isStreaming = false;\n\t\t\tstate.streamingOutput = '';\n\t\t}\n\n\t\t// Trigger reactivity\n\t\tstate.sessions = [...state.sessions];\n\t},\n\n\tsetCurrentSession(sessionId: string | null): void {\n\t\tif (sessionId === null) {\n\t\t\tstate.currentSession = null;\n\t\t\treturn;\n\t\t}\n\n\t\tconst session = state.sessions.find((s) => s.id === sessionId);\n\t\tif (session) {\n\t\t\tstate.currentSession = session;\n\t\t}\n\t},\n\n\tdeleteSession(sessionId: string): void {\n\t\tstate.sessions = state.sessions.filter((s) => s.id !== sessionId);\n\n\t\tif (state.currentSession?.id === sessionId) {\n\t\t\tstate.currentSession = null;\n\t\t\tstate.currentStage = null;\n\t\t\tstate.isStreaming = false;\n\t\t\tstate.streamingOutput = '';\n\t\t}\n\t},\n\n\tclearAll(): void {\n\t\tstate.sessions = [];\n\t\tstate.currentSession = null;\n\t\tstate.isStreaming = false;\n\t\tstate.streamingOutput = '';\n\t\tstate.currentStage = null;\n\t}\n};\n\n// ═══════════════════════════════════════════════════════════════════════\n// Helper Functions\n// ═══════════════════════════════════════════════════════════════════════\n\nfunction generateSessionId(): string {\n\treturn `planning_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n","/**\n * SSE Streaming Service\n *\n * Handles Server-Sent Events (SSE) streaming for real-time agent output.\n */\n\nimport type { StreamChunk } from '$lib/types/agents';\nimport { classifyError, createNetworkError, type AppError } from '$lib/utils/errors';\n\n// ═══════════════════════════════════════════════════════════════════════\n// Types\n// ═══════════════════════════════════════════════════════════════════════\n\nexport interface StreamOptions {\n\tonChunk?: (chunk: string) => void;\n\tonStageStart?: (stage: string) => void;\n\tonStageEnd?: (stage: string, output: unknown) => void;\n\tonComplete?: (result: unknown) => void;\n\tonError?: (error: AppError) => void;\n\treconnect?: boolean;\n\treconnectDelay?: number;\n\tmaxReconnectAttempts?: number;\n}\n\nexport interface StreamSubscription {\n\tclose: () => void;\n\tpause: () => void;\n\tresume: () => void;\n\treadonly isActive: boolean;\n\treadonly isPaused: boolean;\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Streaming Service\n// ═══════════════════════════════════════════════════════════════════════\n\nclass StreamingService {\n\tprivate activeStreams: Map<string, EventSource> = new Map();\n\n\t/**\n\t * Subscribe to an SSE stream\n\t */\n\tsubscribe(\n\t\turl: string,\n\t\toptions: StreamOptions = {}\n\t): StreamSubscription {\n\t\tconst {\n\t\t\tonChunk,\n\t\t\tonStageStart,\n\t\t\tonStageEnd,\n\t\t\tonComplete,\n\t\t\tonError,\n\t\t\treconnect = true,\n\t\t\treconnectDelay = 3000,\n\t\t\tmaxReconnectAttempts = 5\n\t\t} = options;\n\n\t\tlet eventSource: EventSource | null = null;\n\t\tlet reconnectAttempts = 0;\n\t\tlet isPaused = false;\n\t\tlet isClosed = false;\n\t\tlet reconnectTimer: ReturnType<typeof setTimeout> | null = null;\n\n\t\tconst connect = () => {\n\t\t\tif (isClosed) return;\n\n\t\t\ttry {\n\t\t\t\teventSource = new EventSource(url);\n\t\t\t\tthis.activeStreams.set(url, eventSource);\n\n\t\t\t\t// Handle chunk messages\n\t\t\t\teventSource.addEventListener('chunk', (event: MessageEvent) => {\n\t\t\t\t\tif (isPaused || isClosed) return;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst chunk: StreamChunk = JSON.parse(event.data);\n\t\t\t\t\t\tif (chunk.type === 'chunk' && typeof chunk.data === 'object' && chunk.data !== null) {\n\t\t\t\t\t\t\tconst chunkData = chunk.data as { content?: string };\n\t\t\t\t\t\t\tif (chunkData.content && onChunk) {\n\t\t\t\t\t\t\t\tonChunk(chunkData.content);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tconsole.error('[StreamingService] Failed to parse chunk:', err);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Handle stage start\n\t\t\t\teventSource.addEventListener('stage_start', (event: MessageEvent) => {\n\t\t\t\t\tif (isPaused || isClosed) return;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst chunk: StreamChunk = JSON.parse(event.data);\n\t\t\t\t\t\tif (chunk.type === 'stage_start' && typeof chunk.data === 'object' && chunk.data !== null) {\n\t\t\t\t\t\t\tconst stageData = chunk.data as { stage?: string };\n\t\t\t\t\t\t\tif (stageData.stage && onStageStart) {\n\t\t\t\t\t\t\t\tonStageStart(stageData.stage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tconsole.error('[StreamingService] Failed to parse stage_start:', err);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Handle stage end\n\t\t\t\teventSource.addEventListener('stage_end', (event: MessageEvent) => {\n\t\t\t\t\tif (isPaused || isClosed) return;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst chunk: StreamChunk = JSON.parse(event.data);\n\t\t\t\t\t\tif (chunk.type === 'stage_end' && typeof chunk.data === 'object' && chunk.data !== null) {\n\t\t\t\t\t\t\tconst stageData = chunk.data as { stage?: string; output?: unknown };\n\t\t\t\t\t\t\tif (stageData.stage && onStageEnd) {\n\t\t\t\t\t\t\t\tonStageEnd(stageData.stage, stageData.output);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tconsole.error('[StreamingService] Failed to parse stage_end:', err);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Handle completion\n\t\t\t\teventSource.addEventListener('complete', (event: MessageEvent) => {\n\t\t\t\t\tif (isPaused || isClosed) return;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst chunk: StreamChunk = JSON.parse(event.data);\n\t\t\t\t\t\tif (chunk.type === 'complete' && typeof chunk.data === 'object' && chunk.data !== null) {\n\t\t\t\t\t\t\tconst completeData = chunk.data as { result?: unknown };\n\t\t\t\t\t\t\tif (onComplete) {\n\t\t\t\t\t\t\t\tonComplete(completeData.result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tconsole.error('[StreamingService] Failed to parse complete:', err);\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tcloseStream();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Handle errors from stream\n\t\t\t\teventSource.addEventListener('error', () => {\n\t\t\t\t\tif (isClosed) return;\n\n\t\t\t\t\tconst error = createNetworkError('Stream connection error');\n\n\t\t\t\t\t// Attempt reconnection\n\t\t\t\t\tif (reconnect && reconnectAttempts < maxReconnectAttempts) {\n\t\t\t\t\t\treconnectAttempts++;\n\t\t\t\t\t\tconsole.log(`[StreamingService] Reconnecting (attempt ${reconnectAttempts}/${maxReconnectAttempts})...`);\n\n\t\t\t\t\t\teventSource?.close();\n\t\t\t\t\t\tthis.activeStreams.delete(url);\n\n\t\t\t\t\t\treconnectTimer = setTimeout(() => {\n\t\t\t\t\t\t\tconnect();\n\t\t\t\t\t\t}, reconnectDelay);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (onError) {\n\t\t\t\t\t\t\tonError(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcloseStream();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Reset reconnect attempts on successful connection\n\t\t\t\teventSource.addEventListener('open', () => {\n\t\t\t\t\treconnectAttempts = 0;\n\t\t\t\t\tconsole.log('[StreamingService] Stream connected');\n\t\t\t\t});\n\n\t\t\t} catch (err) {\n\t\t\t\tconst error = classifyError(err);\n\t\t\t\tif (onError) {\n\t\t\t\t\tonError(error);\n\t\t\t\t}\n\t\t\t\tcloseStream();\n\t\t\t}\n\t\t};\n\n\t\tconst closeStream = () => {\n\t\t\tisClosed = true;\n\t\t\tisPaused = false;\n\n\t\t\tif (reconnectTimer) {\n\t\t\t\tclearTimeout(reconnectTimer);\n\t\t\t\treconnectTimer = null;\n\t\t\t}\n\n\t\t\tif (eventSource) {\n\t\t\t\teventSource.close();\n\t\t\t\tthis.activeStreams.delete(url);\n\t\t\t\teventSource = null;\n\t\t\t}\n\t\t};\n\n\t\tconst pauseStream = () => {\n\t\t\tisPaused = true;\n\t\t};\n\n\t\tconst resumeStream = () => {\n\t\t\tisPaused = false;\n\t\t};\n\n\t\t// Start the connection\n\t\tconnect();\n\n\t\t// Return subscription interface\n\t\treturn {\n\t\t\tclose: closeStream,\n\t\t\tpause: pauseStream,\n\t\t\tresume: resumeStream,\n\t\t\tget isActive() {\n\t\t\t\treturn !isClosed && eventSource !== null;\n\t\t\t},\n\t\t\tget isPaused() {\n\t\t\t\treturn isPaused;\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Close all active streams\n\t */\n\tcloseAll(): void {\n\t\tthis.activeStreams.forEach((eventSource) => {\n\t\t\teventSource.close();\n\t\t});\n\t\tthis.activeStreams.clear();\n\t}\n\n\t/**\n\t * Get count of active streams\n\t */\n\tget activeStreamCount(): number {\n\t\treturn this.activeStreams.size;\n\t}\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Export Singleton\n// ═══════════════════════════════════════════════════════════════════════\n\nexport const streamingService = new StreamingService();\n","/**\n * Planning Service\n *\n * Business logic for planning agent operations.\n */\n\nimport type { PlanningRequest, PlanningDeliverable, StageOutput } from '$lib/types/agents';\nimport { PAORTStage } from '$lib/types/agents';\nimport { planningStore } from '$lib/stores/planning.svelte';\nimport { streamingService } from './streaming';\nimport { classifyError, createValidationError, type AppError } from '$lib/utils/errors';\n\n// ═══════════════════════════════════════════════════════════════════════\n// Configuration\n// ═══════════════════════════════════════════════════════════════════════\n\nconst API_BASE_URL = 'http://localhost:8787'; // ForgeAgents API\n\n// ═══════════════════════════════════════════════════════════════════════\n// Validation\n// ═══════════════════════════════════════════════════════════════════════\n\nexport function validatePlanningRequest(request: PlanningRequest): AppError | null {\n\tif (!request.title || request.title.trim().length === 0) {\n\t\treturn createValidationError('Title is required');\n\t}\n\n\tif (request.title.length > 200) {\n\t\treturn createValidationError('Title must be 200 characters or less');\n\t}\n\n\tif (!request.description || request.description.trim().length === 0) {\n\t\treturn createValidationError('Description is required');\n\t}\n\n\tif (request.description.length > 5000) {\n\t\treturn createValidationError('Description must be 5000 characters or less');\n\t}\n\n\treturn null;\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Planning Operations\n// ═══════════════════════════════════════════════════════════════════════\n\nexport async function startPlanningSession(\n\trequest: PlanningRequest\n): Promise<{ success: boolean; sessionId?: string; error?: AppError }> {\n\t// Validate request\n\tconst validationError = validatePlanningRequest(request);\n\tif (validationError) {\n\t\treturn { success: false, error: validationError };\n\t}\n\n\ttry {\n\t\t// Create session\n\t\tconst session = planningStore.createSession(request);\n\n\t\t// Start session\n\t\tplanningStore.startSession(session.id);\n\n\t\t// Subscribe to streaming updates\n\t\tconst streamUrl = `${API_BASE_URL}/api/v1/bds/planning/${session.id}/stream`;\n\n\t\tstreamingService.subscribe(streamUrl, {\n\t\t\tonChunk: (content: string) => {\n\t\t\t\tplanningStore.appendStreamingOutput(content);\n\t\t\t},\n\n\t\t\tonStageStart: (stage: string) => {\n\t\t\t\tconst paortStage = stage as PAORTStage;\n\t\t\t\tplanningStore.advanceStage(session.id, paortStage);\n\t\t\t},\n\n\t\t\tonStageEnd: (stage: string, output: unknown) => {\n\t\t\t\tconst paortStage = stage as PAORTStage;\n\t\t\t\tconst stageOutput = output as StageOutput;\n\t\t\t\tplanningStore.updateStageOutput(session.id, paortStage, stageOutput);\n\t\t\t\tplanningStore.clearStreamingOutput();\n\t\t\t},\n\n\t\t\tonComplete: (result: unknown) => {\n\t\t\t\tconst deliverable = result as PlanningDeliverable;\n\t\t\t\tplanningStore.completeSession(session.id, deliverable);\n\t\t\t},\n\n\t\t\tonError: (error: AppError) => {\n\t\t\t\tplanningStore.failSession(session.id, error.message);\n\t\t\t}\n\t\t});\n\n\t\treturn { success: true, sessionId: session.id };\n\t} catch (error) {\n\t\tconst appError = classifyError(error);\n\t\treturn { success: false, error: appError };\n\t}\n}\n\nexport function cancelPlanningSession(sessionId: string): void {\n\tplanningStore.cancelSession(sessionId);\n\t// TODO: Call API to cancel server-side session\n}\n\nexport function deletePlanningSession(sessionId: string): void {\n\tplanningStore.deleteSession(sessionId);\n\t// TODO: Call API to delete session from DataForge\n}\n\n// ═══════════════════════════════════════════════════════════════════════\n// Helper Functions\n// ═══════════════════════════════════════════════════════════════════════\n\nexport function formatDuration(ms: number): string {\n\tif (ms < 1000) return `${ms}ms`;\n\tif (ms < 60000) return `${(ms / 1000).toFixed(1)}s`;\n\tif (ms < 3600000) return `${(ms / 60000).toFixed(1)}m`;\n\treturn `${(ms / 3600000).toFixed(1)}h`;\n}\n\nexport function formatCost(cost: number): string {\n\tif (cost < 0.01) return `$${cost.toFixed(4)}`;\n\treturn `$${cost.toFixed(2)}`;\n}\n\nexport function formatTokens(tokens: number): string {\n\tif (tokens < 1000) return `${tokens} tokens`;\n\tif (tokens < 1000000) return `${(tokens / 1000).toFixed(1)}K tokens`;\n\treturn `${(tokens / 1000000).toFixed(1)}M tokens`;\n}\n","<script lang=\"ts\">\n\timport Button from '$lib/components/Button.svelte';\n\timport Input from '$lib/components/Input.svelte';\n\timport Textarea from '$lib/components/Textarea.svelte';\n\timport Alert from '$lib/components/Alert.svelte';\n\timport { startPlanningSession, validatePlanningRequest } from '$lib/services/planningService';\n\timport { planningStore } from '$lib/stores/planning.svelte';\n\timport type { PlanningRequest } from '$lib/types/agents';\n\timport type { AppError } from '$lib/utils/errors';\n\n\tlet title = $state('');\n\tlet description = $state('');\n\tlet error = $state<AppError | null>(null);\n\tlet isSubmitting = $state(false);\n\n\tconst isStreaming = $derived(planningStore.isStreaming);\n\n\tasync function handleSubmit(): Promise<void> {\n\t\terror = null;\n\n\t\tconst request: PlanningRequest = {\n\t\t\ttitle: title.trim(),\n\t\t\tdescription: description.trim()\n\t\t};\n\n\t\t// Validate\n\t\tconst validationError = validatePlanningRequest(request);\n\t\tif (validationError) {\n\t\t\terror = validationError;\n\t\t\treturn;\n\t\t}\n\n\t\tisSubmitting = true;\n\n\t\ttry {\n\t\t\tconst result = await startPlanningSession(request);\n\n\t\t\tif (!result.success && result.error) {\n\t\t\t\terror = result.error;\n\t\t\t\tisSubmitting = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Success - clear form\n\t\t\ttitle = '';\n\t\t\tdescription = '';\n\t\t\tisSubmitting = false;\n\t\t} catch (err) {\n\t\t\tisSubmitting = false;\n\t\t}\n\t}\n\n\tfunction handleClear(): void {\n\t\ttitle = '';\n\t\tdescription = '';\n\t\terror = null;\n\t}\n</script>\n\n<form on:submit|preventDefault={handleSubmit} class=\"request-form\">\n\t{#if error}\n\t\t<Alert variant=\"error\">\n\t\t\t{error.userMessage}\n\t\t</Alert>\n\t{/if}\n\n\t<Input\n\t\tlabel=\"Task Title\"\n\t\tplaceholder=\"e.g., Add user authentication system\"\n\t\tbind:value={title}\n\t\tmaxlength={200}\n\t\trequired\n\t\tdisabled={isStreaming || isSubmitting}\n\t/>\n\n\t<Textarea\n\t\tlabel=\"Description\"\n\t\tplaceholder=\"Provide detailed requirements, constraints, and context for this task...\"\n\t\tbind:value={description}\n\t\trows={8}\n\t\tmaxlength={5000}\n\t\trequired\n\t\tdisabled={isStreaming || isSubmitting}\n\t/>\n\n\t<div class=\"form-actions\">\n\t\t<Button\n\t\t\ttype=\"submit\"\n\t\t\tvariant=\"primary\"\n\t\t\tdisabled={isStreaming || isSubmitting || !title.trim() || !description.trim()}\n\t\t\tloading={isSubmitting}\n\t\t>\n\t\t\t{isSubmitting ? 'Starting...' : 'Start Planning'}\n\t\t</Button>\n\n\t\t<Button type=\"button\" variant=\"secondary\" onclick={handleClear} disabled={isStreaming || isSubmitting}>\n\t\t\tClear\n\t\t</Button>\n\t</div>\n\n\t<div class=\"form-hint\">\n\t\t<p>\n\t\t\tThe Planning Agent will analyze your request and generate a detailed implementation plan with\n\t\t\tspecific steps, acceptance criteria, and risk assessment.\n\t\t</p>\n\t</div>\n</form>\n\n<style>\n\t.request-form {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t}\n\n\t.form-actions {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tmargin-top: 8px;\n\t}\n\n\t.form-hint {\n\t\tmargin-top: 8px;\n\t\tpadding: 12px;\n\t\tbackground: rgba(193, 151, 69, 0.05);\n\t\tborder-left: 3px solid var(--color-brass);\n\t\tborder-radius: 4px;\n\t}\n\n\t.form-hint p {\n\t\tcolor: var(--color-text-muted);\n\t\tfont-size: 0.875rem;\n\t\tline-height: 1.5;\n\t\tmargin: 0;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { PAORTStage } from '$lib/types/agents';\n\timport type { PAORTStage as PAORTStageType } from '$lib/types/agents';\n\n\tinterface Props {\n\t\tstage: PAORTStageType | null;\n\t}\n\n\tlet { stage }: Props = $props();\n\n\tconst stages = [\n\t\t{ key: PAORTStage.PLAN, label: 'Plan', description: 'Define strategy' },\n\t\t{ key: PAORTStage.ACT, label: 'Act', description: 'Execute steps' },\n\t\t{ key: PAORTStage.OBSERVE, label: 'Observe', description: 'Analyze results' },\n\t\t{ key: PAORTStage.REFLECT, label: 'Reflect', description: 'Evaluate success' }\n\t];\n\n\tfunction getStageIndex(stageKey: PAORTStageType | null): number {\n\t\tif (!stageKey) return -1;\n\t\treturn stages.findIndex((s) => s.key === stageKey);\n\t}\n\n\tconst currentIndex = $derived(getStageIndex(stage));\n</script>\n\n<div class=\"stage-progress\">\n\t<div class=\"stages\">\n\t\t{#each stages as stageItem, index}\n\t\t\t{@const isActive = index === currentIndex}\n\t\t\t{@const isCompleted = currentIndex > index}\n\t\t\t{@const isPending = currentIndex < index}\n\n\t\t\t<div class=\"stage\" class:active={isActive} class:completed={isCompleted} class:pending={isPending}>\n\t\t\t\t<div class=\"stage-indicator\">\n\t\t\t\t\t<div class=\"stage-number\">\n\t\t\t\t\t\t{#if isCompleted}\n\t\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M13.5 4.5L6 12L2.5 8.5\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t{:else if isActive}\n\t\t\t\t\t\t\t<div class=\"pulse\"></div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{index + 1}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"stage-content\">\n\t\t\t\t\t<div class=\"stage-label\">{stageItem.label}</div>\n\t\t\t\t\t<div class=\"stage-description\">{stageItem.description}</div>\n\t\t\t\t</div>\n\n\t\t\t\t{#if index < stages.length - 1}\n\t\t\t\t\t<div class=\"stage-connector\" class:completed={isCompleted}></div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t{/each}\n\t</div>\n</div>\n\n<style>\n\t.stage-progress {\n\t\tmargin-bottom: 24px;\n\t}\n\n\t.stages {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tposition: relative;\n\t}\n\n\t.stage {\n\t\tflex: 1;\n\t\tposition: relative;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\ttext-align: center;\n\t}\n\n\t.stage-indicator {\n\t\twidth: 48px;\n\t\theight: 48px;\n\t\tborder-radius: 50%;\n\t\tborder: 2px solid var(--color-border);\n\t\tbackground: var(--color-surface);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmargin-bottom: 12px;\n\t\ttransition: all 0.3s ease;\n\t\tposition: relative;\n\t\tz-index: 2;\n\t}\n\n\t.stage.active .stage-indicator {\n\t\tborder-color: var(--color-brass);\n\t\tbackground: rgba(193, 151, 69, 0.1);\n\t}\n\n\t.stage.completed .stage-indicator {\n\t\tborder-color: var(--color-success);\n\t\tbackground: rgba(73, 200, 131, 0.1);\n\t}\n\n\t.stage-number {\n\t\tfont-weight: 600;\n\t\tcolor: var(--color-text-muted);\n\t}\n\n\t.stage.active .stage-number {\n\t\tcolor: var(--color-brass);\n\t}\n\n\t.stage.completed .stage-number {\n\t\tcolor: var(--color-success);\n\t}\n\n\t.pulse {\n\t\twidth: 12px;\n\t\theight: 12px;\n\t\tborder-radius: 50%;\n\t\tbackground: var(--color-brass);\n\t\tanimation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n\t}\n\n\t@keyframes pulse {\n\t\t0%,\n\t\t100% {\n\t\t\topacity: 1;\n\t\t}\n\t\t50% {\n\t\t\topacity: 0.5;\n\t\t}\n\t}\n\n\t.stage-content {\n\t\tmin-height: 48px;\n\t}\n\n\t.stage-label {\n\t\tfont-weight: 600;\n\t\tcolor: var(--color-text);\n\t\tmargin-bottom: 4px;\n\t\tfont-size: 0.875rem;\n\t}\n\n\t.stage.active .stage-label {\n\t\tcolor: var(--color-brass);\n\t}\n\n\t.stage-description {\n\t\tfont-size: 0.75rem;\n\t\tcolor: var(--color-text-muted);\n\t}\n\n\t.stage-connector {\n\t\tposition: absolute;\n\t\ttop: 24px;\n\t\tleft: 50%;\n\t\tright: -50%;\n\t\theight: 2px;\n\t\tbackground: var(--color-border);\n\t\ttransform: translateY(-50%);\n\t\ttransition: background 0.3s ease;\n\t\tz-index: 1;\n\t}\n\n\t.stage-connector.completed {\n\t\tbackground: var(--color-success);\n\t}\n\n\t@media (max-width: 768px) {\n\t\t.stages {\n\t\t\tflex-direction: column;\n\t\t\talign-items: flex-start;\n\t\t}\n\n\t\t.stage {\n\t\t\tflex-direction: row;\n\t\t\talign-items: flex-start;\n\t\t\ttext-align: left;\n\t\t\twidth: 100%;\n\t\t}\n\n\t\t.stage-indicator {\n\t\t\tmargin-bottom: 0;\n\t\t\tmargin-right: 16px;\n\t\t\tflex-shrink: 0;\n\t\t}\n\n\t\t.stage-connector {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { planningStore } from '$lib/stores/planning.svelte';\n\timport Badge from '$lib/components/Badge.svelte';\n\timport { SessionStatus } from '$lib/types/agents';\n\timport type { PlanningSession } from '$lib/types/agents';\n\n\tconst sessions = $derived(planningStore.sessions);\n\tconst currentSession = $derived(planningStore.currentSession);\n\n\tfunction formatDate(date: Date): string {\n\t\treturn new Intl.DateTimeFormat('en-US', {\n\t\t\tmonth: 'short',\n\t\t\tday: 'numeric',\n\t\t\thour: '2-digit',\n\t\t\tminute: '2-digit'\n\t\t}).format(date);\n\t}\n\n\tfunction getStatusVariant(status: SessionStatus): 'success' | 'error' | 'warning' | 'info' {\n\t\tswitch (status) {\n\t\t\tcase SessionStatus.COMPLETED:\n\t\t\t\treturn 'success';\n\t\t\tcase SessionStatus.FAILED:\n\t\t\tcase SessionStatus.CANCELLED:\n\t\t\t\treturn 'error';\n\t\t\tcase SessionStatus.RUNNING:\n\t\t\t\treturn 'warning';\n\t\t\tdefault:\n\t\t\t\treturn 'info';\n\t\t}\n\t}\n\n\tfunction getStatusLabel(status: SessionStatus): string {\n\t\tswitch (status) {\n\t\t\tcase SessionStatus.COMPLETED:\n\t\t\t\treturn 'Completed';\n\t\t\tcase SessionStatus.FAILED:\n\t\t\t\treturn 'Failed';\n\t\t\tcase SessionStatus.CANCELLED:\n\t\t\t\treturn 'Cancelled';\n\t\t\tcase SessionStatus.RUNNING:\n\t\t\t\treturn 'Running';\n\t\t\tcase SessionStatus.PENDING:\n\t\t\t\treturn 'Pending';\n\t\t\tdefault:\n\t\t\t\treturn 'Unknown';\n\t\t}\n\t}\n\n\tfunction selectSession(session: PlanningSession): void {\n\t\tplanningStore.setCurrentSession(session.id);\n\t}\n</script>\n\n<div class=\"session-history\">\n\t{#if sessions.length === 0}\n\t\t<div class=\"empty-state\">\n\t\t\t<p>No planning sessions yet</p>\n\t\t</div>\n\t{:else}\n\t\t<div class=\"session-list\">\n\t\t\t{#each sessions.slice().reverse() as session}\n\t\t\t\t<button\n\t\t\t\t\tclass=\"session-item\"\n\t\t\t\t\tclass:active={currentSession?.id === session.id}\n\t\t\t\t\tonclick={() => selectSession(session)}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"session-header\">\n\t\t\t\t\t\t<span class=\"session-title\">{session.request.title}</span>\n\t\t\t\t\t\t<Badge variant={getStatusVariant(session.status)}>\n\t\t\t\t\t\t\t{getStatusLabel(session.status)}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"session-meta\">\n\t\t\t\t\t\t<span class=\"session-date\">\n\t\t\t\t\t\t\t{formatDate(session.createdAt)}\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t{#if session.completedAt && session.startedAt}\n\t\t\t\t\t\t\t{@const duration = session.completedAt.getTime() - session.startedAt.getTime()}\n\t\t\t\t\t\t\t<span class=\"session-duration\">\n\t\t\t\t\t\t\t\t{duration < 60000 ? `${Math.round(duration / 1000)}s` : `${Math.round(duration / 60000)}m`}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t.session-history {\n\t\tmax-height: 400px;\n\t\toverflow-y: auto;\n\t}\n\n\t.empty-state {\n\t\tpadding: 24px;\n\t\ttext-align: center;\n\t\tcolor: var(--color-text-muted);\n\t}\n\n\t.session-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t}\n\n\t.session-item {\n\t\twidth: 100%;\n\t\tpadding: 12px;\n\t\tbackground: var(--color-surface);\n\t\tborder: 1px solid var(--color-border);\n\t\tborder-radius: 4px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s ease;\n\t\ttext-align: left;\n\t}\n\n\t.session-item:hover {\n\t\tborder-color: var(--color-brass);\n\t\tbackground: var(--color-surface-alt);\n\t}\n\n\t.session-item.active {\n\t\tborder-color: var(--color-brass);\n\t\tbackground: rgba(193, 151, 69, 0.1);\n\t}\n\n\t.session-header {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tgap: 12px;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.session-title {\n\t\tfont-weight: 600;\n\t\tcolor: var(--color-text);\n\t\tfont-size: 0.875rem;\n\t\tflex: 1;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.session-meta {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tfont-size: 0.75rem;\n\t\tcolor: var(--color-text-muted);\n\t}\n\n\t.session-date,\n\t.session-duration {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\n\t/* Custom scrollbar */\n\t.session-history::-webkit-scrollbar {\n\t\twidth: 6px;\n\t}\n\n\t.session-history::-webkit-scrollbar-track {\n\t\tbackground: var(--color-surface);\n\t\tborder-radius: 3px;\n\t}\n\n\t.session-history::-webkit-scrollbar-thumb {\n\t\tbackground: var(--color-border-dark);\n\t\tborder-radius: 3px;\n\t}\n\n\t.session-history::-webkit-scrollbar-thumb:hover {\n\t\tbackground: var(--color-brass);\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { planningStore } from '$lib/stores/planning.svelte';\n\timport ErrorBoundary from '$lib/components/ErrorBoundary.svelte';\n\timport Panel from '$lib/components/Panel.svelte';\n\timport RequestForm from '$lib/components/panels/planning/RequestForm.svelte';\n\timport StageProgress from '$lib/components/panels/planning/StageProgress.svelte';\n\timport StageOutput from '$lib/components/panels/planning/StageOutput.svelte';\n\timport SessionHistory from '$lib/components/panels/planning/SessionHistory.svelte';\n\timport DeliverableViewer from '$lib/components/panels/planning/DeliverableViewer.svelte';\n\timport { SessionStatus } from '$lib/types/agents';\n\n\tconst currentSession = $derived(planningStore.currentSession);\n\tconst isStreaming = $derived(planningStore.isStreaming);\n\tconst currentStage = $derived(planningStore.currentStage);\n\tconst streamingOutput = $derived(planningStore.streamingOutput);\n</script>\n\n<ErrorBoundary>\n\t<div class=\"planning-page\">\n\t\t<header class=\"page-header\">\n\t\t\t<h1>Planning Agent</h1>\n\t\t\t<p class=\"text-muted\">Define and plan complex implementation tasks</p>\n\t\t</header>\n\n\t\t<div class=\"content-grid\">\n\t\t\t<!-- Left Column: Input & Controls -->\n\t\t\t<div class=\"left-column\">\n\t\t\t\t<Panel title=\"New Planning Request\">\n\t\t\t\t\t<RequestForm />\n\t\t\t\t</Panel>\n\n\t\t\t\t{#if currentSession}\n\t\t\t\t\t<Panel title=\"Session History\" class=\"mt-6\">\n\t\t\t\t\t\t<SessionHistory />\n\t\t\t\t\t</Panel>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<!-- Right Column: Output & Progress -->\n\t\t\t<div class=\"right-column\">\n\t\t\t\t{#if currentSession}\n\t\t\t\t\t{#if currentSession.status === SessionStatus.RUNNING || currentSession.status === SessionStatus.PENDING}\n\t\t\t\t\t\t<!-- Active Session -->\n\t\t\t\t\t\t<Panel title=\"Planning in Progress\">\n\t\t\t\t\t\t\t<StageProgress stage={currentStage} />\n\t\t\t\t\t\t\t<StageOutput output={streamingOutput} isStreaming={isStreaming} />\n\t\t\t\t\t\t</Panel>\n\t\t\t\t\t{:else if currentSession.status === SessionStatus.COMPLETED && currentSession.deliverable}\n\t\t\t\t\t\t<!-- Completed Session -->\n\t\t\t\t\t\t<Panel title=\"Planning Complete\">\n\t\t\t\t\t\t\t<DeliverableViewer deliverable={currentSession.deliverable} />\n\t\t\t\t\t\t</Panel>\n\t\t\t\t\t{:else if currentSession.status === SessionStatus.FAILED}\n\t\t\t\t\t\t<!-- Failed Session -->\n\t\t\t\t\t\t<Panel title=\"Planning Failed\" variant=\"error\">\n\t\t\t\t\t\t\t<div class=\"error-message\">\n\t\t\t\t\t\t\t\t<h3>Error</h3>\n\t\t\t\t\t\t\t\t<p>{currentSession.error || 'An unknown error occurred'}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Panel>\n\t\t\t\t\t{/if}\n\t\t\t\t{:else}\n\t\t\t\t\t<!-- No Session -->\n\t\t\t\t\t<Panel title=\"Welcome\">\n\t\t\t\t\t\t<div class=\"empty-state\">\n\t\t\t\t\t\t\t<h2>Start a Planning Session</h2>\n\t\t\t\t\t\t\t<p>Fill out the form on the left to begin planning a new task.</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Panel>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</ErrorBoundary>\n\n<style>\n\t.planning-page {\n\t\tpadding: 24px;\n\t\tmax-width: 1400px;\n\t\tmargin: 0 auto;\n\t}\n\n\t.page-header {\n\t\tmargin-bottom: 24px;\n\t}\n\n\t.page-header h1 {\n\t\tfont-family: 'Cinzel', serif;\n\t\tfont-weight: 300;\n\t\tfont-size: 2rem;\n\t\tcolor: var(--color-text);\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.text-muted {\n\t\tcolor: var(--color-text-muted);\n\t\tfont-size: 0.875rem;\n\t}\n\n\t.content-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 24px;\n\t}\n\n\t@media (max-width: 1024px) {\n\t\t.content-grid {\n\t\t\tgrid-template-columns: 1fr;\n\t\t}\n\t}\n\n\t.mt-6 {\n\t\tmargin-top: 24px;\n\t}\n\n\t.error-message {\n\t\tpadding: 16px;\n\t\tbackground: rgba(232, 166, 77, 0.1);\n\t\tborder: 1px solid #e8a64d;\n\t\tborder-radius: 4px;\n\t}\n\n\t.error-message h3 {\n\t\tcolor: #e8a64d;\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.empty-state {\n\t\ttext-align: center;\n\t\tpadding: 48px 24px;\n\t\tcolor: var(--color-text-muted);\n\t}\n\n\t.empty-state h2 {\n\t\tfont-size: 1.5rem;\n\t\tcolor: var(--color-text);\n\t\tmargin-bottom: 12px;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\n\tinterface Props {\n\t\toutput: string;\n\t\tisStreaming: boolean;\n\t}\n\n\tlet { output, isStreaming }: Props = $props();\n\n\tlet outputContainer: HTMLDivElement;\n\tlet shouldAutoScroll = $state(true);\n\n\t// Auto-scroll to bottom when new content arrives\n\t$effect(() => {\n\t\tif (outputContainer && shouldAutoScroll && output) {\n\t\t\toutputContainer.scrollTop = outputContainer.scrollHeight;\n\t\t}\n\t});\n\n\tfunction handleScroll(): void {\n\t\tif (!outputContainer) return;\n\n\t\tconst { scrollTop, scrollHeight, clientHeight } = outputContainer;\n\t\tconst isNearBottom = scrollHeight - (scrollTop + clientHeight) < 100;\n\t\tshouldAutoScroll = isNearBottom;\n\t}\n</script>\n\n<div class=\"stage-output\">\n\t{#if isStreaming || output}\n\t\t<div\n\t\t\tbind:this={outputContainer}\n\t\t\tclass=\"output-container\"\n\t\t\tclass:streaming={isStreaming}\n\t\t\tonscroll={handleScroll}\n\t\t>\n\t\t\t{#if output}\n\t\t\t\t<pre class=\"output-text\">{output}</pre>\n\t\t\t{:else}\n\t\t\t\t<div class=\"loading-indicator\">\n\t\t\t\t\t<div class=\"spinner\"></div>\n\t\t\t\t\t<p>Waiting for output...</p>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t{#if isStreaming}\n\t\t\t\t<div class=\"streaming-indicator\">\n\t\t\t\t\t<div class=\"dot\"></div>\n\t\t\t\t\t<div class=\"dot\"></div>\n\t\t\t\t\t<div class=\"dot\"></div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t{#if !shouldAutoScroll && isStreaming}\n\t\t\t<button\n\t\t\t\tclass=\"scroll-to-bottom\"\n\t\t\t\tonclick={() => {\n\t\t\t\t\tshouldAutoScroll = true;\n\t\t\t\t\tif (outputContainer) {\n\t\t\t\t\t\toutputContainer.scrollTop = outputContainer.scrollHeight;\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M8 12L4 8H12L8 12Z\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\tScroll to bottom\n\t\t\t</button>\n\t\t{/if}\n\t{:else}\n\t\t<div class=\"empty-state\">\n\t\t\t<p>Output will appear here when the planning session starts.</p>\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t.stage-output {\n\t\tmargin-top: 24px;\n\t\tposition: relative;\n\t}\n\n\t.output-container {\n\t\tbackground: var(--color-bg);\n\t\tborder: 1px solid var(--color-border);\n\t\tborder-radius: 4px;\n\t\tpadding: 16px;\n\t\tmax-height: 500px;\n\t\toverflow-y: auto;\n\t\tfont-family: 'JetBrains Mono', monospace;\n\t\tfont-size: 0.875rem;\n\t\tline-height: 1.6;\n\t\tposition: relative;\n\t}\n\n\t.output-container.streaming {\n\t\tborder-color: var(--color-brass);\n\t}\n\n\t.output-text {\n\t\tmargin: 0;\n\t\twhite-space: pre-wrap;\n\t\tword-wrap: break-word;\n\t\tcolor: var(--color-text);\n\t}\n\n\t.loading-indicator {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 48px 24px;\n\t\tcolor: var(--color-text-muted);\n\t}\n\n\t.spinner {\n\t\twidth: 32px;\n\t\theight: 32px;\n\t\tborder: 3px solid rgba(193, 151, 69, 0.1);\n\t\tborder-top-color: var(--color-brass);\n\t\tborder-radius: 50%;\n\t\tanimation: spin 1s linear infinite;\n\t\tmargin-bottom: 16px;\n\t}\n\n\t@keyframes spin {\n\t\tto {\n\t\t\ttransform: rotate(360deg);\n\t\t}\n\t}\n\n\t.streaming-indicator {\n\t\tdisplay: flex;\n\t\tgap: 6px;\n\t\talign-items: center;\n\t\tmargin-top: 16px;\n\t\tpadding-top: 16px;\n\t\tborder-top: 1px solid var(--color-border);\n\t}\n\n\t.dot {\n\t\twidth: 8px;\n\t\theight: 8px;\n\t\tbackground: var(--color-brass);\n\t\tborder-radius: 50%;\n\t\tanimation: pulse-dot 1.4s ease-in-out infinite;\n\t}\n\n\t.dot:nth-child(1) {\n\t\tanimation-delay: 0s;\n\t}\n\n\t.dot:nth-child(2) {\n\t\tanimation-delay: 0.2s;\n\t}\n\n\t.dot:nth-child(3) {\n\t\tanimation-delay: 0.4s;\n\t}\n\n\t@keyframes pulse-dot {\n\t\t0%,\n\t\t80%,\n\t\t100% {\n\t\t\topacity: 0.3;\n\t\t\ttransform: scale(1);\n\t\t}\n\t\t40% {\n\t\t\topacity: 1;\n\t\t\ttransform: scale(1.2);\n\t\t}\n\t}\n\n\t.scroll-to-bottom {\n\t\tposition: absolute;\n\t\tbottom: 16px;\n\t\tright: 16px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 6px;\n\t\tpadding: 8px 12px;\n\t\tbackground: var(--color-brass);\n\t\tcolor: var(--color-bg);\n\t\tborder: none;\n\t\tborder-radius: 4px;\n\t\tfont-size: 0.75rem;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s ease;\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n\t}\n\n\t.scroll-to-bottom:hover {\n\t\tbackground: #d4a957;\n\t\ttransform: translateY(-2px);\n\t\tbox-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n\t}\n\n\t.empty-state {\n\t\tpadding: 48px 24px;\n\t\ttext-align: center;\n\t\tcolor: var(--color-text-muted);\n\t}\n\n\t/* Custom scrollbar */\n\t.output-container::-webkit-scrollbar {\n\t\twidth: 8px;\n\t}\n\n\t.output-container::-webkit-scrollbar-track {\n\t\tbackground: var(--color-surface);\n\t\tborder-radius: 4px;\n\t}\n\n\t.output-container::-webkit-scrollbar-thumb {\n\t\tbackground: var(--color-border-dark);\n\t\tborder-radius: 4px;\n\t}\n\n\t.output-container::-webkit-scrollbar-thumb:hover {\n\t\tbackground: var(--color-brass);\n\t}\n</style>\n","<script lang=\"ts\">\n\timport type { PlanningDeliverable } from '$lib/types/agents';\n\timport Button from '$lib/components/Button.svelte';\n\timport Badge from '$lib/components/Badge.svelte';\n\timport { formatTokens, formatCost, formatDuration } from '$lib/services/planningService';\n\n\tinterface Props {\n\t\tdeliverable: PlanningDeliverable;\n\t}\n\n\tlet { deliverable }: Props = $props();\n\n\tlet activeTab = $state<'plan' | 'prompt'>('plan');\n\n\tasync function copyToClipboard(text: string): Promise<void> {\n\t\ttry {\n\t\t\tawait navigator.clipboard.writeText(text);\n\t\t\t// TODO: Show success toast\n\t\t} catch (err) {\n\t\t\tconsole.error('Failed to copy:', err);\n\t\t}\n\t}\n\n\tfunction downloadAsFile(content: string, filename: string): void {\n\t\tconst blob = new Blob([content], { type: 'text/plain' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = filename;\n\t\ta.click();\n\t\tURL.revokeObjectURL(url);\n\t}\n</script>\n\n<div class=\"deliverable-viewer\">\n\t<!-- Tabs -->\n\t<div class=\"tabs\">\n\t\t<button class=\"tab\" class:active={activeTab === 'plan'} onclick={() => (activeTab = 'plan')}>\n\t\t\tImplementation Plan\n\t\t</button>\n\t\t<button class=\"tab\" class:active={activeTab === 'prompt'} onclick={() => (activeTab = 'prompt')}>\n\t\t\tExecution Prompt\n\t\t</button>\n\t</div>\n\n\t<!-- Tab Content -->\n\t<div class=\"tab-content\">\n\t\t{#if activeTab === 'plan'}\n\t\t\t<div class=\"plan-view\">\n\t\t\t\t<!-- Plan Header -->\n\t\t\t\t<div class=\"plan-header\">\n\t\t\t\t\t<h2>{deliverable.plan.title}</h2>\n\t\t\t\t\t<div class=\"plan-actions\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tonclick={() => copyToClipboard(JSON.stringify(deliverable.plan, null, 2))}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCopy\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tonclick={() => downloadAsFile(JSON.stringify(deliverable.plan, null, 2), `${deliverable.plan.title}.json`)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tDownload\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Overview -->\n\t\t\t\t<div class=\"plan-section\">\n\t\t\t\t\t<h3>Overview</h3>\n\t\t\t\t\t<p class=\"overview-text\">{deliverable.plan.overview}</p>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Estimated Effort -->\n\t\t\t\t<div class=\"plan-section\">\n\t\t\t\t\t<h3>Estimated Effort</h3>\n\t\t\t\t\t<Badge variant=\"info\">{deliverable.plan.estimatedEffort}</Badge>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Implementation Steps -->\n\t\t\t\t<div class=\"plan-section\">\n\t\t\t\t\t<h3>Implementation Steps</h3>\n\t\t\t\t\t<div class=\"steps-list\">\n\t\t\t\t\t\t{#each deliverable.plan.steps as step, index}\n\t\t\t\t\t\t\t<div class=\"step-card\">\n\t\t\t\t\t\t\t\t<div class=\"step-header\">\n\t\t\t\t\t\t\t\t\t<span class=\"step-number\">{index + 1}</span>\n\t\t\t\t\t\t\t\t\t<h4>{step.title}</h4>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<p class=\"step-description\">{step.description}</p>\n\n\t\t\t\t\t\t\t\t{#if step.acceptanceCriteria.length > 0}\n\t\t\t\t\t\t\t\t\t<div class=\"acceptance-criteria\">\n\t\t\t\t\t\t\t\t\t\t<h5>Acceptance Criteria:</h5>\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t{#each step.acceptanceCriteria as criterion}\n\t\t\t\t\t\t\t\t\t\t\t\t<li>{criterion}</li>\n\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if step.dependencies.length > 0}\n\t\t\t\t\t\t\t\t\t<div class=\"dependencies\">\n\t\t\t\t\t\t\t\t\t\t<strong>Dependencies:</strong>\n\t\t\t\t\t\t\t\t\t\t{step.dependencies.join(', ')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t<div class=\"step-meta\">\n\t\t\t\t\t\t\t\t\t<Badge variant=\"info\">{step.estimatedEffort}</Badge>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Risks -->\n\t\t\t\t{#if deliverable.plan.risks.length > 0}\n\t\t\t\t\t<div class=\"plan-section\">\n\t\t\t\t\t\t<h3>Risks & Considerations</h3>\n\t\t\t\t\t\t<ul class=\"risks-list\">\n\t\t\t\t\t\t\t{#each deliverable.plan.risks as risk}\n\t\t\t\t\t\t\t\t<li>{risk}</li>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- Metadata -->\n\t\t\t\t<div class=\"metadata\">\n\t\t\t\t\t<div class=\"metadata-item\">\n\t\t\t\t\t\t<span class=\"label\">Tokens Used:</span>\n\t\t\t\t\t\t<span class=\"value\">{formatTokens(deliverable.metadata.totalTokens)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"metadata-item\">\n\t\t\t\t\t\t<span class=\"label\">Cost:</span>\n\t\t\t\t\t\t<span class=\"value\">{formatCost(deliverable.metadata.totalCost)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"metadata-item\">\n\t\t\t\t\t\t<span class=\"label\">Duration:</span>\n\t\t\t\t\t\t<span class=\"value\">{formatDuration(deliverable.metadata.duration)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"prompt-view\">\n\t\t\t\t<div class=\"prompt-header\">\n\t\t\t\t\t<h3>Execution Prompt</h3>\n\t\t\t\t\t<div class=\"prompt-actions\">\n\t\t\t\t\t\t<Button variant=\"secondary\" size=\"sm\" onclick={() => copyToClipboard(deliverable.prompt)}>\n\t\t\t\t\t\t\tCopy\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tonclick={() => downloadAsFile(deliverable.prompt, `${deliverable.plan.title}-prompt.txt`)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tDownload\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<pre class=\"prompt-text\">{deliverable.prompt}</pre>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t.deliverable-viewer {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t}\n\n\t.tabs {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tborder-bottom: 1px solid var(--color-border);\n\t}\n\n\t.tab {\n\t\tpadding: 12px 24px;\n\t\tbackground: none;\n\t\tborder: none;\n\t\tborder-bottom: 2px solid transparent;\n\t\tcolor: var(--color-text-muted);\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\ttransition: all 0.2s ease;\n\t}\n\n\t.tab:hover {\n\t\tcolor: var(--color-text);\n\t\tborder-bottom-color: var(--color-border-dark);\n\t}\n\n\t.tab.active {\n\t\tcolor: var(--color-brass);\n\t\tborder-bottom-color: var(--color-brass);\n\t}\n\n\t.tab-content {\n\t\tpadding: 16px 0;\n\t}\n\n\t.plan-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: flex-start;\n\t\tmargin-bottom: 24px;\n\t\tpadding-bottom: 16px;\n\t\tborder-bottom: 1px solid var(--color-border);\n\t}\n\n\t.plan-header h2 {\n\t\tfont-family: 'Cinzel', serif;\n\t\tfont-weight: 300;\n\t\tfont-size: 1.5rem;\n\t\tcolor: var(--color-text);\n\t\tmargin: 0;\n\t}\n\n\t.plan-actions {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t}\n\n\t.plan-section {\n\t\tmargin-bottom: 32px;\n\t}\n\n\t.plan-section h3 {\n\t\tfont-size: 1.125rem;\n\t\tcolor: var(--color-brass);\n\t\tmargin-bottom: 12px;\n\t}\n\n\t.overview-text {\n\t\tcolor: var(--color-text);\n\t\tline-height: 1.6;\n\t}\n\n\t.steps-list {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t}\n\n\t.step-card {\n\t\tpadding: 16px;\n\t\tbackground: var(--color-surface);\n\t\tborder: 1px solid var(--color-border);\n\t\tborder-radius: 4px;\n\t}\n\n\t.step-header {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tmargin-bottom: 12px;\n\t}\n\n\t.step-number {\n\t\twidth: 32px;\n\t\theight: 32px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackground: var(--color-brass);\n\t\tcolor: var(--color-bg);\n\t\tborder-radius: 50%;\n\t\tfont-weight: 700;\n\t\tfont-size: 0.875rem;\n\t\tflex-shrink: 0;\n\t}\n\n\t.step-header h4 {\n\t\tmargin: 0;\n\t\tcolor: var(--color-text);\n\t\tfont-size: 1rem;\n\t}\n\n\t.step-description {\n\t\tcolor: var(--color-text-muted);\n\t\tline-height: 1.6;\n\t\tmargin-bottom: 12px;\n\t}\n\n\t.acceptance-criteria {\n\t\tmargin-bottom: 12px;\n\t}\n\n\t.acceptance-criteria h5 {\n\t\tfont-size: 0.875rem;\n\t\tcolor: var(--color-text);\n\t\tmargin-bottom: 8px;\n\t}\n\n\t.acceptance-criteria ul {\n\t\tmargin: 0;\n\t\tpadding-left: 20px;\n\t}\n\n\t.acceptance-criteria li {\n\t\tcolor: var(--color-text-muted);\n\t\tmargin-bottom: 4px;\n\t}\n\n\t.dependencies {\n\t\tfont-size: 0.875rem;\n\t\tcolor: var(--color-text-muted);\n\t\tmargin-bottom: 12px;\n\t}\n\n\t.dependencies strong {\n\t\tcolor: var(--color-text);\n\t}\n\n\t.step-meta {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\tmargin-top: 12px;\n\t}\n\n\t.risks-list {\n\t\tlist-style: none;\n\t\tpadding: 0;\n\t\tmargin: 0;\n\t}\n\n\t.risks-list li {\n\t\tpadding: 12px;\n\t\tbackground: rgba(232, 166, 77, 0.1);\n\t\tborder-left: 3px solid #e8a64d;\n\t\tmargin-bottom: 8px;\n\t\tborder-radius: 4px;\n\t\tcolor: var(--color-text);\n\t}\n\n\t.metadata {\n\t\tdisplay: flex;\n\t\tgap: 24px;\n\t\tpadding: 16px;\n\t\tbackground: var(--color-surface);\n\t\tborder-radius: 4px;\n\t}\n\n\t.metadata-item {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 4px;\n\t}\n\n\t.metadata-item .label {\n\t\tfont-size: 0.75rem;\n\t\tcolor: var(--color-text-muted);\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 0.05em;\n\t}\n\n\t.metadata-item .value {\n\t\tfont-weight: 600;\n\t\tcolor: var(--color-text);\n\t}\n\n\t.prompt-view {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 16px;\n\t}\n\n\t.prompt-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\n\t.prompt-header h3 {\n\t\tmargin: 0;\n\t\tcolor: var(--color-brass);\n\t}\n\n\t.prompt-actions {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t}\n\n\t.prompt-text {\n\t\tbackground: var(--color-bg);\n\t\tborder: 1px solid var(--color-border);\n\t\tborder-radius: 4px;\n\t\tpadding: 16px;\n\t\tfont-family: 'JetBrains Mono', monospace;\n\t\tfont-size: 0.875rem;\n\t\tline-height: 1.6;\n\t\tcolor: var(--color-text);\n\t\twhite-space: pre-wrap;\n\t\tword-wrap: break-word;\n\t\tmax-height: 600px;\n\t\toverflow-y: auto;\n\t\tmargin: 0;\n\t}\n</style>\n"],"names":["PAORTStage","SessionStatus","state","sessions","currentSession","isStreaming","streamingOutput","currentStage","planningStore","activeSessions","filter","s","status","RUNNING","PENDING","completedSessions","COMPLETED","failedSessions","FAILED","createSession","request","session","id","Date","now","Math","random","toString","substr","type","createdAt","stages","startSession","sessionId","find","startedAt","Stage","PLAN","updateStageOutput","stage","output","plan","ACT","act","OBSERVE","observe","REFLECT","reflect","appendStreamingOutput","content","clearStreamingOutput","advanceStage","nextStage","completeSession","deliverable","completedAt","failSession","error","cancelSession","CANCELLED","_a","setCurrentSession","deleteSession","clearAll","streamingService","constructor","__publicField","this","Map","subscribe","url","options","onChunk","onStageStart","onStageEnd","onComplete","onError","reconnect","reconnectDelay","maxReconnectAttempts","eventSource","reconnectAttempts","isPaused","isClosed","reconnectTimer","connect","EventSource","activeStreams","set","addEventListener","event","chunk","JSON","parse","data","chunkData","err","stageData","completeData","result","closeStream","createNetworkError","close","delete","setTimeout","classifyError","clearTimeout","pause","resume","isActive","closeAll","forEach","clear","activeStreamCount","size","validatePlanningRequest","title","trim","length","createValidationError","description","$.state","isSubmitting","$.derived","form","root","Alert","$$anchor","$.template_effect","$.set_text","text","$.get","userMessage","$$render","consequent","$0","Input","node_1","value","$$value","Textarea","node_2","div","$.sibling","Button","node_3","node_4","$.set","$.event","async","validationError","success","streamUrl","paortStage","stageOutput","message","startPlanningSession","key","label","currentIndex","getStageIndex","stageKey","$$props","findIndex","div_1","$.index","stageItem","index","isCompleted","isPending","div_2","root_1","div_3","div_4","svg","root_2","div_5","root_4","nodeValue","consequent_1","alternate","alternate_1","div_6","div_7","div_8","div_9","root_6","classes_1","$.set_class","consequent_2","classes","text_1","text_2","$.each","slice","reverse","button","root_3","__click","selectSession","$.child","span","getStatusVariant","Badge","getStatusLabel","span_1","duration","getTime","span_2","root_5","round","$.reset","active","formatDate","date","Intl","DateTimeFormat","month","day","hour","minute","format","$.append","ErrorBoundary","Panel","node","RequestForm","SessionHistory","StageProgress","outputContainer","shouldAutoScroll","handleScroll","scrollTop","scrollHeight","clientHeight","$.user_effect","$.first_child","fragment","pre","streaming","StageOutput","activeTab","copyToClipboard","navigator","clipboard","writeText","downloadAsFile","filename","blob","Blob","URL","createObjectURL","a","document","createElement","href","download","click","revokeObjectURL","button_1","h2","stringify","onclick","p","text_5","estimatedEffort","steps","step","div_10","div_11","textContent","h4","p_1","div_12","ul","acceptanceCriteria","criterion","li","root_7","div_13","root_8","text_9","dependencies","join","div_14","node_5","node_6","text_10","text_6","text_7","div_15","root_10","ul_1","risks","risk","li_1","root_11","div_16","node_7","div_17","div_18","div_19","span_3","text_4","overview","formatTokens","tokens","metadata","totalTokens","toFixed","formatCost","cost","totalCost","formatDuration","ms","div_20","root_12","div_21","div_22","node_8","prompt","node_9","consequent_3","DeliverableViewer","root_13","root_15","consequent_4","alternate_2"],"mappings":"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"}